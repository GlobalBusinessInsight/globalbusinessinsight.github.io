<!DOCTYPE html>
<html lang="zh-CN">
<head>
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6214772877334340"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>从记录到战略：生产成本核算的交互式分析</title>
    <style>
        :root {
            --primary-color: #005A9C;
            --secondary-color: #003366;
            --accent-color: #FFC107;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --light-gray: #e9ecef;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes number-grow {
            from { transform: scale(0.8); opacity: 0.5; }
            to { transform: scale(1); opacity: 1; }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            font-size: 16px;
        }
       .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 80px 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }
        header h1 {
            font-size: 3.5em;
            margin: 0;
            font-weight: 700;
            animation: fadeIn 1s ease-out;
        }
        header p {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0.9;
            animation: fadeIn 1.5s ease-out;
        }
       .section {
            padding: 60px 0;
            border-bottom: 1px solid var(--light-gray);
            overflow-x: hidden;
        }
       .section:last-child {
            border-bottom: none;
        }
       .section-title {
            text-align: center;
            font-size: 2.5em;
            color: var(--secondary-color);
            margin-bottom: 50px;
            position: relative;
        }
       .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: var(--accent-color);
            margin: 15px auto 0;
            border-radius: 2px;
        }
       .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
       .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 1s;
        }
       .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
       .card h3 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.5em;
        }
       .icon {
            font-size: 3em;
            color: var(--accent-color);
            margin-bottom: 15px;
        }
       .flowchart {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }
       .flow-item {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: var(--light-gray);
            min-width: 180px;
            margin: 10px;
            animation: fadeIn 1s;
        }
       .flow-arrow {
            font-size: 2.5em;
            color: var(--primary-color);
            margin: 0 15px;
            animation: fadeIn 1.5s;
        }
       .comparison-container {
            display: flex;
            gap: 40px;
            margin-top: 40px;
        }
       .comparison-column {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
        }
       .comparison-column.traditional {
            background-color: #fff0f0;
            animation: slideInLeft 1s;
        }
       .comparison-column.abc {
            background-color: #e6f4ff;
            animation: slideInRight 1s;
        }
       .comparison-column h3 {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 20px;
        }
       .comparison-animation {
            height: 200px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
        }
       .overhead-bucket {
            width: 80px;
            height: 50px;
            background: var(--accent-color);
            border-radius: 5px 5px 0 0;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }
       .products-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
       .product {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
       .product.simple { background: #4CAF50; }
       .product.complex { background: #F44336; }
       .flow-line {
            position: absolute;
            background: #999;
            transform-origin: top left;
        }
       .traditional.flow-line {
            height: 2px;
            width: 100%;
            top: 90px;
            left: 0;
        }
       .abc.activity-bucket {
            width: 60px;
            height: 30px;
            background: #B3E5FC;
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            font-size: 0.7em;
            line-height: 30px;
            text-align: center;
        }
       .abc.activities-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
       .demo-container {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }
       .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
       .demo-inputs,.demo-results {
            padding: 20px;
            border: 1px solid var(--light-gray);
            border-radius: 10px;
        }
       .demo-inputs h4,.demo-results h4 {
            margin-top: 0;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
       .input-group {
            margin-bottom: 15px;
        }
       .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
       .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
       .result-card {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
       .result-card.traditional-result { background-color: #fff0f0; }
       .result-card.abc-result { background-color: #e6f4ff; }
       .result-card h5 { margin: 0 0 15px 0; font-size: 1.2em; }
       .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
       .result-value {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--secondary-color);
            animation: number-grow 0.5s ease-in-out;
        }
       .result-comparison {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }
       .comparison-bar-container {
            width: 100%;
            background: var(--light-gray);
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }
       .comparison-bar {
            height: 25px;
            color: white;
            text-align: right;
            padding-right: 5px;
            line-height: 25px;
            white-space: nowrap;
            transition: width 0.5s ease-in-out;
        }
       .bar-touring { background-color: #4CAF50; }
       .bar-mountain { background-color: #F44336; }
       .ai-chatbot {
            margin-top: 40px;
            border: 1px solid var(--light-gray);
            border-radius: 10px;
            overflow: hidden;
        }
       .ai-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px;
            font-weight: bold;
        }
       .ai-body {
            padding: 20px;
        }
        #ai-chatbox {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #fdfdfd;
        }
       .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
        }
       .user-message {
            background-color: #e1e1e1;
            align-self: flex-end;
            margin-left: auto;
        }
       .ai-message {
            background-color: #e6f4ff;
            align-self: flex-start;
        }
       .ai-input-area {
            display: flex;
            gap: 10px;
        }
        #ai-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #ai-send-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #ai-send-btn:hover {
            background-color: var(--secondary-color);
        }
       .timeline {
            position: relative;
            max-width: 100%;
            margin: 0 auto;
        }
       .timeline::after {
            content: '';
            position: absolute;
            width: 6px;
            background-color: var(--accent-color);
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -3px;
        }
       .timeline-container {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
       .timeline-container.left { left: 0; }
       .timeline-container.right { left: 50%; }
       .timeline-container::after {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            right: -17px;
            background-color: white;
            border: 4px solid var(--primary-color);
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }
       .right::after { left: -16px; }
       .timeline-content {
            padding: 20px 30px;
            background-color: white;
            position: relative;
            border-radius: 6px;
            box-shadow: var(--shadow);
        }
        /* Responsive adjustments */
        @media screen and (max-width: 992px) {
           .demo-grid {
                grid-template-columns: 1fr;
            }
        }
        @media screen and (max-width: 768px) {
            header h1 { font-size: 2.5em; }
           .section-title { font-size: 2em; }
           .flowchart { flex-direction: column; }
           .flow-arrow { transform: rotate(90deg); margin: 15px 0; }
           .comparison-container { flex-direction: column; }
           .timeline::after { left: 31px; }
           .timeline-container { width: 100%; padding-left: 70px; padding-right: 25px; }
           .timeline-container.right { left: 0%; }
           .timeline-container.left::after,.timeline-container.right::after { left: 15px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>从记录到战略</h1>
            <p>生产成本核算的交互式分析与优化路线图</p>
        </div>
    </header>

    <main>
        <section id="foundation" class="section">
            <div class="container">
                <h2 class="section-title">现代生产成本核算的基础</h2>
                <div class="grid">
                    <div class="card">
                        <div class="icon">📦</div>
                        <h3>直接材料</h3>
                        <p>能够以经济、可行的方式直接追溯到最终产品上的原材料及主要材料。例如汽车制造中的钢板、轮胎。</p>
                    </div>
                    <div class="card">
                        <div class="icon">👨‍🔧</div>
                        <h3>直接人工</h3>
                        <p>直接从事产品生产的一线工人的薪酬及福利费用。这些成本可以通过工时记录或计件工资系统直接归集。</p>
                    </div>
                    <div class="card">
                        <div class="icon">🏭</div>
                        <h3>制造费用</h3>
                        <p>除直接材料和直接人工之外的所有间接生产成本的总和，如车间管理人员工资、设备折旧、水电费等。</p>
                    </div>
                </div>
                <h3 style="text-align:center; margin-top: 60px; color: var(--secondary-color);">成本流转路径</h3>
                <div class="flowchart">
                    <div class="flow-item">直接成本<br>(材料/人工)</div>
                    <div class="flow-arrow">➡️</div>
                    <div class="flow-item" style="background-color: #B3E5FC;">生产成本账户</div>
                    <div class="flow-arrow">➡️</div>
                    <div class="flow-item" style="background-color: #C8E6C9;">库存商品</div>
                </div>
                 <div class="flowchart" style="margin-top: 20px;">
                    <div class="flow-item">间接成本<br>(制造费用)</div>
                    <div class="flow-arrow">➡️</div>
                    <div class="flow-item" style="background-color: #FFECB3;">制造费用账户</div>
                     <div class="flow-arrow">↘️</div>
                </div>
            </div>
        </section>

        <section id="methods" class="section">
            <div class="container">
                <h2 class="section-title">核心成本核算方法论</h2>
                <p style="text-align:center; max-width: 800px; margin: -30px auto 50px;">不同的成本核算方法对间接费用的处理方式截然不同，这直接导致了产品成本的巨大差异，并可能误导战略决策。下面我们将通过动画和交互式Demo来揭示其中的奥秘。</p>
                
                <div class="comparison-container">
                    <div class="comparison-column traditional">
                        <h3>传统成本法</h3>
                        <div class="comparison-animation">
                            <div class="overhead-bucket">总制造费用</div>
                            <div style="width: 2px; height: 30px; background: #999;"></div>
                            <div class="products-container">
                                <div class="product simple">高产量<br>简单品</div>
                                <div class="product complex">低产量<br>复杂品</div>
                            </div>
                        </div>
                        <p style="margin-top: 20px;"><strong>核心逻辑：</strong>采用单一的、基于产量的分配基础（如机器工时），将所有制造费用像“抹花生酱”一样，不加区分地、均匀地涂抹在所有产品上。</p>
                        <p><strong>结果：</strong>导致成本交叉补贴——高估简单产品成本，低估复杂产品成本。</p>
                    </div>
                    <div class="comparison-column abc">
                        <h3>作业成本法 (ABC)</h3>
                        <div class="comparison-animation">
                            <div class="overhead-bucket">总制造费用</div>
                            <div style="width: 2px; height: 20px; background: #999;"></div>
                            <div class="activities-row">
                                <div class="activity-bucket">采购</div>
                                <div class="activity-bucket">调试</div>
                                <div class="activity-bucket">检验</div>
                                <div class="activity-bucket">操作</div>
                            </div>
                             <div class="products-container">
                                <div class="product simple">高产量<br>简单品</div>
                                <div class="product complex">低产量<br>复杂品</div>
                            </div>
                        </div>
                        <p style="margin-top: 20px;"><strong>核心逻辑：</strong>“产品消耗作业，作业消耗资源”。首先将制造费用追溯到具体的“作业”（如机器调试、物料采购），然后根据每种产品实际消耗的作业量，精准地分配成本。</p>
                        <p><strong>结果：</strong>提供更准确的产品成本信息，揭示真实的盈利能力。</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="demo" class="section" style="background-color: var(--light-gray);">
            <div class="container">
                <h2 class="section-title">Live Demo: 揭示真实盈利能力</h2>
                <div class="demo-container">
                    <div class="demo-grid">
                        <div class="demo-inputs">
                            <h4>⚙️ 输入参数 (High Challenge公司案例)</h4>
                            <div class="input-group">
                                <label for="totalOverhead">制造费用总额 ($)</label>
                                <input type="number" id="totalOverhead" value="200000">
                            </div>
                            <hr>
                            <h5>旅行自行车 (高产量, 简单)</h5>
                            <div class="input-group">
                                <label>机器工时</label>
                                <input type="number" id="touringMachineHours" value="1500">
                            </div>
                            <div class="input-group">
                                <label>材料件数</label>
                                <input type="number" id="touringMaterialPieces" value="6000">
                            </div>
                            <div class="input-group">
                                <label>调试次数</label>
                                <input type="number" id="touringSetups" value="10">
                            </div>
                            <hr>
                             <h5>山地自行车 (低产量, 复杂)</h5>
                            <div class="input-group">
                                <label>机器工时</label>
                                <input type="number" id="mountainMachineHours" value="500">
                            </div>
                             <div class="input-group">
                                <label>材料件数</label>
                                <input type="number" id="mountainMaterialPieces" value="4000">
                            </div>
                            <div class="input-group">
                                <label>调试次数</label>
                                <input type="number" id="mountainSetups" value="30">
                            </div>
                        </div>
                        <div class="demo-results">
                            <h4>📊 计算结果</h4>
                            <div class="result-card traditional-result">
                                <h5>传统成本法 (基于机器工时)</h5>
                                <div class="result-item">
                                    <span>旅行自行车</span>
                                    <span class="result-value" id="traditionalTouring"></span>
                                </div>
                                <div class="result-item">
                                    <span>山地自行车</span>
                                    <span class="result-value" id="traditionalMountain"></span>
                                </div>
                            </div>
                             <div class="result-card abc-result">
                                <h5>作业成本法 (ABC)</h5>
                                <div class="result-item">
                                    <span>旅行自行车</span>
                                    <span class="result-value" id="abcTouring"></span>
                                </div>
                                <div class="result-item">
                                    <span>山地自行车</span>
                                    <span class="result-value" id="abcMountain"></span>
                                </div>
                            </div>
                            <div class="result-comparison">
                                <h5>成本分配对比</h5>
                                <div>旅行自行车</div>
                                <div class="comparison-bar-container">
                                    <div class="comparison-bar bar-touring" id="barTouring"></div>
                                </div>
                                <div>山地自行车</div>
                                <div class="comparison-bar-container">
                                    <div class="comparison-bar bar-mountain" id="barMountain"></div>
                                </div>
                                <p id="crossSubsidization" style="text-align:center; font-weight:bold; margin-top:20px;"></p>
                            </div>
                        </div>
                    </div>
                    <div class="ai-chatbot">
                        <div class="ai-header">🤖 AI成本战略分析师</div>
                        <div class="ai-body">
                            <div id="ai-chatbox">
                                <div class="ai-message">你好！我是AI成本战略分析师。在您调整参数并查看结果后，可以向我提问，我会基于当前数据为您提供分析和建议。试试问我：“分析一下当前结果的战略影响”</div>
                            </div>
                            <div class="ai-input-area">
                                <input type="text" id="ai-input" placeholder="在此输入您的问题...">
                                <button id="ai-send-btn">发送</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="roadmap" class="section">
            <div class="container">
                <h2 class="section-title">实施路线图与文化建设</h2>
                <div class="timeline">
                    <div class="timeline-container left">
                        <div class="timeline-content">
                            <h3>阶段一：资源规划与系统设计</h3>
                            <p>明确项目目标，识别利益相关者，并基于企业战略和运营环境，选择最适合的成本核算方法论。</p>
                        </div>
                    </div>
                    <div class="timeline-container right">
                        <div class="timeline-content">
                            <h3>阶段二：成本估算与预算编制</h3>
                            <p>为实施新系统所需的所有资源（软件、硬件、咨询、人力）进行详细的成本估算，并制定项目总预算。</p>
                        </div>
                    </div>
                    <div class="timeline-container left">
                        <div class="timeline-content">
                            <h3>阶段三：执行与成本控制</h3>
                            <p>配置系统、迁移数据、培训用户。持续监控实际支出与预算的偏差，并管理变更请求。</p>
                        </div>
                    </div>
                     <div class="timeline-container right">
                        <div class="timeline-content">
                            <h3>阶段四：报告与复盘</h3>
                            <p>建立定期报告机制，沟通项目状态。项目结束后进行全面复盘，总结经验教训，为未来变革提供知识财富。</p>
                        </div>
                    </div>
                </div>
                 <div class="grid" style="margin-top: 60px;">
                    <div class="card">
                        <div class="icon">👑</div>
                        <h3>领导层的承诺</h3>
                        <p>变革必须由上而下推动。最高领导者需要亲自倡导成本意识的重要性，并在决策中以身作则。</p>
                    </div>
                    <div class="card">
                        <div class="icon">🤝</div>
                        <h3>员工的参与</h3>
                        <p>建立机制，鼓励并赋能员工去发现流程中的浪费和低效环节，并提出改进建议。</p>
                    </div>
                    <div class="card">
                        <div class="icon">📣</div>
                        <h3>透明的沟通</h3>
                        <p>向员工清晰阐明成本管理政策，并提供持续培训，让他们理解变革的意义和个人的贡献。</p>
                    </div>
                     <div class="card">
                        <div class="icon">🏆</div>
                        <h3>激励与认可</h3>
                        <p>将绩效评估和薪酬体系与成本节约目标挂钩。及时的公开表彰和认可同样重要。</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('.demo-inputs input');
            
            const abcRates = {
                purchasing: 2, // $2 per piece
                setups: 2000, // $2000 per setup
                inspections: 100, // $100 per inspection hour (fixed for both)
                operating: 30 // $30 per machine hour
            };

            function formatCurrency(value) {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
            }

            function calculateCosts() {
                // Get all input values
                const totalOverhead = parseFloat(document.getElementById('totalOverhead').value) |

| 0;
                const touringMachineHours = parseFloat(document.getElementById('touringMachineHours').value) |

| 0;
                const mountainMachineHours = parseFloat(document.getElementById('mountainMachineHours').value) |

| 0;
                const touringMaterialPieces = parseFloat(document.getElementById('touringMaterialPieces').value) |

| 0;
                const mountainMaterialPieces = parseFloat(document.getElementById('mountainMaterialPieces').value) |

| 0;
                const touringSetups = parseFloat(document.getElementById('touringSetups').value) |

| 0;
                const mountainSetups = parseFloat(document.getElementById('mountainSetups').value) |

| 0;
                
                // --- Traditional Costing Calculation ---
                const totalMachineHours = touringMachineHours + mountainMachineHours;
                const traditionalRate = totalMachineHours > 0? totalOverhead / totalMachineHours : 0;
                
                const traditionalTouringCost = touringMachineHours * traditionalRate;
                const traditionalMountainCost = mountainMachineHours * traditionalRate;

                // --- ABC Costing Calculation ---
                // Note: For this demo, we'll use a simplified ABC model based on the report's case.
                // The total overhead is broken down into activities. The rates are given.
                const abcTouringCost = (touringMaterialPieces * abcRates.purchasing) + 
                                       (touringSetups * abcRates.setups) + 
                                       (200 * abcRates.inspections) + // Fixed 200 inspection hours from case
                                       (touringMachineHours * abcRates.operating);

                const abcMountainCost = (mountainMaterialPieces * abcRates.purchasing) + 
                                        (mountainSetups * abcRates.setups) + 
                                        (200 * abcRates.inspections) + // Fixed 200 inspection hours from case
                                        (mountainMachineHours * abcRates.operating);

                // Update the DOM
                document.getElementById('traditionalTouring').textContent = formatCurrency(traditionalTouringCost);
                document.getElementById('traditionalMountain').textContent = formatCurrency(traditionalMountainCost);
                document.getElementById('abcTouring').textContent = formatCurrency(abcTouringCost);
                document.getElementById('abcMountain').textContent = formatCurrency(abcMountainCost);
                
                // Update comparison bars
                const totalCalculatedCost = traditionalTouringCost + traditionalMountainCost;
                const barTouring = document.getElementById('barTouring');
                const barMountain = document.getElementById('barMountain');

                const touringPercentage = totalCalculatedCost > 0? (traditionalTouringCost / totalCalculatedCost) * 100 : 0;
                const mountainPercentage = totalCalculatedCost > 0? (traditionalMountainCost / totalCalculatedCost) * 100 : 0;

                barTouring.style.width = touringPercentage + '%';
                barTouring.textContent = `传统法: ${formatCurrency(traditionalTouringCost)}`;
                barMountain.style.width = mountainPercentage + '%';
                barMountain.textContent = `传统法: ${formatCurrency(traditionalMountainCost)}`;
                
                // Update cross-subsidization text
                const subsidizationAmount = traditionalTouringCost - abcTouringCost;
                if (subsidizationAmount > 0) {
                    document.getElementById('crossSubsidization').textContent = `成本交叉补贴：旅行自行车被高估了 ${formatCurrency(subsidizationAmount)}，这部分成本被错误地从未充分计费的山地自行车转移了。`;
                    document.getElementById('crossSubsidization').style.color = '#D32F2F';
                } else {
                     document.getElementById('crossSubsidization').textContent = `成本交叉补贴：山地自行车被高估了 ${formatCurrency(Math.abs(subsidizationAmount))}，这部分成本被错误地从未充分计费的旅行自行车转移了。`;
                     document.getElementById('crossSubsidization').style.color = '#D32F2F';
                }
            }

            inputs.forEach(input => {
                input.addEventListener('input', calculateCosts);
            });

            // Initial calculation
            calculateCosts();

            // AI Chatbot Logic
            const aiChatbox = document.getElementById('ai-chatbox');
            const aiInput = document.getElementById('ai-input');
            const aiSendBtn = document.getElementById('ai-send-btn');

            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', sender + '-message');
                messageDiv.textContent = text;
                aiChatbox.appendChild(messageDiv);
                aiChatbox.scrollTop = aiChatbox.scrollHeight;
            }

            function getAIResponse(userInput) {
                const lowerInput = userInput.toLowerCase();
                
                // Get current demo data for context-aware responses
                const abcTouringCost = parseFloat(document.getElementById('abcTouring').textContent.replace(/[^0-9.-]+/g,""));
                const abcMountainCost = parseFloat(document.getElementById('abcMountain').textContent.replace(/[^0-9.-]+/g,""));
                const traditionalTouringCost = parseFloat(document.getElementById('traditionalTouring').textContent.replace(/[^0-9.-]+/g,""));
                const traditionalMountainCost = parseFloat(document.getElementById('traditionalMountain').textContent.replace(/[^0-9.-]+/g,""));
                const mountainSetups = parseFloat(document.getElementById('mountainSetups').value);
                const mountainSetupCost = mountainSetups * abcRates.setups;

                if (lowerInput.includes('影响') |

| lowerInput.includes('implication')) {
                    const subsidizationAmount = traditionalTouringCost - abcTouringCost;
                    return `根据当前数据，传统成本法严重扭曲了产品盈利能力。旅行自行车（高产量产品）的成本被高估了 ${formatCurrency(subsidizationAmount)}，而山地自行车（低产量、高复杂度产品）的成本被相应低估。战略影响是：公司可能错误地认为山地车利润丰厚，从而投入更多资源，而实际上它可能正在亏损。同时，公司可能会因为旅行车“表面上”的低利润而做出错误的定价或停产决策，放弃了真正的利润来源。`;
                } else if (lowerInput.includes('为什么') && (lowerInput.includes('山地') |

| lowerInput.includes('mountain')) && (lowerInput.includes('高') |
| lowerInput.includes('higher'))) {
                    return `在ABC方法下，山地自行车的成本 (${formatCurrency(abcMountainCost)}) 更高，因为它消耗了更多高成本的非产量相关作业。特别是“机器调试”作业，山地车需要 ${mountainSetups} 次，产生了 ${formatCurrency(mountainSetupCost)} 的成本，而旅行车只需要10次。ABC方法精确地捕捉到了这种由产品复杂性驱动的成本，而传统方法忽略了这一点。`;
                } else if (lowerInput.includes('降低') |

| lowerInput.includes('减少') |
| lowerInput.includes('reduce')) {
                     return `很好的问题！要降低山地车的成本，我们应关注其最大的成本动因。根据ABC分析，“机器调试”是主要成本来源。可行的策略包括：1. 流程优化：推行“快速换模 (SMED)”技术来降低单次调试的成本和时间。 2. 生产计划：优化生产批次，减少换线频率，从而减少总的调试次数。 3. 产品设计：在设计阶段就考虑制造的简便性，减少对特殊调试的需求。`;
                } else if (lowerInput.includes('你好') |

| lowerInput.includes('hello')) {
                    return '你好！有什么可以帮您的吗？您可以问我关于当前成本计算结果的问题。';
                } else {
                    return '抱歉，我无法完全理解您的问题。您可以尝试问我：“分析当前结果的影响”、“为什么山地车成本更高？”或“如何降低成本？”';
                }
            }

            function handleSend() {
                const userInput = aiInput.value.trim();
                if (userInput) {
                    addMessage(userInput, 'user');
                    aiInput.value = '';
                    
                    // Simulate AI thinking
                    setTimeout(() => {
                        const aiResponse = getAIResponse(userInput);
                        addMessage(aiResponse, 'ai');
                    }, 500);
                }
            }

            aiSendBtn.addEventListener('click', handleSend);
            aiInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSend();
                }
            });
        });
    </script>
</body>
</html>
