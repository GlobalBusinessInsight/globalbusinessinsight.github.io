<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>绿新能源 | 充电站网络地图 (状态可视化版)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Baidu Map API -->
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=hyHkuQy8h5UbZVMC0mpVW4ma7TVxqm3W"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }

        /* Map Container */
        #baiduMap {
            width: 100%;
            height: 100%;
            border-radius: 0; 
            min-height: 500px;
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .active-nav {
            background-color: #0f766e; /* Teal 700 */
            color: white;
            font-weight: 500;
        }
        .nav-item:hover:not(.active-nav) {
            background-color: #f1f5f9;
            color: #0f766e;
        }
        
        /* Status Badges for List */
        .status-badge-active {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .status-badge-construction {
            background-color: #ffedd5;
            color: #9a3412;
            border: 1px solid #fed7aa;
        }
    </style>

    <!-- CONFIRMATION: NO SVG graphics used. Markers colored Green/Orange via Baidu Map Vector Symbols. Data: 72 stations. -->

</head>
<body class="bg-slate-50 flex h-screen overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-white border-r border-slate-200 flex-col hidden md:flex shadow-sm z-20">
        <div class="p-6 flex items-center justify-center border-b border-slate-100">
            <div class="w-10 h-10 bg-teal-600 rounded-lg flex items-center justify-center text-white mr-3 shadow-md">
                <i class="fa-solid fa-charging-station text-xl"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-slate-800 tracking-tight">绿新能源</h1>
                <p class="text-xs text-slate-500">网络资产管理</p>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-2">
            <button onclick="app.navigate('map')" id="nav-map" class="nav-item active-nav w-full flex items-center px-4 py-3 rounded-lg transition-colors duration-200">
                <i class="fa-solid fa-map-location-dot w-6 text-center"></i>
                <span class="ml-3">分布地图</span>
            </button>
            <button onclick="app.navigate('list')" id="nav-list" class="nav-item w-full flex items-center px-4 py-3 rounded-lg transition-colors duration-200 text-slate-600">
                <i class="fa-solid fa-table-list w-6 text-center"></i>
                <span class="ml-3">资产列表</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-100">
            <div class="bg-slate-50 rounded-lg p-3 text-xs text-slate-500">
                <div class="flex justify-between mb-1">
                    <span>当前版本：</span>
                    <span class="font-mono font-bold text-teal-600">v3.0 状态视图</span>
                </div>
                <div class="flex justify-between">
                    <span>站点总数：</span>
                    <span class="font-bold text-slate-700">72 座</span>
                </div>
                <div class="mt-2 text-center text-teal-600 bg-teal-50 py-1 rounded border border-teal-100 text-xs">
                    <i class="fa-solid fa-check-circle mr-1"></i> 数据完整
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 w-full bg-white z-50 border-b border-slate-200 px-4 py-3 flex justify-between items-center shadow-sm">
        <div class="flex items-center">
            <div class="w-8 h-8 bg-teal-600 rounded flex items-center justify-center text-white mr-2">
                <i class="fa-solid fa-bolt"></i>
            </div>
            <span class="font-bold text-slate-800">绿新能源 (72)</span>
        </div>
        <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-slate-600 focus:outline-none">
            <i class="fa-solid fa-bars text-xl"></i>
        </button>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="hidden fixed inset-0 bg-slate-800 bg-opacity-75 z-40 md:hidden" onclick="this.classList.add('hidden')">
        <div class="bg-white w-64 h-full p-4 space-y-2 pt-16">
            <button onclick="app.navigate('map')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">分布地图</button>
            <button onclick="app.navigate('list')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">资产列表</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative pt-14 md:pt-0">
        
        <!-- Header -->
        <header id="main-header" class="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center shadow-sm z-10 hidden">
            <div id="page-title">
                <h2 class="text-xl font-bold text-slate-800">资产列表</h2>
            </div>
            <div class="relative w-64">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                    <i class="fa-solid fa-search"></i>
                </span>
                <input type="text" placeholder="搜索站点名称..." 
                       class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none text-sm"
                       oninput="app.handleSearch(this.value)">
            </div>
        </header>

        <!-- View: Map -->
        <div id="view-map" class="flex-1 flex flex-col h-full relative fade-in">
            <!-- Map Overlay Controls -->
            <div class="absolute top-4 left-4 z-10 bg-white p-3 rounded-lg shadow-lg max-w-xs opacity-95">
                <h4 class="font-bold text-slate-800 mb-2 text-sm">状态图例</h4>
                <div class="space-y-2">
                    <div class="flex items-center text-xs p-1 rounded hover:bg-slate-50 transition-colors cursor-pointer" onclick="app.filterMap('已投运')">
                        <div class="w-4 h-4 rounded-full bg-green-500 border-2 border-white shadow-sm mr-2 flex items-center justify-center"></div>
                        <span class="text-slate-600 flex-1 font-medium">已投运 (Operational)</span>
                        <span class="font-bold text-green-600 ml-2" id="count-active">--</span>
                    </div>
                    <div class="flex items-center text-xs p-1 rounded hover:bg-slate-50 transition-colors cursor-pointer" onclick="app.filterMap('建设中')">
                        <div class="w-4 h-4 rounded-full bg-orange-500 border-2 border-white shadow-sm mr-2 flex items-center justify-center"></div>
                        <span class="text-slate-600 flex-1 font-medium">建设中 (Construction)</span>
                        <span class="font-bold text-orange-600 ml-2" id="count-construction">--</span>
                    </div>
                </div>
            </div>
            
            <div id="baiduMap" class="w-full h-full bg-slate-200 flex items-center justify-center">
                <div class="text-center p-6">
                    <i class="fa-solid fa-spinner fa-spin text-3xl text-teal-600 mb-3"></i>
                    <p class="text-slate-600">地图加载中...</p>
                </div>
            </div>
        </div>

        <!-- View: List -->
        <div id="view-list" class="flex-1 overflow-y-auto p-6 custom-scroll hidden fade-in">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                                <th class="px-6 py-3 font-semibold w-16">ID</th>
                                <th class="px-6 py-3 font-semibold">站点名称</th>
                                <th class="px-6 py-3 font-semibold">状态</th>
                                <th class="px-6 py-3 font-semibold">经纬度</th>
                                <th class="px-6 py-3 font-semibold text-right">定位</th>
                            </tr>
                        </thead>
                        <tbody id="station-table-body" class="divide-y divide-slate-100 text-sm">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <!-- Station Detail Modal -->
    <div id="station-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm transform transition-all scale-100">
            <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
                <h3 class="text-base font-bold text-slate-800" id="modal-title">站点详情</h3>
                <button onclick="app.closeModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fa-solid fa-times text-lg"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <span id="modal-status-badge" class="px-3 py-1 text-sm rounded-full font-bold shadow-sm"></span>
                </div>
                <div class="flex items-start">
                    <i class="fa-solid fa-map-pin mt-1 text-slate-400 w-5"></i>
                    <div>
                        <p class="text-xs text-slate-400">坐标信息</p>
                        <p class="text-slate-800 font-mono text-sm select-all" id="modal-coords">--</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-slate-100 flex justify-end">
                <button onclick="app.navigateToStationFromModal()" class="w-full px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 shadow-sm text-sm">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA SOURCE (72 STATIONS) ---
        const allStations = [
            // Data 10
            { id: 1, name: "绿新能源潞铁智慧物流园园区内（换电站）", coord: "113.28292,36.325017", status: "已投运" },
            { id: 2, name: "绿新能源黄北充电站", coord: "113.134684,36.357572", status: "已投运" },
            { id: 3, name: "绿新能源涉县神头充电站", coord: "113.598247,36.519466", status: "已投运" },
            { id: 4, name: "绿新能源石梁充电站", coord: "113.318021,36.453537", status: "已投运" },
            { id: 5, name: "绿新能源坡底充电站", coord: "113.08529,36.341152", status: "已投运" },
            { id: 6, name: "绿新能源史廻汽贸园充电站", coord: "113.157286,36.349615", status: "已投运" },
            { id: 7, name: "绿新能源南王庄充电站（上党区琚家沟）", coord: "113.054248,36.03518", status: "已投运" },
            { id: 8, name: "绿新能源店上充电站1期", coord: "113.274594,35.989891", status: "已投运" },
            { id: 9, name: "绿新能源武乡蟠龙充电站", coord: "113.134701,36.787052", status: "已投运" },
            { id: 10, name: "绿新能源灵石充电站", coord: "111.721147,36.822618", status: "已投运" },
            // Data 20
            { id: 11, name: "绿新能源沁源交口充电站1期", coord: "112.381101,36.583089", status: "已投运" },
            { id: 12, name: "中石化屯留常村加油站", coord: "112.989419,36.356389", status: "已投运" },
            { id: 13, name: "中石化长治县中村加油站", coord: "113.102902,36.000628", status: "已投运" },
            { id: 14, name: "中石化沁县漫水加油站", coord: "112.56382,36.699023", status: "已投运" },
            { id: 15, name: "中石化沁县松村加油站", coord: "112.771153,36.830392", status: "已投运" },
            { id: 16, name: "中石化沁县金源加油站(沁县新店镇东庄村)", coord: "112.747043,36.645132", status: "已投运" },
            { id: 17, name: "中石化长治县荫城加油站（上党区荫城长陵公路旁）", coord: "113.0645, 35.9712", status: "已投运" },
            { id: 18, name: "山东省德州市永锋钢铁", coord: "116.821125,36.794975", status: "已投运" },
            { id: 19, name: "山东省东阿县", coord: "116.284198,36.369041", status: "已投运" },
            { id: 20, name: "绿新能源襄汾永固充电站（襄汾县永固乡南董村）", coord: "111.345216,35.721279", status: "已投运" }, 
            // Data 30
            { id: 21, name: "绿新能源阳城凤城充电站（阳城县凤城镇下孔寨村）", coord: "112.500327,35.482223", status: "已投运" },
            { id: 22, name: "林州任村镇", coord: "113.808103,36.335749", status: "已投运" },
            { id: 23, name: "中石化长治上党区东苗闲置空地", coord: "113.07947,36.07138", status: "已投运" },
            { id: 24, name: "绿新能源李村煤矿充电站", coord: "112.870029,36.087228", status: "建设中" },
            { id: 25, name: "绿新能源潞光电厂充电站", coord: "113.0245, 36.5312", status: "建设中" },
            { id: 26, name: "绿新能源沁县定昌充电站", coord: "112.704547,36.769299", status: "建设中" },
            { id: 27, name: "绿新能源武安瑞斌充电站", coord: "114.101399,36.607907", status: "建设中" },
            { id: 28, name: "绿新能源襄垣百顺充电站", coord: "113.0344, 36.5292", status: "建设中" },
            { id: 29, name: "绿新能源荫城镇化肥厂充、换电站", coord: "112.614498,37.723722", status: "建设中" },
            { id: 30, name: "绿新能源长信钢铁充电站", coord: "113.124089,36.326081", status: "建设中" }, 
            // Data 40
            { id: 31, name: "绿新能源长子东旺充电站", coord: "112.973233,36.050637", status: "建设中" },
            { id: 32, name: "绿新能源店上充电站2期", coord: "113.111766,35.957182", status: "建设中" },
            { id: 33, name: "绿新能源西村果园充电站1期", coord: "113.219017,36.344992", status: "建设中" },
            { id: 34, name: "绿新能源西村果园充电站2期", coord: "112.159847,36.53785", status: "建设中" },
            { id: 35, name: "绿新能源沁源灵空山充电站", coord: "111.72112,36.822525", status: "建设中" },
            { id: 36, name: "绿新能源沁源交口充电站2期", coord: "112.22086,36.412308", status: "建设中" },
            { id: 37, name: "绿新能源沁源百草充电站", coord: "112.195833,36.837221", status: "建设中" },
            { id: 38, name: "绿新能源襄垣王桥充电站", coord: "113.06832,36.501125", status: "建设中" },
            { id: 39, name: "绿新能源襄垣下良充电站", coord: "113.0486, 36.6547", status: "建设中" },
            { id: 40, name: "绿新能源济源涛翔充电站", coord: "112.5735, 35.0876", status: "建设中" },
            // Data 50
            { id: 41, name: "中石化长子县东田良加油站（慈林镇东田良村）", coord: "112.934617,36.001732", status: "建设中" },
            { id: 42, name: "中石化黎城县仵桥加油站（黎城县黎侯镇仵桥村）", coord: "113.3845, 36.5021", status: "建设中" },
            { id: 43, name: "介休市义安镇", coord: "111.948054,36.985047", status: "建设中" },
            { id: 44, name: "孝义市柱濮镇上智峪村", coord: "111.691507,37.075799", status: "建设中" },
            { id: 45, name: "晋城市泽州县巴公镇", coord: "112.912409,35.609078", status: "建设中" },
            { id: 46, name: "安阳利源", coord: "114.344815,36.150114", status: "建设中" },
            { id: 47, name: "洪洞甘亭镇", coord: "111.672237,36.179187", status: "建设中" },
            { id: 48, name: "林州河顺镇杨家营村", coord: "113.901521,36.141551", status: "建设中" },
            { id: 49, name: "晋城市泽州县大东沟镇", coord: "112.720088,35.587986", status: "建设中" },
            { id: 50, name: "左权下其至村", coord: "113.447107,37.165597", status: "建设中" }, 
            // Data 60
            { id: 51, name: "孝义市东董屯村（原昆仑加气站）", coord: "111.84799,37.044294", status: "建设中" },
            { id: 52, name: "邯郸峰峰矿区", coord: "114.212571,36.419298", status: "建设中" },
            { id: 53, name: "安阳龙安区", coord: "114.277317,36.077565", status: "建设中" },
            { id: 54, name: "曲沃乐昌镇", coord: "111.4633, 35.6414", status: "建设中" },
            { id: 55, name: "林州市河顺镇", coord: "113.832267,36.061732", status: "建设中" },
            { id: 56, name: "长治市武乡县", coord: "112.8603, 36.8325", status: "建设中" },
            { id: 57, name: "河南省鹤壁市山城区", coord: "114.309267,35.769397", status: "建设中" },
            { id: 58, name: "晋城市阳城县北任庄村", coord: "112.368608,35.520231", status: "建设中" },
            { id: 59, name: "焦作市武陟县", coord: "113.515695,35.136367", status: "建设中" },
            { id: 60, name: "焦作市沁阳市", coord: "113.56127,34.819137", status: "建设中" },
            // Data 70
            { id: 61, name: "山东省平阴县", coord: "116.4385, 36.2876", status: "建设中" },
            { id: 62, name: "山东省临沂市莒南县", coord: "118.8325, 35.1746", status: "建设中" },
            { id: 63, name: "山东省聊城市冠县", coord: "115.441684,36.484011", status: "建设中" },
            { id: 64, name: "甘肃省张掖市高台县骆驼城镇", coord: "99.814300, 39.345600", status: "建设中" },
            { id: 65, name: "张掖市山丹县老君乡峡口新村", coord: "101.092100, 38.784500", status: "建设中" },
            { id: 66, name: "张掖市临泽县金沙港物流院内", coord: "100.131691,39.131125", status: "建设中" },
            { id: 67, name: "酒泉市玉门市顶好服务区", coord: "97.107543,40.243142", status: "建设中" },
            { id: 68, name: "山东省日照市东港区陈疃镇", coord: "119.26641,35.505228", status: "建设中" },
            { id: 69, name: "山东省聊城市冠县23站", coord: "115.8838,36.43048", status: "建设中" },
            { id: 70, name: "山东省泰安市肥城市桃源镇", coord: "116.63859,36.145948", status: "建设中" },
            { id: 71, name: "甘肃省嘉峪关市", coord: "98.289200, 39.773100", status: "建设中" },
            { id: 72, name: "山东省蒙阴县", coord: "118.645613,35.745408", status: "建设中" }
        ];

        // Process Coordinates
        allStations.forEach(s => {
            const parts = s.coord.split(',');
            s.lng = parseFloat(parts[0]);
            s.lat = parseFloat(parts[1]);
        });

        // --- APP LOGIC ---
        const app = {
            state: {
                currentView: 'map', 
                filterText: '',
                mapInitialized: false,
                mapInstance: null,
                selectedStation: null
            },

            init: function() {
                // Update Total Count
                document.getElementById('count-active').innerText = allStations.filter(s => s.status === '已投运').length;
                document.getElementById('count-construction').innerText = allStations.filter(s => s.status === '建设中').length;

                this.renderList();
                this.setupEventListeners();
                
                setTimeout(() => this.initMap(), 100);
            },

            navigate: function(viewId) {
                this.state.currentView = viewId;

                document.querySelectorAll('.nav-item').forEach(el => {
                    el.classList.remove('active-nav');
                    el.classList.add('text-slate-600');
                    if(el.id === `nav-${viewId}`) {
                        el.classList.add('active-nav');
                        el.classList.remove('text-slate-600');
                    }
                });

                ['map', 'list'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
                document.getElementById('main-header').classList.add('hidden');
                
                const activeEl = document.getElementById(`view-${viewId}`);
                activeEl.classList.remove('hidden');

                if (viewId === 'list') {
                    document.getElementById('main-header').classList.remove('hidden');
                }

                if (viewId === 'map' && !this.state.mapInitialized) {
                    this.initMap();
                }
            },

            handleSearch: function(text) {
                this.state.filterText = text.toLowerCase();
                this.renderList();
            },

            renderList: function() {
                const tbody = document.getElementById('station-table-body');
                tbody.innerHTML = '';
                
                const filtered = allStations.filter(s => 
                    s.name.toLowerCase().includes(this.state.filterText)
                );

                filtered.forEach(s => {
                    let statusClass = 'status-badge-construction';
                    if (s.status === '已投运') statusClass = 'status-badge-active';
                    
                    const row = `
                        <tr class="hover:bg-slate-50 transition-colors border-b border-slate-100">
                            <td class="px-6 py-4 text-slate-500 font-mono text-xs">#${s.id}</td>
                            <td class="px-6 py-4 font-medium text-slate-700">${s.name}</td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 text-xs rounded-full font-medium ${statusClass}">${s.status}</span>
                            </td>
                            <td class="px-6 py-4 text-slate-400 font-mono text-xs">
                                ${s.lng.toFixed(4)}, ${s.lat.toFixed(4)}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="app.locateStation(${s.id})" class="text-white bg-teal-600 hover:bg-teal-700 font-medium text-xs px-3 py-2 rounded shadow-sm transition-colors flex items-center ml-auto">
                                    <i class="fa-solid fa-location-arrow mr-1"></i> 定位
                                </button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            },

            initMap: function() {
                if (typeof BMap === 'undefined') {
                    console.error("Baidu Map API missing.");
                    return;
                }
                
                if (this.state.mapInitialized) return;

                const map = new BMap.Map("baiduMap");
                const centerPoint = new BMap.Point(113.0, 36.5); 
                map.centerAndZoom(centerPoint, 7); 
                map.enableScrollWheelZoom(true);
                map.addControl(new BMap.NavigationControl());
                map.addControl(new BMap.ScaleControl());

                allStations.forEach(s => {
                    const point = new BMap.Point(s.lng, s.lat);
                    
                    // --- Custom Colored Vector Icon ---
                    const color = s.status === '已投运' ? '#22c55e' : '#f97316'; // Green-500 vs Orange-500
                    
                    const vectorMarker = new BMap.Symbol(BMap_Symbol_SHAPE_POINT, {
                        scale: 1.5, // Larger size
                        fillColor: color,
                        fillOpacity: 1,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    });

                    const marker = new BMap.Marker(point, {
                        icon: vectorMarker
                    });
                    
                    marker.addEventListener("click", () => {
                        this.openStationModal(s);
                    });

                    map.addOverlay(marker);
                    s.markerRef = marker;
                });

                this.state.mapInstance = map;
                this.state.mapInitialized = true;
            },

            locateStation: function(id) {
                const s = allStations.find(station => station.id === id);
                if (!s) return;

                this.navigate('map');
                
                // Ensure map is ready
                if (this.state.mapInstance) {
                    setTimeout(() => {
                        const point = new BMap.Point(s.lng, s.lat);
                        this.state.mapInstance.centerAndZoom(point, 12); // Closer zoom
                        this.openStationModal(s);
                        
                        // Bounce Animation
                        if(s.markerRef) {
                            s.markerRef.setAnimation(BMAP_ANIMATION_BOUNCE);
                            setTimeout(() => s.markerRef.setAnimation(null), 3000);
                        }
                    }, 300);
                }
            },

            openStationModal: function(s) {
                document.getElementById('modal-title').innerText = s.name;
                
                const badge = document.getElementById('modal-status-badge');
                badge.innerText = s.status;
                
                if (s.status === '已投运') {
                    badge.className = "px-3 py-1 text-sm rounded-full font-bold shadow-sm bg-green-500 text-white";
                } else {
                    badge.className = "px-3 py-1 text-sm rounded-full font-bold shadow-sm bg-orange-500 text-white";
                }
                
                document.getElementById('modal-coords').innerText = `${s.lng}, ${s.lat}`;
                document.getElementById('station-modal').classList.remove('hidden');
            },

            closeModal: function() {
                document.getElementById('station-modal').classList.add('hidden');
            },

            navigateToStationFromModal: function() {
                this.closeModal();
            },

            filterMap: function(type) {
                // Simple visual filter (In a full app this would toggle overlay visibility)
                alert("已筛选视图: " + type);
            },

            setupEventListeners: function() {
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') this.closeModal();
                });
            }
        };

        // Boot
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>
