<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6214772877334340"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOS - Energy Operation Wise | 本体论新能源集控平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Orbitron Font for Dashboard Numbers -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #030712; /* Very Dark Blue/Gray */
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        .font-sci { font-family: 'Orbitron', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(17, 24, 39, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.15);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Status Indicators */
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
        .status-ok { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-warn { background-color: #f59e0b; box-shadow: 0 0 8px #f59e0b; }
        .status-err { background-color: #ef4444; box-shadow: 0 0 8px #ef4444; }
        .status-off { background-color: #6b7280; }

        /* Animations */
        @keyframes pulse-border {
            0% { border-color: rgba(56, 189, 248, 0.3); }
            50% { border-color: rgba(56, 189, 248, 0.8); }
            100% { border-color: rgba(56, 189, 248, 0.3); }
        }
        .border-pulse { animation: pulse-border 2s infinite; }

        /* Grid Lines Background */
        .bg-grid {
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col bg-grid">

    <!-- TOP HEADER: Global KPIs -->
    <header class="h-16 glass-panel border-b border-sky-900/30 flex justify-between items-center px-6 z-30 shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-sky-600 rounded flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-sky-500/20">
                <i class="fa-solid fa-bolt"></i>
            </div>
            <div>
                <h1 class="text-xl font-sci font-bold tracking-wider text-white">EOS <span class="text-sky-400 text-sm">PLATFORM</span></h1>
                <p class="text-[10px] text-slate-400 uppercase tracking-widest">Ontology-Driven Energy Operation</p>
            </div>
        </div>

        <!-- Global Real-time Metrics -->
        <div class="flex gap-8">
            <div class="text-right">
                <div class="text-[10px] text-slate-500 uppercase font-bold">Total Capacity (GW)</div>
                <div class="text-xl font-sci text-white font-bold">28.5 <span class="text-xs text-slate-500">GW</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold">Real-time Power</div>
                <div class="text-xl font-sci text-emerald-400 font-bold">18.24 <span class="text-xs text-slate-500">GW</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold">Day Generation</div>
                <div class="text-xl font-sci text-sky-400 font-bold">145.2 <span class="text-xs text-slate-500">GWh</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold">Carbon Reduced</div>
                <div class="text-xl font-sci text-teal-400 font-bold">89,402 <span class="text-xs text-slate-500">Tons</span></div>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <div class="text-right mr-2">
                <div class="text-xs text-slate-300 font-bold">Operator: ADMIN</div>
                <div class="text-[10px] text-emerald-500">SECURE CONNECTION</div>
            </div>
            <img src="https://api.dicebear.com/9.x/avataaars/svg?seed=Felix" class="w-10 h-10 rounded-full border-2 border-slate-600">
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- LEFT: ONTOLOGY ASSET TREE -->
        <aside class="w-72 glass-panel border-r border-slate-800 flex flex-col z-20">
            <!-- Search Header -->
            <div class="p-4 border-b border-slate-800 bg-slate-900/50 shrink-0">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xs font-bold text-slate-300 uppercase tracking-wider"><i class="fa-solid fa-sitemap mr-2"></i>Asset Ontology</h2>
                    <span class="bg-sky-900/30 text-sky-400 text-[10px] px-2 py-0.5 rounded border border-sky-800">25 Sites</span>
                </div>
                <input type="text" placeholder="Search Asset ID..." class="w-full bg-slate-950 border border-slate-700 rounded px-3 py-1.5 text-xs text-slate-300 focus:border-sky-500 outline-none transition-colors">
            </div>

            <!-- Asset Tree (Flex 1) -->
            <div class="flex-1 overflow-y-auto p-2 space-y-1 text-sm" id="asset-tree">
                <!-- Dynamic Content Injected by JS -->
            </div>

            <!-- Mini Alert Log (Fixed Height) -->
            <div class="h-40 border-t border-slate-800 bg-slate-900/30 flex flex-col shrink-0">
                <div class="p-3 border-b border-slate-800 flex justify-between items-center shrink-0">
                    <span class="text-[10px] font-bold text-red-400 uppercase">Active Alerts (3)</span>
                    <i class="fa-solid fa-bell text-slate-500 text-xs"></i>
                </div>
                <div class="flex-1 overflow-y-auto p-2 space-y-2">
                    <div class="bg-red-900/20 border border-red-900/50 p-2 rounded hover:bg-red-900/30 cursor-pointer transition-colors">
                        <div class="flex justify-between text-[10px] text-red-300 font-bold">
                            <span><i class="fa-solid fa-triangle-exclamation mr-1"></i>INV-04 Fault</span>
                            <span>10:42</span>
                        </div>
                        <div class="text-[10px] text-slate-400 mt-1">PV Base #3: Inverter efficiency drop > 15%.</div>
                    </div>
                    <div class="bg-amber-900/20 border border-amber-900/50 p-2 rounded">
                        <div class="flex justify-between text-[10px] text-amber-300 font-bold">
                            <span><i class="fa-solid fa-wind mr-1"></i>High Wind Cutout</span>
                            <span>10:15</span>
                        </div>
                        <div class="text-[10px] text-slate-400 mt-1">Offshore #1: 12 Turbines paused.</div>
                    </div>
                </div>
            </div>

            <!-- FOOTER: LOGO & CREDIT -->
            <div class="p-4 border-t border-slate-800 bg-slate-900/80 flex flex-col items-center justify-center shrink-0">
                <img src="https://globalbusinessinsight.github.io/picture/inossem_logo.svg" alt="Inossem Logo" class="w-24 opacity-80 mb-1">
                <div class="w-20 border-t border-slate-700/50 mt-1 pt-1 text-[8px] text-slate-500 text-center font-mono uppercase tracking-tighter">
                    Design by Paul
                </div>
            </div>
        </aside>

        <!-- CENTER: DIGITAL TWIN CANVAS (MAP) -->
        <main class="flex-1 relative bg-[#02040a]">
            <div class="absolute top-4 left-4 z-10 flex gap-2">
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-white hover:border-sky-500 transition-colors border border-transparent" onclick="setMapMode('ALL')">All Assets</button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-sky-400 hover:border-sky-500 transition-colors border border-transparent" onclick="setMapMode('WIND')"><i class="fa-solid fa-wind mr-1"></i>Wind</button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-yellow-400 hover:border-yellow-500 transition-colors border border-transparent" onclick="setMapMode('SOLAR')"><i class="fa-solid fa-sun mr-1"></i>Solar</button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-purple-400 hover:border-purple-500 transition-colors border border-transparent" onclick="setMapMode('STORAGE')"><i class="fa-solid fa-battery-full mr-1"></i>Storage</button>
            </div>

            <canvas id="mapCanvas" class="block w-full h-full cursor-crosshair"></canvas>

            <!-- Bottom Overlay: Grid Interaction -->
            <div class="absolute bottom-6 left-6 right-[420px] h-32 glass-panel rounded-lg p-4 flex gap-6 z-10">
                 <!-- Grid Dispatch -->
                 <div class="flex-1 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xs font-bold text-slate-300 uppercase"><i class="fa-solid fa-tower-broadcast mr-1"></i>Grid Dispatch (AGC)</h3>
                        <span class="text-[10px] bg-emerald-900/50 text-emerald-400 px-1.5 py-0.5 rounded">COMPLIANT</span>
                    </div>
                    <div class="flex items-end gap-4">
                        <div>
                            <div class="text-[10px] text-slate-500">Target (MW)</div>
                            <div class="text-2xl font-sci text-white">18,200</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-500">Actual (MW)</div>
                            <div class="text-2xl font-sci text-emerald-400">18,240</div>
                        </div>
                        <div class="h-8 w-px bg-slate-700"></div>
                        <div>
                            <div class="text-[10px] text-slate-500">Freq (Hz)</div>
                            <div class="text-lg font-mono text-slate-300">50.02</div>
                        </div>
                    </div>
                    <!-- Progress bar for dispatch accuracy -->
                    <div class="w-full bg-slate-800 h-1.5 rounded-full mt-2 overflow-hidden">
                        <div class="bg-emerald-500 h-full w-[99%]"></div>
                    </div>
                 </div>

                 <!-- Spot Market -->
                 <div class="w-1/3 border-l border-slate-700 pl-6 flex flex-col justify-between">
                    <h3 class="text-xs font-bold text-slate-300 uppercase"><i class="fa-solid fa-chart-line mr-1"></i>Spot Market</h3>
                    <div class="flex justify-between items-end">
                        <div>
                            <div class="text-[10px] text-slate-500">Real-time Price</div>
                            <div class="text-xl font-mono text-yellow-400">¥ 0.42 <span class="text-xs text-slate-500">/kWh</span></div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-slate-500">Next 15m Pred.</div>
                            <div class="text-sm font-mono text-slate-300">¥ 0.38 <i class="fa-solid fa-arrow-trend-down text-red-400 ml-1"></i></div>
                        </div>
                    </div>
                    <button class="w-full bg-indigo-600/20 hover:bg-indigo-600/40 border border-indigo-500/50 text-indigo-300 text-[10px] py-1 rounded mt-1 transition-colors">
                        AI Trading Strategy: HOLD
                    </button>
                 </div>
            </div>
        </main>

        <!-- RIGHT: DEEP DIVE PANEL (Ontology Details) -->
        <aside class="w-[400px] glass-panel border-l border-slate-800 flex flex-col z-20 transition-transform duration-300" id="detailPanel">
            <!-- Header: Dynamic based on selection -->
            <div class="h-16 border-b border-slate-800 p-4 flex items-center gap-3 bg-slate-900/80 shrink-0">
                <div class="w-10 h-10 rounded-lg bg-sky-500/10 border border-sky-500/30 flex items-center justify-center text-sky-400 text-lg" id="detail-icon">
                    <i class="fa-solid fa-wind"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-sm font-bold text-white" id="detail-title">Select an Asset</h2>
                    <div class="flex items-center gap-2">
                        <span class="status-dot status-ok" id="detail-status-dot"></span>
                        <span class="text-[10px] text-slate-400 font-mono" id="detail-id">--</span>
                    </div>
                </div>
                <button class="text-slate-500 hover:text-white"><i class="fa-solid fa-expand"></i></button>
            </div>

            <!-- Content Tabs -->
            <div class="flex-1 overflow-y-auto custom-scrollbar">
                
                <!-- Section 1: Real-time Telemetry -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3">Real-time Telemetry</h3>
                    <div class="grid grid-cols-2 gap-3" id="telemetry-grid">
                        <!-- Injected JS -->
                        <div class="bg-slate-800/50 p-2 rounded border border-slate-700">
                            <div class="text-[9px] text-slate-500">Active Power</div>
                            <div class="text-lg font-mono text-white">-- MW</div>
                        </div>
                        <div class="bg-slate-800/50 p-2 rounded border border-slate-700">
                            <div class="text-[9px] text-slate-500">Reactive Power</div>
                            <div class="text-lg font-mono text-slate-300">-- MVar</div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Environment -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3">Environmental Data</h3>
                    <div class="bg-gradient-to-r from-slate-800/50 to-slate-900/50 p-3 rounded border border-slate-700 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-cloud-sun text-xl text-sky-300"></i>
                            <div>
                                <div class="text-xs text-white font-bold">Partly Cloudy</div>
                                <div class="text-[10px] text-slate-400">Wind: 8.4 m/s NE</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-mono text-white">24°C</div>
                            <div class="text-[10px] text-slate-400">Hum: 65%</div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Ontology Relations (Links) -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3">Ontology Relations</h3>
                    <div class="space-y-2" id="ontology-links">
                        <!-- Example -->
                        <div class="flex items-center gap-2 text-xs text-slate-300">
                            <i class="fa-solid fa-link text-slate-600"></i>
                            <span class="bg-slate-800 px-1.5 py-0.5 rounded text-[10px]">BELONGS_TO</span>
                            <span class="text-sky-400">Offshore Field A</span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-slate-300">
                            <i class="fa-solid fa-arrow-right text-emerald-600"></i>
                            <span class="bg-slate-800 px-1.5 py-0.5 rounded text-[10px]">FEEDS</span>
                            <span class="text-purple-400">Hydrogen Station Alpha</span>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Asset Management & Health -->
                <div class="p-4 border-b border-slate-800">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-[10px] font-bold text-slate-500 uppercase">Asset Health (AI Prediction)</h3>
                        <span class="bg-emerald-900/30 text-emerald-400 text-[9px] px-1.5 py-0.5 rounded border border-emerald-800">HEALTHY</span>
                    </div>
                    <!-- Health Gauge Chart Container -->
                    <div class="h-32 w-full">
                        <canvas id="healthChart"></canvas>
                    </div>
                    <div class="mt-3 space-y-2">
                         <div class="flex justify-between text-[10px]">
                            <span class="text-slate-400">Component: Gearbox</span>
                            <span class="text-white">Est. RUL: 1,200 Days</span>
                         </div>
                         <div class="w-full bg-slate-800 h-1 rounded-full">
                             <div class="bg-emerald-500 h-full w-3/4"></div>
                         </div>
                    </div>
                </div>

                <!-- Section 5: Financials -->
                <div class="p-4">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3">Metering & Billing</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800/30 p-2 rounded border border-slate-700/50">
                            <div class="text-[9px] text-slate-500">Meter Reading</div>
                            <div class="text-sm font-mono text-white">4,291,002 kWh</div>
                        </div>
                        <div class="bg-slate-800/30 p-2 rounded border border-slate-700/50">
                            <div class="text-[9px] text-slate-500">Settled (Mtd)</div>
                            <div class="text-sm font-mono text-emerald-400">¥ 1.82 M</div>
                        </div>
                    </div>
                    <!-- Direct Supply Tag -->
                    <div class="mt-2 bg-indigo-900/20 border border-indigo-500/30 p-2 rounded hidden" id="direct-supply-badge">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-plug-circle-bolt text-indigo-400"></i>
                            <span class="text-[10px] text-indigo-200 font-bold">Direct Supply Protocol Active</span>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Footer Actions -->
            <div class="p-4 bg-slate-900 border-t border-slate-800 flex gap-2 shrink-0">
                <button class="flex-1 bg-sky-600 hover:bg-sky-500 text-white text-xs font-bold py-2 rounded transition-colors">
                    <i class="fa-solid fa-wrench mr-1"></i> Work Order
                </button>
                <button class="flex-1 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-bold py-2 rounded transition-colors">
                    <i class="fa-solid fa-file-waveform mr-1"></i> Full Report
                </button>
            </div>
        </aside>

    </div>

    <script>
        /** * EOS DEMO LOGIC 
         * 1. Ontology Data Structure
         * 2. Canvas Map Animation
         * 3. Interaction Handling
         */

        // --- 1. DATA GENERATION (Based on Prompt) ---
        const ontology = {
            offshore: [
                { id: 'OWF-01', name: 'Offshore Alpha (Grid)', cap: 500, turbines: 50, turbineType: '10MW', type: 'grid', lat: 0.15, lon: 0.7 },
                { id: 'OWF-02', name: 'Offshore Beta (H2)', cap: 500, turbines: 50, turbineType: '10MW', type: 'hydrogen', lat: 0.25, lon: 0.8 }
            ],
            onshore: Array.from({length: 18}, (_, i) => ({
                id: `ONF-${String(i+1).padStart(2, '0')}`,
                name: `Onshore Field ${String.fromCharCode(65+i)}`,
                cap: 200 * ((1/3*9) + (1/3*6) + (1/3*1.5)), // Approx calc
                turbines: 200,
                mix: '9MW/6MW/1.5MW',
                lat: 0.4 + Math.random()*0.5,
                lon: 0.1 + Math.random()*0.5,
                type: 'grid'
            })),
            solar: [
                { id: 'PV-01', name: 'PV Base Sol (Direct)', cap: 1000, type: 'direct', lat: 0.8, lon: 0.2 },
                { id: 'PV-02', name: 'PV Base Luna', cap: 1000, type: 'grid', lat: 0.7, lon: 0.3 },
                { id: 'PV-03', name: 'PV Base Terra', cap: 1000, type: 'grid', lat: 0.75, lon: 0.4 },
                { id: 'PV-04', name: 'PV Base Mars', cap: 1000, type: 'grid', lat: 0.85, lon: 0.3 },
                { id: 'PV-05', name: 'PV Base Jupiter', cap: 1000, type: 'grid', lat: 0.8, lon: 0.5 }
            ]
        };

        // Calculate specific total cap roughly
        // Onshore field cap approx: 66*9 + 67*6 + 67*1.5 = 594 + 402 + 100.5 = ~1100 MW per field. 
        // 18 fields * 1.1GW = 19.8 GW. 
        // Offshore: 1GW. 
        // Solar: 5GW. 
        // Total ~26GW. Matches header.

        // --- 2. UI POPULATION ---
        const treeContainer = document.getElementById('asset-tree');
        
        function createTreeItem(icon, title, sub, id, colorClass, clickFn) {
            const div = document.createElement('div');
            div.className = 'flex items-center p-2 hover:bg-slate-800 rounded cursor-pointer group transition-colors';
            div.onclick = clickFn;
            div.innerHTML = `
                <div class="w-8 h-8 rounded bg-slate-800 group-hover:bg-slate-700 flex items-center justify-center text-slate-400 ${colorClass} transition-colors mr-3">
                    <i class="${icon}"></i>
                </div>
                <div class="flex-1">
                    <div class="text-xs font-bold text-slate-200">${title}</div>
                    <div class="text-[10px] text-slate-500">${sub}</div>
                </div>
                <div class="status-dot status-ok"></div>
            `;
            return div;
        }

        // Populate Sidebar
        // 1. Offshore
        const offHeader = document.createElement('div');
        offHeader.className = 'text-[10px] font-bold text-sky-500 uppercase px-2 mt-2 mb-1';
        offHeader.innerText = 'Offshore Wind (2)';
        treeContainer.appendChild(offHeader);
        ontology.offshore.forEach(f => {
            treeContainer.appendChild(createTreeItem('fa-solid fa-water', f.name, `${f.turbines} Turbines | ${f.type === 'hydrogen' ? 'H2 Off-grid' : 'Grid'}`, f.id, 'text-sky-400', () => selectAsset(f, 'offshore')));
        });

        // 2. Onshore
        const onHeader = document.createElement('div');
        onHeader.className = 'text-[10px] font-bold text-emerald-500 uppercase px-2 mt-4 mb-1';
        onHeader.innerText = 'Onshore Wind (18)';
        treeContainer.appendChild(onHeader);
        ontology.onshore.slice(0, 5).forEach(f => { // Show first 5 only for demo
            treeContainer.appendChild(createTreeItem('fa-solid fa-wind', f.name, 'Mixed Turbines (1.5/6/9MW)', f.id, 'text-emerald-400', () => selectAsset(f, 'onshore')));
        });
        const moreOn = document.createElement('div');
        moreOn.className = 'text-[10px] text-slate-600 px-2 italic';
        moreOn.innerText = '+ 13 more fields...';
        treeContainer.appendChild(moreOn);

        // 3. Solar
        const solHeader = document.createElement('div');
        solHeader.className = 'text-[10px] font-bold text-yellow-500 uppercase px-2 mt-4 mb-1';
        solHeader.innerText = 'PV Bases (5)';
        treeContainer.appendChild(solHeader);
        ontology.solar.forEach(f => {
            treeContainer.appendChild(createTreeItem('fa-solid fa-sun', f.name, `${f.cap} MW | ${f.type === 'direct' ? 'Direct Supply' : 'Grid'}`, f.id, 'text-yellow-400', () => selectAsset(f, 'solar')));
        });


        // --- 3. CANVAS MAP VISUALIZATION ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Particles for Energy Flow
        let particles = [];
        
        function drawMap() {
            ctx.fillStyle = '#02040a';
            ctx.fillRect(0, 0, width, height);

            // Draw Coastline (Conceptual)
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(width * 0.6, 0);
            ctx.bezierCurveTo(width * 0.5, height * 0.3, width * 0.8, height * 0.6, width * 0.6, height);
            ctx.stroke();

            // Grid Hub (Center)
            const hubX = width * 0.5;
            const hubY = height * 0.5;
            
            // Draw Assets
            // Offshore (Right side)
            ontology.offshore.forEach((o, i) => {
                const x = width * (0.7 + o.lon * 0.2);
                const y = height * (0.1 + o.lat * 0.8);
                drawNode(x, y, 'blue', o.type === 'hydrogen' ? 'H2' : 'GRID', o.name);
                
                // Link
                if (o.type === 'grid') drawLink(x, y, hubX, hubY, 'blue');
                else {
                    // H2 Station
                    const h2X = x + 40, h2Y = y + 40;
                    drawNode(h2X, h2Y, 'purple', 'H2 PLANT', 'Electrolyzer');
                    drawLink(x, y, h2X, h2Y, 'cyan'); // Power to H2
                }
                
                if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: 'cyan', life: 1});
            });

            // Solar (Left Top)
            ontology.solar.forEach((o, i) => {
                const x = width * (0.1 + o.lon * 0.3);
                const y = height * (0.1 + o.lat * 0.3);
                drawNode(x, y, 'yellow', 'PV', o.name);

                if (o.type === 'grid') {
                    drawLink(x, y, hubX, hubY, 'yellow');
                    if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: '#facc15', life: 1});
                } else {
                    // Direct Supply (Chemical Plant)
                    const chemX = x - 50, chemY = y + 50;
                    drawNode(chemX, chemY, 'white', 'LOAD', 'Chem Plant / Truck Chg');
                    drawLink(x, y, chemX, chemY, 'orange'); // Direct
                    // Storage
                    drawNode(x, y + 30, 'purple', 'BESS', 'Storage');
                }
            });

            // Onshore (Left Bottom)
            ontology.onshore.slice(0, 8).forEach((o, i) => { // Sample
                const x = width * (0.05 + o.lon * 0.4);
                const y = height * (0.5 + o.lat * 0.4);
                drawNode(x, y, 'green', 'WIND', o.name.split(' ')[2]); // Short name
                drawLink(x, y, hubX, hubY, 'green');
                if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: '#34d399', life: 1});
            });

            // Draw Hub
            ctx.fillStyle = '#1e293b';
            ctx.beginPath(); ctx.arc(hubX, hubY, 20, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#38bdf8'; ctx.lineWidth = 2; ctx.stroke();
            ctx.fillStyle = '#fff'; ctx.font = '10px Inter'; ctx.textAlign='center'; ctx.fillText('MAIN GRID', hubX, hubY+4);

            // Animate Particles
            particles.forEach((p, i) => {
                p.x += (p.tx - p.x) * 0.02;
                p.y += (p.ty - p.y) * 0.02;
                p.life -= 0.01;
                
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
                if (p.life <= 0) particles.splice(i, 1);
            });

            requestAnimationFrame(drawMap);
        }

        function drawNode(x, y, color, type, label) {
            let c = '#fff';
            if (color === 'blue') c = '#0ea5e9';
            if (color === 'green') c = '#10b981';
            if (color === 'yellow') c = '#facc15';
            if (color === 'purple') c = '#a855f7';

            // Glow
            const g = ctx.createRadialGradient(x, y, 2, x, y, 20);
            g.addColorStop(0, c);
            g.addColorStop(1, 'transparent');
            ctx.fillStyle = g;
            ctx.globalAlpha = 0.3;
            ctx.beginPath(); ctx.arc(x, y, 20, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;

            // Core
            ctx.fillStyle = '#0f172a';
            ctx.strokeStyle = c;
            ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI*2); ctx.fill(); ctx.stroke();

            // Label
            ctx.fillStyle = '#94a3b8';
            ctx.font = '9px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, y + 15);
            
            // Type Tag
            ctx.fillStyle = c;
            ctx.font = 'bold 8px Inter';
            ctx.fillText(type, x, y - 10);
        }

        function drawLink(x1, y1, x2, y2, color) {
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
            ctx.setLineDash([]);
        }

        drawMap();

        // --- 4. INTERACTION LOGIC (RIGHT PANEL) ---
        
        // Chart.js instance for Asset Health
        let healthChartInstance = null;

        function initChart() {
            const ctxChart = document.getElementById('healthChart').getContext('2d');
            healthChartInstance = new Chart(ctxChart, {
                type: 'doughnut',
                data: {
                    labels: ['Healthy', 'Warning', 'Critical'],
                    datasets: [{
                        data: [95, 4, 1],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { display: true, position: 'right', labels: { color: '#94a3b8', font: { size: 9 } } }
                    }
                }
            });
        }
        initChart();

        function selectAsset(data, category) {
            // Update Header
            document.getElementById('detail-title').innerText = data.name;
            document.getElementById('detail-id').innerText = `ID: ${data.id}`;
            
            const iconDiv = document.getElementById('detail-icon');
            let iconHtml = '';
            
            // Reset Styles
            const badge = document.getElementById('direct-supply-badge');
            badge.classList.add('hidden');

            if (category === 'offshore') {
                iconHtml = '<i class="fa-solid fa-water"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-sky-500/10 border border-sky-500/30 flex items-center justify-center text-sky-400 text-lg';
                updateTelemetry('540 MW', '12 MVar');
                updateOntology([
                    { type: 'CONTAINS', target: `${data.turbines} x Siemens ${data.turbineType}` },
                    { type: 'LOCATED_AT', target: 'East China Sea Zone 4' },
                    { type: 'FEEDS', target: data.type === 'hydrogen' ? 'H2 Electrolyzer Array' : 'Main Grid (500kV)' }
                ]);
            } else if (category === 'onshore') {
                iconHtml = '<i class="fa-solid fa-wind"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center text-emerald-400 text-lg';
                updateTelemetry('850 MW', '45 MVar');
                updateOntology([
                    { type: 'CONTAINS', target: '66 x 9MW, 67 x 6MW...' },
                    { type: 'MAINTENANCE', target: '3 Turbines Offline' }
                ]);
            } else {
                iconHtml = '<i class="fa-solid fa-sun"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-yellow-500/10 border border-yellow-500/30 flex items-center justify-center text-yellow-400 text-lg';
                updateTelemetry('0 MW (Night)', '0 MVar'); // Simulating night or low light
                updateOntology([
                    { type: 'CONTAINS', target: '2M PV Panels' },
                    { type: 'CONNECTED_TO', target: 'Inverter Station A-Z' }
                ]);
                if (data.type === 'direct') {
                    badge.classList.remove('hidden');
                    updateOntology([
                        { type: 'SUPPLIES', target: 'Chem Plant (Load 200MW)' },
                        { type: 'SUPPLIES', target: 'Truck Charging (Load 50MW)' },
                        { type: 'BUFFERS', target: 'BESS (300MWh)' }
                    ]);
                }
            }
            iconDiv.innerHTML = iconHtml;
        }

        function updateTelemetry(active, reactive) {
            const container = document.getElementById('telemetry-grid');
            container.children[0].children[1].innerText = active;
            container.children[1].children[1].innerText = reactive;
        }

        function updateOntology(relations) {
            const container = document.getElementById('ontology-links');
            container.innerHTML = '';
            relations.forEach(r => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2 text-xs text-slate-300';
                div.innerHTML = `
                    <i class="fa-solid fa-link text-slate-600"></i>
                    <span class="bg-slate-800 px-1.5 py-0.5 rounded text-[10px] font-mono text-slate-400">${r.type}</span>
                    <span class="text-sky-100 truncate">${r.target}</span>
                `;
                container.appendChild(div);
            });
        }

        // Default Select
        selectAsset(ontology.offshore[0], 'offshore');

    </script>
</body>
</html>
