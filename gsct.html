<!-- Chosen Palette: Dark Navy (Header), Clean White/Gray (Body), Tech Blue (Accents) -->
<!-- Application Structure Plan: 
     1. Header: Dark themed command center style. Logo background is BLACK.
     2. Main Grid: 4 Business Blocks surrounding a semi-transparent central Hub.
     3. Physical Layer: A timeline view of goods movement.
     4. Solver Layer: Interactive console at the bottom simulating AI optimization.
-->
<!-- Visualization & Content Choices:
     - Central Hub: Semi-transparent.
     - Simulation: Red/Blue particles are now LARGER (14px) and SLOWER (1.7s duration) for better visibility.
-->
<!-- CONFIRMATION: NO SVG graphics used (except logo image source). NO Mermaid JS used. -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6214772877334340"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒä¾›åº”é“¾ååŒä½œæˆ˜å®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body {
            font-family: 'Inter', 'Microsoft YaHei', sans-serif;
            background-color: #f0f2f5;
        }

        /* åŠ¨ç”»è¿‡æ¸¡ */
        .transition-all-300 { transition: all 0.3s ease; }
        
        /* æŒ‰é’®çŠ¶æ€ */
        .flow-toggle-btn.active { transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* ä¸šåŠ¡æ¨¡å—æ‚¬åœæ•ˆæœ */
        .biz-block { border: 1px solid transparent; transition: all 0.3s ease; }
        .biz-block:hover { transform: translateY(-2px); border-color: #3b82f6; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        /* ä¸­å¿ƒæ¢çº½æ ·å¼ - ç¼©å°ä¸”åŠé€æ˜ */
        #processgo-hub {
            backdrop-filter: blur(4px);
            background-color: rgba(31, 41, 55, 0.75); /* Gray-800 with opacity */
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* ç‰©ç†æµå±‚æ ·å¼ */
        .physical-stage { position: relative; flex: 1; text-align: center; z-index: 1; }
        .physical-stage::after {
            content: ''; position: absolute; top: 20px; right: -50%; width: 100%; height: 2px;
            background-color: #e5e7eb; z-index: -1;
        }
        .physical-stage:last-child::after { display: none; }
        
        /* åŒ…è£¹ç§»åŠ¨åŠ¨ç”»å…ƒç´  */
        #physical-package {
            transition: left 0.1s linear; /* JSæ§åˆ¶æ¯ä¸€å¸§ */
        }

        /* ç²’å­æ ·å¼ - ä¼˜åŒ–ç‰ˆï¼šæ›´å¤§ã€æ›´æ¸…æ™° */
        .flow-particle {
            position: absolute; 
            width: 14px; /* å¢å¤§å°ºå¯¸ */
            height: 14px; /* å¢å¤§å°ºå¯¸ */
            border-radius: 50%;
            pointer-events: none; 
            opacity: 0; 
            z-index: 50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* å¢åŠ é˜´å½±æå‡ç«‹ä½“æ„Ÿ */
        }

        /* æ±‚è§£å™¨æ§åˆ¶å°æ ·å¼ */
        .console-text { font-family: 'Courier New', monospace; }
        .blinking-cursor::after { content: '|'; animation: blink 1s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .console-scroll::-webkit-scrollbar { width: 6px; }
        .console-scroll::-webkit-scrollbar-track { background: #1f2937; }
        .console-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }

    </style>
</head>
<body class="pb-10">

    <!-- 1. é¡¶éƒ¨æ§åˆ¶æ  (æ·±è‰²ä¸»é¢˜) -->
    <header class="bg-slate-900 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center">
                    <!-- LOGO åº•è‰²ä¿æŒé»‘è‰² -->
                    <div class="bg-black p-1 rounded mr-3 border border-slate-700">
                        <img src="https://globalbusinessinsight.github.io/picture/inossem_logo.svg" alt="Inossem Logo" class="h-6">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-wide">å…¨çƒä¾›åº”é“¾ååŒä½œæˆ˜å®¤</h1>
                        <p class="text-xs text-slate-400">Powered by ProcessGo Plus Integration Cloud</p>
                    </div>
                </div>
                
                <div class="flex flex-wrap justify-center gap-2">
                    <button id="toggle-data" class="flow-toggle-btn active bg-blue-600 hover:bg-blue-500 text-white text-sm px-3 py-1.5 rounded-full transition-colors border border-blue-400">
                        ğŸ”µ æ•°æ®æµ
                    </button>
                    <button id="toggle-physical" class="flow-toggle-btn active bg-emerald-600 hover:bg-emerald-500 text-white text-sm px-3 py-1.5 rounded-full transition-colors border border-emerald-400">
                        ğŸŸ¢ å•†å“æµ
                    </button>
                    <button id="toggle-financial" class="flow-toggle-btn active bg-rose-600 hover:bg-rose-500 text-white text-sm px-3 py-1.5 rounded-full transition-colors border border-rose-400">
                        ğŸ”´ èµ„é‡‘æµ
                    </button>
                    <div class="w-px h-6 bg-slate-700 mx-1"></div>
                    <button id="start-sim" class="bg-slate-700 hover:bg-slate-600 text-white text-sm px-4 py-1.5 rounded-full font-bold transition-all flex items-center gap-1 border border-slate-500">
                        <span>â–¶ï¸</span> å…¨æµç¨‹æ¨¡æ‹Ÿ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 mt-8 relative">

        <!-- 2. æ ¸å¿ƒç½‘ç»œå›¾ -->
        <div class="relative min-h-[500px] mb-8" id="network-container">
            
            <!-- ä¸­å¿ƒæ¢çº½ (ç¼©å°ã€åŠé€æ˜ã€ä¸é®æŒ¡) -->
            <div id="processgo-hub" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 rounded-full flex flex-col items-center justify-center z-20 text-center pointer-events-none transition-transform duration-500 hover:scale-110">
                <div class="text-3xl mb-1">â˜ï¸</div>
                <span class="font-bold text-white text-sm leading-tight">ProcessGo+</span>
                <span class="text-[10px] text-blue-200">Integration Cloud</span>
            </div>

            <!-- å››å¤§ä¸šåŠ¡æ¿å—å¸ƒå±€ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                
                <!-- å·¦ä¸Šï¼šä¾›åº”ç«¯ -->
                <div id="supply-side" class="biz-block bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-slate-700">ä¾›åº”ç«¯ (Supply Side)</h2>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">ERP é›†æˆ</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div id="factory-cn" class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡¨ğŸ‡³ ä¸­å›½å·¥å‚</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡»ğŸ‡³ è¶Šå—å·¥å‚</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡©ğŸ‡ª å¾·å›½å·¥å‚</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡ªğŸ‡¬ åŸƒåŠå·¥å‚</div>
                    </div>
                </div>

                <!-- å³ä¸Šï¼šéœ€æ±‚ç«¯ -->
                <div id="demand-side" class="biz-block bg-white rounded-xl shadow-sm p-6 border-l-4 border-rose-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-slate-700">éœ€æ±‚ç«¯ (Demand Side)</h2>
                        <span class="text-xs bg-rose-100 text-rose-800 px-2 py-1 rounded">å…¨æ¸ é“</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-sm space-y-2">
                            <div id="sales-us" class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡ºğŸ‡¸ åŒ—ç¾é”€å”®å…¬å¸</div>
                            <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ¢ åˆ†é”€å•†ç½‘ç»œ</div>
                            <div id="customer" class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ§‘â€ğŸ’» ç»ˆç«¯å®¢æˆ·</div>
                        </div>
                        <div class="chart-container h-32 w-full">
                            <canvas id="orderChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- å·¦ä¸‹ï¼šè¿è¥ä¸æ§åˆ¶ -->
                <div id="ops-control" class="biz-block bg-white rounded-xl shadow-sm p-6 border-l-4 border-indigo-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-slate-700">å…¨å±€è¿è¥ (Global Ops)</h2>
                        <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">æ§åˆ¶å¡”</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-sm space-y-2">
                            <div id="ops-hq" class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡¨ğŸ‡³ æ€»éƒ¨è¿è¥ä¸­å¿ƒ</div>
                            <div id="ops-settle" class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡¸ğŸ‡¬ å…¨çƒç»“ç®—ä¸­å¿ƒ</div>
                        </div>
                        <div class="chart-container h-32 w-full">
                            <canvas id="capacityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- å³ä¸‹ï¼šç‰©æµä¸å±¥è¡Œ -->
                <div id="logistics" class="biz-block bg-white rounded-xl shadow-sm p-6 border-l-4 border-emerald-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-slate-700">ç‰©æµä¸å±¥è¡Œ (Logistics)</h2>
                        <span class="text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded">TMS/å…³åŠ¡</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸšš 3PL / è´§ä»£</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸš¢ å›½é™…è´§è¿</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ§¾ è¿›å‡ºå£æŠ¥å…³</div>
                        <div class="p-2 bg-slate-50 rounded border border-slate-200">ğŸ‡ºğŸ‡¸ ç¾å›½æµ·å…³ (CBP)</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- 3. å•†å“è´§ç‰©æµå±‚ (Physical Goods Flow) -->
        <div id="goods-flow-layer" class="bg-white rounded-xl shadow-md p-8 mb-8 border border-slate-200 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
            <h3 class="text-lg font-bold text-slate-700 mb-6 flex items-center">
                <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span>
                å•†å“è´§ç‰©æµå±‚ (Physical Goods Flow)
            </h3>
            
            <div class="relative px-4 py-4">
                <!-- è¿›åº¦çº¿ -->
                <div class="absolute top-10 left-0 w-full h-1 bg-slate-100 z-0"></div>
                
                <div class="flex justify-between relative z-10">
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">ğŸ­</div>
                        <div class="text-xs font-medium text-slate-600">å·¥å‚å‘è´§</div>
                    </div>
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">âœˆï¸</div>
                        <div class="text-xs font-medium text-slate-600">å£å²¸å‡ºå£</div>
                    </div>
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">ğŸŒŠ</div>
                        <div class="text-xs font-medium text-slate-600">å›½é™…è¿è¾“</div>
                    </div>
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">âš“</div>
                        <div class="text-xs font-medium text-slate-600">ç›®çš„æ¸¯æ¸…å…³</div>
                    </div>
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">ğŸ“¦</div>
                        <div class="text-xs font-medium text-slate-600">å…¥åº“åˆ†é”€</div>
                    </div>
                    <div class="physical-stage">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2 text-xl border border-slate-300">ğŸ</div>
                        <div class="text-xs font-medium text-slate-600">æœ€ç»ˆäº¤ä»˜</div>
                    </div>
                </div>

                <!-- ç§»åŠ¨çš„åŒ…è£¹ -->
                <div id="physical-package" class="absolute top-8 left-0 w-8 h-8 bg-emerald-500 rounded text-white flex items-center justify-center shadow-lg opacity-0 z-20">
                    Box
                </div>
            </div>
        </div>

        <!-- 4. æ™ºèƒ½å†³ç­–æ±‚è§£å™¨ (Optimization Solver) -->
        <section id="solver-section" class="bg-slate-800 rounded-xl shadow-xl overflow-hidden text-white border border-slate-600">
            <div class="bg-slate-900 p-4 border-b border-slate-700 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <h3 class="ml-4 font-mono font-bold text-blue-400">>> æ™ºèƒ½å†³ç­–æ±‚è§£å™¨ (Optimization Solver)</h3>
                </div>
                <div class="text-xs text-slate-400">AI-Powered Optimization Engine</div>
            </div>
            
            <div class="p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- è¾“å…¥é¢æ¿ï¼šå¹²æ‰°å› å­ -->
                <div class="col-span-1 border-r border-slate-700 pr-6">
                    <h4 class="text-sm font-bold text-slate-300 mb-4 border-b border-slate-700 pb-2">è®¾å®šå¹²æ‰°å› å­ (Constraints & Variables)</h4>
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition">
                            <input type="checkbox" id="constraint-order" class="form-checkbox h-5 w-5 text-blue-600 rounded bg-slate-700 border-slate-500 focus:ring-offset-slate-800">
                            <span class="text-sm text-slate-200">å®¢æˆ·è®¢å•å˜æ›´ (Order Modification)</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition">
                            <input type="checkbox" id="constraint-port" class="form-checkbox h-5 w-5 text-blue-600 rounded bg-slate-700 border-slate-500 focus:ring-offset-slate-800">
                            <span class="text-sm text-slate-200">æ¸¯å£æ‹¥å µ/ä¸ç¡®å®šæ€§ (Port Uncertainty)</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition">
                            <input type="checkbox" id="constraint-tariff" class="form-checkbox h-5 w-5 text-blue-600 rounded bg-slate-700 border-slate-500 focus:ring-offset-slate-800">
                            <span class="text-sm text-slate-200">å…³ç¨æ”¿ç­–å˜åŒ– (Tariff Policy)</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition">
                            <input type="checkbox" id="constraint-capacity" class="form-checkbox h-5 w-5 text-blue-600 rounded bg-slate-700 border-slate-500 focus:ring-offset-slate-800">
                            <span class="text-sm text-slate-200">å·¥å‚äº§èƒ½é™åˆ¶ (Capacity Limit)</span>
                        </label>
                    </div>
                    <button id="run-solver" class="mt-6 w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded shadow-lg transition-all transform active:scale-95 flex justify-center items-center gap-2">
                        <span>âš¡</span> è¿è¡Œä¼˜åŒ–è®¡ç®—
                    </button>
                </div>

                <!-- è¾“å‡ºé¢æ¿ï¼šè®¡ç®—æ—¥å¿— -->
                <div class="col-span-1 bg-slate-900 rounded p-4 font-mono text-xs text-green-400 h-64 overflow-y-auto console-scroll shadow-inner">
                    <div id="solver-log">
                        <p class="opacity-50">// ç­‰å¾…è¾“å…¥æŒ‡ä»¤...</p>
                        <p class="opacity-50">// System Ready.</p>
                    </div>
                    <div class="blinking-cursor mt-1"></div>
                </div>

                <!-- ç»“æœé¢æ¿ï¼šä»ªè¡¨ç›˜ -->
                <div class="col-span-1 flex flex-col justify-between">
                    <div>
                        <h4 class="text-sm font-bold text-slate-300 mb-4">ä¼˜åŒ–ç»“æœ (Optimization Result)</h4>
                        
                        <!-- ç»“æœå¡ç‰‡ -->
                        <div id="result-card" class="bg-slate-700/50 rounded p-4 border border-slate-600 opacity-50 transition-opacity duration-500">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-slate-400">æ€»æˆæœ¬ (Total Cost)</span>
                                <span class="font-bold text-white" id="res-cost">--</span>
                            </div>
                            <div class="w-full bg-slate-600 rounded-full h-2 mb-4">
                                <div id="bar-cost" class="bg-blue-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                            </div>

                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-slate-400">äº¤ä»˜æ—¶æ•ˆ (Lead Time)</span>
                                <span class="font-bold text-white" id="res-time">--</span>
                            </div>
                            <div class="w-full bg-slate-600 rounded-full h-2 mb-4">
                                <div id="bar-time" class="bg-emerald-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                            </div>
                            
                            <div class="mt-4 p-3 bg-blue-900/30 border border-blue-500/30 rounded">
                                <span class="text-xs text-blue-300 block mb-1">æ¨èç­–ç•¥ (Recommendation):</span>
                                <p id="res-rec" class="text-sm text-white font-medium">ç­‰å¾…è®¡ç®—...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- ç²’å­å®¹å™¨ -->
    <div id="particle-container"></div>

    <script>
        // --- ç²’å­ç³»ç»Ÿ ---
        class ParticleSystem {
            constructor() {
                this.container = document.getElementById('particle-container');
            }

            createParticle(color) {
                const p = document.createElement('div');
                p.className = 'flow-particle';
                p.style.backgroundColor = color;
                this.container.appendChild(p);
                return p;
            }

            animate(fromId, toId, color, delay = 0) {
                setTimeout(() => {
                    const fromEl = document.getElementById(fromId);
                    const toEl = document.getElementById(toId);
                    if (!fromEl || !toEl) return;

                    const rect1 = fromEl.getBoundingClientRect();
                    const rect2 = toEl.getBoundingClientRect();
                    
                    // è®¡ç®—ä¸­å¿ƒç‚¹
                    const startX = rect1.left + rect1.width / 2 + window.scrollX;
                    const startY = rect1.top + rect1.height / 2 + window.scrollY;
                    const endX = rect2.left + rect2.width / 2 + window.scrollX;
                    const endY = rect2.top + rect2.height / 2 + window.scrollY;

                    const p = this.createParticle(color);
                    p.style.left = startX + 'px';
                    p.style.top = startY + 'px';
                    p.style.opacity = '1';

                    // å¼ºåˆ¶é‡ç»˜
                    p.offsetHeight;

                    // ä¼˜åŒ–ï¼šåŠ¨ç”»æ—¶é—´ 1.7sï¼Œæ›´åŠ æ¸…æ™°
                    p.style.transition = 'all 1.7s cubic-bezier(0.4, 0, 0.2, 1)';
                    p.style.left = endX + 'px';
                    p.style.top = endY + 'px';

                    setTimeout(() => {
                        p.remove();
                    }, 1700); // å¯¹åº”åŠ¨ç”»æ—¶é•¿
                }, delay);
            }
        }

        const particles = new ParticleSystem();

        // --- æ¨¡æ‹Ÿé€»è¾‘ ---
        const activeFlows = { data: true, goods: true, financial: true };
        let isSimulating = false;

        document.getElementById('toggle-data').onclick = function() {
            this.classList.toggle('bg-blue-600'); this.classList.toggle('bg-slate-400');
            activeFlows.data = !activeFlows.data;
        };
        document.getElementById('toggle-physical').onclick = function() {
            this.classList.toggle('bg-emerald-600'); this.classList.toggle('bg-slate-400');
            activeFlows.goods = !activeFlows.goods;
            const layer = document.getElementById('goods-flow-layer');
            layer.style.opacity = activeFlows.goods ? '1' : '0.5';
        };
        document.getElementById('toggle-financial').onclick = function() {
            this.classList.toggle('bg-rose-600'); this.classList.toggle('bg-slate-400');
            activeFlows.financial = !activeFlows.financial;
        };

        document.getElementById('start-sim').onclick = function() {
            if (isSimulating) return;
            isSimulating = true;
            const btn = this;
            btn.innerHTML = '<span>â³</span> æ¨¡æ‹Ÿè¿è¡Œä¸­...';
            btn.classList.add('opacity-75');

            let t = 0;

            // 1. å®¢æˆ· -> é”€å”® (ä¸‹å•) - æ•°æ®æµ
            if(activeFlows.data) particles.animate('customer', 'sales-us', '#3b82f6', t+=100);

            // 2. é”€å”® -> Hub (è®¢å•åŒæ­¥) - æ•°æ®æµ
            if(activeFlows.data) particles.animate('sales-us', 'processgo-hub', '#3b82f6', t+=1000);

            // 3. Hub -> è¿è¥ (å¯»æº) - æ•°æ®æµ
            if(activeFlows.data) particles.animate('processgo-hub', 'ops-hq', '#3b82f6', t+=1000);

            // 4. Hub -> å·¥å‚ (æ’äº§) - æ•°æ®æµ
            if(activeFlows.data) particles.animate('processgo-hub', 'factory-cn', '#3b82f6', t+=1000);

            // 5. ç‰©ç†æµå¼€å§‹ (å·¥å‚ -> äº¤ä»˜)
            setTimeout(() => {
                if(activeFlows.goods) {
                    const pkg = document.getElementById('physical-package');
                    // åŠ¨æ€è®¡ç®—è¿›åº¦
                    pkg.style.opacity = '1';
                    pkg.style.left = '20px';
                    pkg.style.transition = 'left 4s linear';
                    setTimeout(() => { pkg.style.left = '95%'; }, 100);
                    setTimeout(() => { pkg.style.opacity = '0'; }, 4100);
                }
            }, t);

            // 6. Hub -> ç‰©æµ (è®¢èˆ±/æŠ¥å…³)
            if(activeFlows.data) {
                particles.animate('processgo-hub', 'logistics', '#3b82f6', t+=1500);
            }

            // 7. èµ„é‡‘æµ (ç»“ç®—)
            if(activeFlows.financial) {
                particles.animate('sales-us', 'ops-settle', '#ef4444', t+=2500); // é”€å”®å›æ¬¾
                particles.animate('ops-settle', 'factory-cn', '#ef4444', t+=500); // å†…éƒ¨ç»“ç®—
            }

            setTimeout(() => {
                isSimulating = false;
                btn.innerHTML = '<span>â–¶ï¸</span> å…¨æµç¨‹æ¨¡æ‹Ÿ';
                btn.classList.remove('opacity-75');
            }, t + 2000);
        };

        // --- å›¾è¡¨åˆå§‹åŒ– ---
        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        };

        new Chart(document.getElementById('orderChart'), {
            type: 'bar',
            data: {
                labels: ['å¾…å¤„ç†', 'ç”Ÿäº§ä¸­', 'è¿è¾“ä¸­', 'å·²å®Œæˆ'],
                datasets: [{
                    data: [120, 300, 150, 800],
                    backgroundColor: ['#e2e8f0', '#3b82f6', '#f59e0b', '#10b981'],
                    borderRadius: 4
                }]
            },
            options: { ...chartConfig, plugins: { title: { display: true, text: 'è®¢å•çŠ¶æ€åˆ†å¸ƒ' } } }
        });

        new Chart(document.getElementById('capacityChart'), {
            type: 'doughnut',
            data: {
                labels: ['ä¸­å›½', 'è¶Šå—', 'å¾·å›½', 'å…¶ä»–'],
                datasets: [{
                    data: [40, 30, 20, 10],
                    backgroundColor: ['#3b82f6', '#f59e0b', '#ef4444', '#94a3b8'],
                    borderWidth: 0
                }]
            },
            options: { ...chartConfig, plugins: { title: { display: true, text: 'å…¨çƒäº§èƒ½è´Ÿè½½' } } }
        });


        // --- æ±‚è§£å™¨é€»è¾‘ ---
        const logEl = document.getElementById('solver-log');
        const resCard = document.getElementById('result-card');
        const resCost = document.getElementById('res-cost');
        const resTime = document.getElementById('res-time');
        const resRec = document.getElementById('res-rec');
        const barCost = document.getElementById('bar-cost');
        const barTime = document.getElementById('bar-time');

        function addLog(text, color = 'text-green-400') {
            const p = document.createElement('p');
            p.className = `mb-1 ${color}`;
            p.innerText = `> ${text}`;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;
        }

        document.getElementById('run-solver').onclick = async function() {
            // é‡ç½®ç•Œé¢
            logEl.innerHTML = '';
            resCard.classList.remove('opacity-100');
            resCard.classList.add('opacity-50');
            addLog("åˆå§‹åŒ–æ±‚è§£å™¨...", "text-blue-300");
            
            // è·å–è¾“å…¥
            const constraints = [];
            if(document.getElementById('constraint-order').checked) constraints.push("è®¢å•æ¿€å¢");
            if(document.getElementById('constraint-port').checked) constraints.push("æ¸¯å£æ‹¥å µ");
            if(document.getElementById('constraint-tariff').checked) constraints.push("å…³ç¨ä¸Šæ¶¨");
            if(document.getElementById('constraint-capacity').checked) constraints.push("äº§èƒ½å—é™");

            await wait(600);
            addLog(`åŠ è½½çº¦æŸæ¡ä»¶: [${constraints.length > 0 ? constraints.join(', ') : 'æ ‡å‡†æ¨¡å¼'}]`);
            
            await wait(800);
            addLog("è¿æ¥ ProcessGo+ æ•°æ®æ¹–...", "text-yellow-300");
            
            await wait(800);
            addLog("æ­£åœ¨è¿›è¡Œå¤šç›®æ ‡çº¿æ€§è§„åˆ’ (Simplex Algorithm)...");
            
            // æ¨¡æ‹Ÿè®¡ç®—è¿‡ç¨‹
            let costVal = "$1.2M";
            let costPercent = "60%";
            let timeVal = "14 Days";
            let timePercent = "40%";
            let recText = "ç»´æŒå½“å‰è·¯ç”±ï¼Œåˆ©ç”¨ä¸­å›½å·¥å‚äº§èƒ½ï¼Œé€šè¿‡æ´›æ‰çŸ¶æ¸¯(LAX)è¿›å£ã€‚";

            if (constraints.includes("å…³ç¨ä¸Šæ¶¨")) {
                await wait(500);
                addLog("è­¦å‘Šï¼šæ£€æµ‹åˆ°æˆæœ¬å‚æ•°å˜åŒ– (Tariff +25%)", "text-red-400");
                addLog("æ­£åœ¨é‡æ–°è®¡ç®—å¯»æºç­–ç•¥...");
                costVal = "$1.4M"; costPercent = "75%";
                recText = "å»ºè®®è½¬ç§» 30% è®¢å•è‡³è¶Šå—å·¥å‚ç”Ÿäº§ä»¥è§„é¿å…³ç¨ï¼›å…¶ä½™ä¿æŒç°çŠ¶ã€‚";
            }
            
            if (constraints.includes("æ¸¯å£æ‹¥å µ")) {
                await wait(500);
                addLog("è­¦å‘Šï¼šæ£€æµ‹åˆ°ç‰©æµç“¶é¢ˆ (Lead Time Risk)", "text-red-400");
                addLog("æ­£åœ¨æ¨¡æ‹Ÿå¤šå¼è”è¿æ–¹æ¡ˆ...");
                timeVal = "18 Days"; timePercent = "80%";
                recText = "å»ºè®®æ”¹é“é•¿æ»©æ¸¯ (LGB) æˆ–å¯ç”¨ç©ºè¿åŠ æ€¥æœåŠ¡ï¼›é€šçŸ¥å®¢æˆ·å¯èƒ½çš„å»¶è¯¯ã€‚";
            }
            
            if (constraints.includes("äº§èƒ½å—é™") && constraints.includes("è®¢å•æ¿€å¢")) {
                await wait(500);
                addLog("ä¸¥é‡è­¦å‘Šï¼šä¾›éœ€ä¸¥é‡å¤±è¡¡ï¼", "text-red-500 font-bold");
                addLog("å¯åŠ¨å…¨çƒåº“å­˜è°ƒæ‹¨ç®—æ³•...");
                costVal = "$2.1M"; costPercent = "95%";
                recText = "å¯ç”¨å¾·å›½å·¥å‚å¤‡ç”¨äº§èƒ½ï¼›æ‹†åˆ†è®¢å•ï¼Œç´§æ€¥éƒ¨åˆ†ç©ºè¿ï¼Œå¸¸è§„éƒ¨åˆ†æµ·è¿ã€‚";
            }

            await wait(600);
            addLog("è®¡ç®—å®Œæˆã€‚æœ€ä¼˜è§£å·²ç”Ÿæˆã€‚", "text-white");
            
            // æ˜¾ç¤ºç»“æœ
            resCost.innerText = costVal;
            resTime.innerText = timeVal;
            resRec.innerText = recText;
            
            barCost.style.width = costPercent;
            barTime.style.width = timePercent;

            if (constraints.length > 0) {
                 if (parseInt(costPercent) > 70) barCost.classList.replace('bg-blue-500', 'bg-red-500');
                 else barCost.classList.replace('bg-red-500', 'bg-blue-500');
            } else {
                barCost.classList.replace('bg-red-500', 'bg-blue-500');
            }

            resCard.classList.remove('opacity-50');
            resCard.classList.add('opacity-100');
        };

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    </script>
</body>
</html>
