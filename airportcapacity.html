<!DOCTYPE html>
<html lang="en">
<head>
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6214772877334340"
     crossorigin="anonymous"></script>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Runway Airport Capacity Study - Detailed Analysis</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@500;700&family=Noto+Sans:wght@300;400;500;600;700&family=Noto+Serif+SC:wght@500;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- 
       Design System: "Aviation Analytic Pro"
       - Primary: Slate (Professionalism)
       - Accent: Indigo (Data/Tech) & Emerald (Efficiency)
    -->
    <style>
        :root {
            --font-serif: 'Noto Serif', 'Noto Serif SC', serif;
            --font-sans: 'Noto Sans', 'Noto Sans SC', sans-serif;
        }
        body {
            font-family: var(--font-sans);
            background-color: #f8fafc; /* Slate 50 */
            color: #334155; /* Slate 700 */
            line-height: 1.6;
        }
        h1, h2, h3, h4, .serif {
            font-family: var(--font-serif);
        }
        
        /* Layout Utilities */
        .report-container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .card {
            background: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease-in-out;
        }
        
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #f1f5f9;
            background-color: #ffffff;
        }
        
        .card-body {
            padding: 1.5rem;
        }

        /* Chart constraints */
        .chart-wrapper {
            position: relative;
            height: 350px;
            width: 100%;
            margin-top: 1rem;
        }

        /* Navigation Active State */
        .nav-btn.active {
            background-color: #2563eb; /* Blue 600 */
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }

        /* Language Toggle */
        .lang-toggle {
            display: flex;
            background: #cbd5e1;
            border-radius: 20px;
            cursor: pointer;
            position: relative;
            width: 76px;
            height: 32px;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            font-size: 11px;
            font-weight: 700;
            color: #475569;
            user-select: none;
            transition: background 0.3s;
        }
        .lang-toggle:hover {
            background: #94a3b8;
        }
        .lang-toggle::before {
            content: '';
            position: absolute;
            background: white;
            width: 34px;
            height: 26px;
            border-radius: 16px;
            top: 3px;
            left: 3px;
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }
        .lang-toggle.zh::before {
            transform: translateX(36px);
        }
        .lang-toggle span {
            z-index: 1;
        }
        .lang-toggle.en .en-text { color: #0f172a; }
        .lang-toggle.zh .zh-text { color: #0f172a; }
        
        /* Smooth fade for view switching */
        .animate-fade {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <!-- Top Navigation -->
    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm border-b border-slate-200">
        <div class="report-container py-3 flex flex-col md:flex-row justify-between items-center gap-4 md:gap-0">
            <div class="flex items-center w-full md:w-auto justify-between md:justify-start">
                <div class="flex items-center space-x-3 mr-6">
                    <div class="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg shadow-indigo-200">âœˆ</div>
                    <div class="flex flex-col">
                        <span class="font-bold text-slate-800 leading-tight" data-key="nav_title">Airport Capacity</span>
                        <span class="text-[10px] text-slate-500 uppercase tracking-wider">Research Lab</span>
                    </div>
                </div>
                
                <!-- Language Switcher -->
                <div class="lang-toggle en" id="langSwitch" onclick="toggleLanguage()">
                    <span class="en-text">EN</span>
                    <span class="zh-text">ä¸­</span>
                </div>
            </div>
            
            <div class="flex space-x-1 bg-slate-100 p-1 rounded-lg overflow-x-auto w-full md:w-auto">
                <button onclick="switchTab('overview')" id="nav-overview" class="nav-btn active flex-1 md:flex-none px-4 py-2 rounded-md text-xs sm:text-sm text-slate-600 transition-all" data-key="tab_overview">Analysis</button>
                <button onclick="switchTab('bomba')" id="nav-bomba" class="nav-btn flex-1 md:flex-none px-4 py-2 rounded-md text-xs sm:text-sm text-slate-600 transition-all" data-key="tab_mumbai">Mumbai Case</button>
                <button onclick="switchTab('sfo')" id="nav-sfo" class="nav-btn flex-1 md:flex-none px-4 py-2 rounded-md text-xs sm:text-sm text-slate-600 transition-all" data-key="tab_sfo">SFO Tech</button>
                <button onclick="switchTab('lab')" id="nav-lab" class="nav-btn flex-1 md:flex-none px-4 py-2 rounded-md text-xs sm:text-sm text-slate-600 transition-all" data-key="tab_lab">Simulation</button>
            </div>
        </div>
    </nav>

    <div class="report-container">

        <!-- Header -->
        <header class="mb-12 text-center">
            <div class="inline-flex items-center px-3 py-1 bg-indigo-50 text-indigo-700 text-xs font-bold rounded-full mb-4 border border-indigo-100 shadow-sm" data-key="header_tag">
                <span class="w-2 h-2 bg-indigo-500 rounded-full mr-2 animate-pulse"></span>
                In-Depth Technical Report
            </div>
            <h1 class="text-3xl md:text-5xl font-bold text-slate-900 mb-6 leading-tight" data-key="header_title">The Physics of Saturation:<br>Single Runway Capacity Limits</h1>
            <p class="text-slate-600 max-w-3xl mx-auto text-lg leading-relaxed" data-key="header_desc">
                An investigation into the aerodynamic and operational bottlenecks that define global aviation throughput. 
                <br>Featuring deep-dives into <span class="text-indigo-700 font-semibold decoration-indigo-200 underline decoration-2 underline-offset-2">Mumbai's extreme optimization</span> and <span class="text-purple-700 font-semibold decoration-purple-200 underline decoration-2 underline-offset-2">SFO's paired approach technology</span>.
            </p>
        </header>

        <!-- VIEW: OVERVIEW -->
        <div id="view-overview" class="view-section block animate-fade">
            <!-- Key Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card border-l-4 border-l-indigo-500 relative group hover:-translate-y-1 transition-transform">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"/></svg>
                    </div>
                    <div class="card-body">
                        <div class="text-xs font-bold text-indigo-500 uppercase tracking-wider mb-2" data-key="card_1_title">Theoretical Ceiling</div>
                        <div class="text-4xl font-serif font-bold text-slate-800">~60</div>
                        <div class="text-sm text-slate-500 font-medium mb-3" data-key="unit_movements">Movements / Hour</div>
                        <div class="text-xs text-slate-500 leading-relaxed border-t border-slate-100 pt-3" data-key="card_1_desc">
                            The hard limit defined by radar separation minima (3NM) and average approach speeds (140kts).
                        </div>
                    </div>
                </div>

                <div class="card border-l-4 border-l-emerald-500 relative group hover:-translate-y-1 transition-transform">
                    <div class="card-body">
                        <div class="text-xs font-bold text-emerald-600 uppercase tracking-wider mb-2" data-key="card_2_title">Mumbai (BOM) Record</div>
                        <div class="text-4xl font-serif font-bold text-slate-800">1,003</div>
                        <div class="text-sm text-slate-500 font-medium mb-3" data-key="unit_movements_day">Movements / 24 Hours</div>
                        <div class="text-xs text-slate-500 leading-relaxed border-t border-slate-100 pt-3" data-key="card_2_desc">
                            Achieved on a single active runway (27) via "High Speed Exit" compliance and aggressive mixed-mode interleaving.
                        </div>
                    </div>
                </div>

                <div class="card border-l-4 border-l-purple-500 relative group hover:-translate-y-1 transition-transform">
                    <div class="card-body">
                        <div class="text-xs font-bold text-purple-600 uppercase tracking-wider mb-2" data-key="card_3_title">SFO Parallel Throughput</div>
                        <div class="text-4xl font-serif font-bold text-slate-800">60 <span class="text-2xl text-slate-400">vs</span> 30</div>
                        <div class="text-sm text-slate-500 font-medium mb-3" data-key="unit_vmc_imc">VMC (Clear) vs IMC (Cloudy)</div>
                        <div class="text-xs text-slate-500 leading-relaxed border-t border-slate-100 pt-3" data-key="card_3_desc">
                            Capacity halves when clouds drop. SFO's parallel runways are too close (750ft) for standard independent ops.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Global Comparison Chart -->
            <div class="card">
                <div class="card-header flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800" data-key="chart_title">Benchmarking Global Efficiency</h3>
                        <p class="text-xs text-slate-500 mt-1" data-key="chart_subtitle">Comparing peak hourly sustained movement rates (Arr+Dep) on constrained runway configurations.</p>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-wrapper">
                        <canvas id="globalChart"></canvas>
                    </div>
                    <p class="text-xs text-slate-400 mt-6 text-center italic" data-key="chart_note">
                        * Comparison of "Constrained Operations": Included are single runways (LGW, BOM, SAN, old SZX) and dependent parallel runways (SFO in IMC).
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="font-bold text-lg text-slate-800" data-key="core_title">The Anatomy of a Bottleneck</h3>
                </div>
                <div class="card-body grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
                    <div>
                        <div class="flex items-center mb-3">
                            <div class="w-8 h-8 rounded bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold mr-3">1</div>
                            <h4 class="font-bold text-slate-800" data-key="constraint_1_title">Wake Turbulence: The Invisible Wall</h4>
                        </div>
                        <p class="text-sm text-slate-600 leading-relaxed mb-4 text-justify" data-key="constraint_1_desc">
                            Every aircraft generates powerful counter-rotating vortices from its wingtipsâ€”essentially horizontal tornadoes that can flip a smaller trailing aircraft. This is not a bureaucratic rule; it is physics. <br><br>
                            To survive, a Medium aircraft (like A320) must stay <strong>5 nautical miles</strong> behind a Heavy (like B777). At approach speeds, this creates a mandatory time gap of ~2 minutes where the runway sits empty. Capacity is purely a function of how fast these vortices dissipate.
                        </p>
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                            <h5 class="text-xs font-bold text-slate-700 uppercase mb-2" data-key="recat_title">Solution: RECAT-EU/US</h5>
                            <p class="text-xs text-slate-500 leading-relaxed" data-key="recat_desc">
                                Traditional categories (Heavy/Medium/Light) were too broad. New "Recategorization" standards split aircraft into 6+ tiers (e.g., 'Upper Heavy', 'Lower Heavy'), allowing controllers to safely shave off 0.5-1.0 NM separation in specific pairs, boosting capacity by 5-10%.
                            </p>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center mb-3">
                            <div class="w-8 h-8 rounded bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold mr-3">2</div>
                            <h4 class="font-bold text-slate-800" data-key="constraint_2_title">ROT: The Runway Occupancy Time</h4>
                        </div>
                        <p class="text-sm text-slate-600 leading-relaxed mb-4 text-justify" data-key="constraint_2_desc">
                            ROT is the stopwatch measurement from the moment an aircraft crosses the landing threshold until its tail completely clears the runway line. <br><br>
                            A trailing aircraft cannot be cleared to land (or in some regulations, cross the threshold) until the runway is clear. High ROT is a capacity killer. If pilots miss a "High Speed Exit" and have to taxi to the end, a 50-second routine turns into a 90-second delay, forcing the next arrival to go around.
                        </p>
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                            <h5 class="text-xs font-bold text-slate-700 uppercase mb-2" data-key="geo_title">Geometry Matters</h5>
                            <p class="text-xs text-slate-500 leading-relaxed" data-key="geo_desc">
                                Airports like Mumbai and Gatwick design "Rapid Exit Taxiways" (RETs) angled at 30 degrees, allowing planes to turn off at 50 knots (93 km/h). Standard 90-degree exits require slowing to 10 knots, adding 20+ seconds to ROT.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: MUMBAI (BOM) -->
        <div id="view-bomba" class="view-section hidden animate-fade">
            <div class="card border-t-4 border-t-emerald-600">
                <div class="card-body">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900" data-key="bom_title">Case Study: The Mumbai Miracle</h2>
                        <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full mt-2 md:mt-0">Efficiency Level: Extreme</span>
                    </div>
                    
                    <p class="text-slate-700 mb-8 leading-relaxed text-lg" data-key="bom_intro">
                        Mumbai (BOM) operates in a league of its own. While surrounded by urban density that prevents adding parallel runways, it handles traffic volumes comparable to dual-runway airports like Heathrow. The secret lies in a high-pressure, high-precision operational culture.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <!-- Strategy List -->
                        <div class="space-y-6">
                            
                            <div class="flex">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-100 text-emerald-600 flex items-center justify-center font-bold text-lg mr-4 border border-slate-200">1</div>
                                <div>
                                    <h4 class="font-bold text-slate-800" data-key="strat_1_title">Psychology of "Immediate Exit"</h4>
                                    <p class="text-sm text-slate-600 mt-2 leading-relaxed" data-key="strat_1_desc">
                                        In Mumbai, ROT is not just a metric; it's a mandate. Pilots are briefed to apply maximum safe braking upon touchdown. ATC monitors braking performance. If a pilot rolls too long and misses the Rapid Exit Taxiway (N8 or N6), they disrupt the "conveyor belt" and may face an inquiry. The target ROT is a blistering 48-50 seconds.
                                    </p>
                                </div>
                            </div>

                            <div class="flex">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-100 text-emerald-600 flex items-center justify-center font-bold text-lg mr-4 border border-slate-200">2</div>
                                <div>
                                    <h4 class="font-bold text-slate-800" data-key="strat_2_title">The "Inter-Arrival" Departure</h4>
                                    <p class="text-sm text-slate-600 mt-2 leading-relaxed" data-key="strat_2_desc">
                                        Most airports run segregated modes (one runway for arrival, one for departure). BOM runs "Mixed Mode" on a single strip. Controllers insert a departure into the gap between two arrivals. <br>
                                        <strong>The Sequence:</strong> Arrival 1 touches down -> Departure 1 enters runway immediately -> Arrival 1 clears runway -> Departure 1 takes off -> Arrival 2 crosses threshold. The margin for error is often less than 15 seconds.
                                    </p>
                                </div>
                            </div>

                            <div class="flex">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-100 text-emerald-600 flex items-center justify-center font-bold text-lg mr-4 border border-slate-200">3</div>
                                <div>
                                    <h4 class="font-bold text-slate-800" data-key="strat_3_title">Homogenizing the Fleet</h4>
                                    <p class="text-sm text-slate-600 mt-2 leading-relaxed" data-key="strat_3_desc">
                                        Variance is the enemy of capacity. A slow propeller plane or a private jet acts like a stone in a flowing river. During peak hours (0800-1100, 1800-2200), BOM heavily restricts non-scheduled flights. By ensuring everyone flies at similar approach speeds (approx 140-150kts), ATC can compress gaps to the absolute minimum.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Visual Diagram -->
                        <div class="flex flex-col space-y-4">
                            <div class="bg-slate-900 rounded-xl p-6 relative overflow-hidden flex flex-col justify-center h-80 shadow-2xl">
                                <div class="absolute top-4 left-4 text-white/40 text-xs font-mono tracking-widest" data-key="diag_title">LIVE OPS VISUALIZATION</div>
                                
                                <!-- Runway Visual -->
                                <div class="w-full h-16 bg-slate-700 border-y-2 border-dashed border-slate-500 relative flex items-center mb-10 group cursor-default">
                                    <span class="text-white/20 text-4xl font-bold ml-4 select-none">27</span>
                                    
                                    <!-- Departure Plane -->
                                    <div class="absolute left-1/3 transition-all duration-1000 transform group-hover:translate-x-32">
                                        <div class="text-3xl filter drop-shadow-lg animate-pulse">ğŸ›«</div>
                                        <div class="absolute -bottom-6 w-32 text-[10px] text-emerald-400 font-mono" data-key="diag_dep">
                                            DEPARTURE<br>Rolling (T-0s)
                                        </div>
                                    </div>

                                    <!-- Exiting Plane -->
                                    <div class="absolute right-1/4 -top-8 text-2xl opacity-50 transform rotate-12">
                                        ğŸ›¬
                                    </div>
                                    <div class="absolute right-10 -top-12 text-[10px] text-slate-400 font-mono text-right leading-tight" data-key="diag_exit">
                                        PREV ARRIVAL<br>Clearing (T-45s)
                                    </div>
                                </div>

                                <!-- Approach Path -->
                                <div class="w-full h-1 bg-gradient-to-l from-blue-500/50 to-transparent relative mt-2">
                                    <!-- Arrival Plane -->
                                    <div class="absolute right-12 -top-4 text-3xl filter drop-shadow-[0_0_10px_rgba(59,130,246,0.5)]">ğŸ›¬</div>
                                    <div class="absolute right-4 -bottom-8 text-[10px] text-blue-400 font-mono text-right" data-key="diag_arr">
                                        NEXT ARRIVAL<br>Dist: 3.5 NM<br>Time to Threshold: 90s
                                    </div>
                                    
                                    <!-- Separation Marker -->
                                    <div class="absolute right-0 top-0 h-full w-32 border-b-2 border-red-500/30"></div>
                                    <div class="absolute right-16 -top-8 text-[9px] text-red-400/80 uppercase" data-key="diag_sep">Min Separation</div>
                                </div>
                            </div>
                            
                            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100 text-xs text-indigo-800 italic text-center" data-key="diag_quote">
                                "The departure must be rolling before the arrival crosses the 4 mile mark. It's a game of seconds."
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SFO -->
        <div id="view-sfo" class="view-section hidden animate-fade">
            <div class="card border-t-4 border-t-purple-600">
                <div class="card-body">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900" data-key="sfo_title">SFO Tech: Breaking the 2500ft Rule</h2>
                        <span class="bg-purple-100 text-purple-800 text-xs font-bold px-3 py-1 rounded-full mt-2 md:mt-0">Tech Level: Advanced</span>
                    </div>

                    <p class="text-slate-700 mb-8 leading-relaxed text-lg" data-key="sfo_intro">
                        San Francisco (SFO) presents a unique geometric nightmare: two parallel runways (28L & 28R) separated by only <strong>750 feet (228m)</strong>. Standard FAA safety rules require 4,300ft separation for independent simultaneous instrument approaches. Without special tech, SFO is legally a single-runway airport in bad weather.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
                        <!-- Technical Breakdown -->
                        <div class="space-y-8">
                            <div class="relative pl-6 border-l-2 border-purple-200">
                                <h3 class="font-bold text-purple-900 text-lg mb-2" data-key="prm_title">1. PRM (Precision Runway Monitor)</h3>
                                <p class="text-sm text-slate-600 leading-relaxed text-justify" data-key="prm_desc">
                                    Standard airport radar rotates every 4.8 secondsâ€”too slow to detect a blunder at 750ft separation. SFO uses an electronically scanned PRM radar with a <strong>1.0 second update rate</strong>. <br>
                                    A dedicated "Monitor Controller" watches the "No Transgression Zone" (NTZ) between the runways. They have an override frequency. If a plane twitches toward the NTZ, the controller instantly commands a "Breakout" maneuver to the parallel aircraft.
                                </p>
                            </div>
                            
                            <div class="relative pl-6 border-l-2 border-purple-200">
                                <h3 class="font-bold text-purple-900 text-lg mb-2" data-key="soia_title">2. SOIA (Simultaneous Offset Instrument Approach)</h3>
                                <p class="text-sm text-slate-600 leading-relaxed text-justify" data-key="soia_desc">
                                    This is the workaround for cloudy days. 28L flies a straight ILS approach. 28R flies an LDA approach offset by 3 degrees. The planes fly in clouds, paired via PRM radar. <br>
                                    <strong>The Critical Moment:</strong> They must break out of the clouds by ~2,100ft. The 28R pilot <em>must</em> visually see the 28L plane and the runway to continue. If they see it, they side-step to align and land. If the clouds are too low (below 1,600ft), SOIA fails, and the capacity crashes.
                                </p>
                            </div>

                            <div class="bg-rose-50 p-5 rounded-lg border border-rose-100">
                                <h3 class="font-bold text-rose-800 mb-2 text-sm uppercase" data-key="weather_title">The "Marine Layer" Curse</h3>
                                <p class="text-xs text-rose-700 leading-relaxed" data-key="weather_desc">
                                    San Francisco's famous fog often sits right at 1,000ft. This is the "kill zone" for operations. It's too low for SOIA visual confirmation, forcing SFO to revert to single-stream arrivals. This reduces arrival capacity from 60 to 30 per hour, triggering the infamous "Ground Delay Programs" that ripple across the entire US network.
                                </p>
                            </div>
                        </div>

                        <!-- Canvas Visualization for SFO -->
                        <div class="bg-slate-900 rounded-xl overflow-hidden shadow-2xl h-96 relative border border-slate-700">
                            <canvas id="sfoCanvas"></canvas>
                            
                            <!-- Legend Overlay -->
                            <div class="absolute bottom-0 left-0 right-0 bg-slate-900/90 backdrop-blur border-t border-slate-700 p-3 flex justify-around text-[10px] text-slate-300">
                                <div class="flex items-center"><span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span> <span data-key="legend_28l">28L (Straight ILS)</span></div>
                                <div class="flex items-center"><span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span> <span data-key="legend_28r">28R (Offset LDA)</span></div>
                                <div class="flex items-center"><span class="w-3 h-3 border border-red-500 mr-2"></span> <span data-key="legend_ntz">NTZ (No Go Zone)</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: LAB (Interactive) -->
        <div id="view-lab" class="view-section hidden animate-fade">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="card lg:col-span-1 h-fit">
                    <div class="card-header bg-slate-50">
                        <h3 class="font-bold text-slate-700 flex items-center" data-key="lab_params">
                            <svg class="w-4 h-4 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                            Simulation Parameters
                        </h3>
                    </div>
                    <div class="card-body space-y-8">
                        
                        <div>
                            <label class="flex justify-between text-sm font-bold text-slate-700 mb-2">
                                <span data-key="lbl_speed">Approach Speed (Vref)</span>
                                <span class="text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded text-xs" id="disp-speed">140 kts</span>
                            </label>
                            <input type="range" id="in-speed" min="120" max="170" value="140" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <p class="text-xs text-slate-500 mt-2 leading-tight" data-key="hint_speed">
                                Higher speed = less time on final approach, but higher inertia makes it harder to exit the runway quickly.
                            </p>
                        </div>

                        <div>
                            <label class="flex justify-between text-sm font-bold text-slate-700 mb-2">
                                <span data-key="lbl_sep">Radar Separation</span>
                                <span class="text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded text-xs" id="disp-sep">4.0 nm</span>
                            </label>
                            <input type="range" id="in-sep" min="2.5" max="6.0" step="0.5" value="4.0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <p class="text-xs text-slate-500 mt-2 leading-tight" data-key="hint_sep">
                                The safety gap. 3NM is standard. 5NM+ required for Heavy aircraft. Reducing this is the holy grail of ATC.
                            </p>
                        </div>

                        <div>
                            <label class="flex justify-between text-sm font-bold text-slate-700 mb-2">
                                <span data-key="lbl_rot">Runway Occupancy (ROT)</span>
                                <span class="text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded text-xs" id="disp-rot">50 s</span>
                            </label>
                            <input type="range" id="in-rot" min="40" max="90" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <p class="text-xs text-slate-500 mt-2 leading-tight" data-key="hint_rot">
                                Time on concrete. Depends on High Speed Exits (RET) availability and pilot discipline.
                            </p>
                        </div>

                    </div>
                </div>

                <!-- Results -->
                <div class="card lg:col-span-2 flex flex-col justify-center items-center bg-white relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                    
                    <div class="text-center p-8 w-full max-w-lg">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-[0.2em] mb-4" data-key="res_header">Theoretical Max Capacity</div>
                        
                        <div class="flex items-baseline justify-center mb-6">
                            <span class="text-7xl font-serif font-bold text-slate-900 tracking-tighter" id="res-cap">--</span>
                            <span class="ml-3 text-xl text-slate-500 font-medium" data-key="unit_movements">mvts/hr</span>
                        </div>
                        
                        <!-- Visual Bar -->
                        <div class="w-full h-6 bg-slate-100 rounded-full mb-8 overflow-hidden border border-slate-200 shadow-inner relative">
                            <!-- Markers -->
                            <div class="absolute top-0 bottom-0 border-l border-slate-300 z-10 text-[9px] text-slate-400 pl-1 pt-1" style="left: 50%">30 (Std)</div>
                            <div class="absolute top-0 bottom-0 border-l border-slate-300 z-10 text-[9px] text-slate-400 pl-1 pt-1" style="left: 83%">50 (High)</div>
                            
                            <div id="cap-bar" class="h-full bg-gradient-to-r from-blue-400 to-indigo-600 transition-all duration-700 ease-out shadow-lg" style="width: 0%"></div>
                        </div>
                        
                        <div class="p-6 bg-slate-50 rounded-xl border border-slate-200 text-left relative">
                            <div class="absolute -top-3 left-4 bg-white px-2 text-xs font-bold text-slate-400 border border-slate-200 rounded">AI ANALYSIS</div>
                            <h4 class="font-bold text-slate-800 mb-2 text-lg" id="res-title">Analysis</h4>
                            <p class="text-sm text-slate-600 leading-relaxed" id="res-desc">Adjust sliders to simulate.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Logic Script -->
    <script>
        // --- Translation Data (FIXED) ---
        const translations = {
            en: {
                nav_title: "Airport Capacity Study",
                tab_overview: "Analysis",
                tab_mumbai: "Mumbai Case",
                tab_sfo: "SFO Tech",
                tab_lab: "Simulation",
                header_tag: "In-Depth Technical Report",
                header_title: "The Physics of Saturation:<br>Single Runway Capacity Limits",
                header_desc: "An investigation into the aerodynamic and operational bottlenecks that define global aviation throughput. <br>Featuring deep-dives into <span class='text-indigo-700 font-semibold decoration-indigo-200 underline decoration-2 underline-offset-2'>Mumbai's extreme optimization</span> and <span class='text-purple-700 font-semibold decoration-purple-200 underline decoration-2 underline-offset-2'>SFO's paired approach technology</span>.",
                
                card_1_title: "Theoretical Ceiling",
                card_1_desc: "The hard limit defined by radar separation minima (3NM) and average approach speeds (140kts). Pushing beyond this requires ignoring wake turbulence physics.",
                card_2_title: "Mumbai (BOM) Record",
                card_2_desc: "Achieved on a single active runway (27) via 'High Speed Exit' compliance and aggressive mixed-mode interleaving.",
                card_3_title: "SFO Parallel Throughput",
                card_3_desc: "Capacity halves when clouds drop. SFO's parallel runways are too close (750ft) for standard independent ops, creating a massive vulnerability.",
                unit_movements: "Movements / Hour",
                unit_movements_day: "Movements / 24 Hours",
                unit_vmc_imc: "VMC (Clear) vs IMC (Cloudy)",
                
                chart_title: "Benchmarking Global Efficiency",
                chart_subtitle: "Comparing peak hourly sustained movement rates (Arr+Dep) on constrained runway configurations.",
                chart_note: "* Comparison of 'Constrained Operations': Included are single runways (LGW, BOM, SAN, old SZX) and dependent parallel runways (SFO in IMC).",
                
                core_title: "The Anatomy of a Bottleneck",
                constraint_1_title: "Wake Turbulence: The Invisible Wall",
                constraint_1_desc: "Every aircraft generates powerful counter-rotating vortices from its wingtipsâ€”essentially horizontal tornadoes that can flip a smaller trailing aircraft. This is not a bureaucratic rule; it is physics. <br><br>To survive, a Medium aircraft (like A320) must stay <strong>5 nautical miles</strong> behind a Heavy (like B777). At approach speeds, this creates a mandatory time gap of ~2 minutes where the runway sits empty. Capacity is purely a function of how fast these vortices dissipate.",
                recat_title: "Solution: RECAT-EU/US",
                recat_desc: "Traditional categories (Heavy/Medium/Light) were too broad. New 'Recategorization' standards split aircraft into 6+ tiers (e.g., 'Upper Heavy', 'Lower Heavy'), allowing controllers to safely shave off 0.5-1.0 NM separation in specific pairs, boosting capacity by 5-10%.",
                
                constraint_2_title: "ROT: The Runway Occupancy Time",
                constraint_2_desc: "ROT is the stopwatch measurement from the moment an aircraft crosses the landing threshold until its tail completely clears the runway line. <br><br>A trailing aircraft cannot be cleared to land (or in some regulations, cross the threshold) until the runway is clear. High ROT is a capacity killer. If pilots miss a 'High Speed Exit' and have to taxi to the end, a 50-second routine turns into a 90-second delay, forcing the next arrival to go around.",
                geo_title: "Geometry Matters",
                geo_desc: "Airports like Mumbai and Gatwick design 'Rapid Exit Taxiways' (RETs) angled at 30 degrees, allowing planes to turn off at 50 knots (93 km/h). Standard 90-degree exits require slowing to 10 knots, adding 20+ seconds to ROT.",

                bom_title: "Case Study: The Mumbai Miracle",
                bom_intro: "Mumbai (BOM) operates in a league of its own. While surrounded by urban density that prevents adding parallel runways, it handles traffic volumes comparable to dual-runway airports like Heathrow. The secret lies in a high-pressure, high-precision operational culture.",
                strat_1_title: "Psychology of 'Immediate Exit'",
                strat_1_desc: "In Mumbai, ROT is not just a metric; it's a mandate. Pilots are briefed to apply maximum safe braking upon touchdown. ATC monitors braking performance. If a pilot rolls too long and misses the Rapid Exit Taxiway (N8 or N6), they disrupt the 'conveyor belt' and may face an inquiry. The target ROT is a blistering 48-50 seconds.",
                strat_2_title: "The 'Inter-Arrival' Departure",
                strat_2_desc: "Most airports run segregated modes (one runway for arrival, one for departure). BOM runs 'Mixed Mode' on a single strip. Controllers insert a departure into the gap between two arrivals. <br><strong>The Sequence:</strong> Arrival 1 touches down -> Departure 1 enters runway immediately -> Arrival 1 clears runway -> Departure 1 takes off -> Arrival 2 crosses threshold. The margin for error is often less than 15 seconds.",
                strat_3_title: "Homogenizing the Fleet",
                strat_3_desc: "Variance is the enemy of capacity. A slow propeller plane or a private jet acts like a stone in a flowing river. During peak hours (0800-1100, 1800-2200), BOM heavily restricts non-scheduled flights. By ensuring everyone flies at similar approach speeds (approx 140-150kts), ATC can compress gaps to the absolute minimum.",
                
                diag_title: "LIVE OPS VISUALIZATION",
                diag_dep: "DEPARTURE<br>Rolling (T-0s)",
                diag_exit: "PREV ARRIVAL<br>Clearing (T-45s)",
                diag_arr: "NEXT ARRIVAL<br>Dist: 3.5 NM<br>Time to Threshold: 90s",
                diag_sep: "Min Separation",
                diag_quote: "\"The departure must be rolling before the arrival crosses the 4 mile mark. It's a game of seconds.\"",

                sfo_title: "SFO Tech: Breaking the 2500ft Rule",
                sfo_intro: "San Francisco (SFO) presents a unique geometric nightmare: two parallel runways (28L & 28R) separated by only <strong>750 feet (228m)</strong>. Standard FAA safety rules require 4,300ft separation for independent simultaneous instrument approaches. Without special tech, SFO is legally a single-runway airport in bad weather.",
                prm_title: "1. PRM (Precision Runway Monitor)",
                prm_desc: "Standard airport radar rotates every 4.8 secondsâ€”too slow to detect a blunder at 750ft separation. SFO uses an electronically scanned PRM radar with a <strong>1.0 second update rate</strong>. <br>A dedicated 'Monitor Controller' watches the 'No Transgression Zone' (NTZ) between the runways. They have an override frequency. If a plane twitches toward the NTZ, the controller instantly commands a 'Breakout' maneuver to the parallel aircraft.",
                soia_title: "2. SOIA (Simultaneous Offset Instrument Approach)",
                soia_desc: "This is the workaround for cloudy days. 28L flies a straight ILS approach. 28R flies an LDA approach offset by 3 degrees. The planes fly in clouds, paired via PRM radar. <br><strong>The Critical Moment:</strong> They must break out of the clouds by ~2,100ft. The 28R pilot <em>must</em> visually see the 28L plane and the runway to continue. If they see it, they side-step to align and land. If the clouds are too low (below 1,600ft), SOIA fails, and the capacity crashes.",
                weather_title: "The 'Marine Layer' Curse",
                weather_desc: "San Francisco's famous fog often sits right at 1,000ft. This is the 'kill zone' for operations. It's too low for SOIA visual confirmation, forcing SFO to revert to single-stream arrivals. This reduces arrival capacity from 60 to 30 per hour, triggering the infamous 'Ground Delay Programs' that ripple across the entire US network.",
                legend_28l: "28L (Straight ILS)",
                legend_28r: "28R (Offset LDA)",
                legend_ntz: "NTZ (No Go Zone)",
                sfo_imc: "IMC (Cloudy)",
                sfo_vmc: "VMC (Clear)",
                sfo_visual_contact: "Visual Contact Required",

                lab_params: "Simulation Parameters",
                lbl_speed: "Approach Speed (Vref)",
                hint_speed: "Higher speed = less time on final approach, but higher inertia makes it harder to exit the runway quickly.",
                lbl_sep: "Radar Separation",
                hint_sep: "The safety gap. 3NM is standard. 5NM+ required for Heavy aircraft. Reducing this is the holy grail of ATC.",
                lbl_rot: "Runway Occupancy (ROT)",
                hint_rot: "Time on concrete. Depends on High Speed Exits (RET) availability and pilot discipline.",
                res_header: "Theoretical Max Capacity",
                
                lbl_lgw: "Gatwick (LGW)",
                lbl_bom: "Mumbai (BOM)",
                lbl_san: "San Diego (SAN)",
                lbl_szx: "Shenzhen (Old)",
                lbl_xmn: "Xiamen (XMN)",
                chart_tooltip: "Movements/Hr"
            },
            zh: {
                nav_title: "æœºåœºè¿åŠ›ç ”ç©¶å®¤",
                tab_overview: "æ ¸å¿ƒåˆ†æ",
                tab_mumbai: "å­Ÿä¹°æ¡ˆä¾‹",
                tab_sfo: "SFOæŠ€æœ¯è§£æ",
                tab_lab: "ä»¿çœŸæ¨¡æ‹Ÿ",
                header_tag: "æ·±åº¦æŠ€æœ¯æŠ¥å‘Š",
                header_title: "é¥±å’Œçš„ç‰©ç†å­¦ï¼š<br>å•è·‘é“å®¹é‡æé™ç ”ç©¶",
                header_desc: "æ·±å…¥æ¢è®¨å†³å®šå…¨çƒèˆªç©ºååé‡çš„ç©ºæ°”åŠ¨åŠ›å­¦ä¸è¿è¡Œç“¶é¢ˆã€‚<br>ç‰¹åˆ«èšç„¦ï¼š<span class='text-indigo-700 font-semibold decoration-indigo-200 underline decoration-2 underline-offset-2'>å­Ÿä¹°æœºåœºçš„æé™ä¼˜åŒ–</span> ä¸ <span class='text-purple-700 font-semibold decoration-purple-200 underline decoration-2 underline-offset-2'>æ—§é‡‘å±±æœºåœºçš„é…å¯¹è¿›è¿‘æŠ€æœ¯</span>ã€‚",
                
                card_1_title: "ç†è®ºç‰©ç†å¤©èŠ±æ¿",
                card_1_desc: "è¿™æ˜¯ç”±é›·è¾¾æœ€å°é—´éš” (3NM) å’Œè¿›è¿‘é€Ÿåº¦ (140kts) å†³å®šçš„ç¡¬æ€§æé™ã€‚æƒ³è¦çªç ´å®ƒï¼Œå°±å¿…é¡»æ— è§†å°¾æµç‰©ç†å­¦ã€‚",
                card_2_title: "å­Ÿä¹° (BOM) çºªå½•",
                card_2_desc: "ä¾é å•ä¸€ä¸»è·‘é“(27)å®ç°ã€‚æ ¸å¿ƒæ‰‹æ®µï¼šå¼ºåˆ¶æ‰§è¡Œâ€œå¿«é€Ÿè„±ç¦»ç¨‹åºâ€ä»¥åŠæ¿€è¿›çš„æ··åˆèµ·é™ç©¿æ’ã€‚",
                card_3_title: "SFO å¹¶è¡Œååé‡",
                card_3_desc: "äº‘å±‚ä¸‹é™æ—¶è¿åŠ›å‡åŠã€‚SFOçš„ä¸¤æ¡å¹³è¡Œè·‘é“é—´è·ä»…750è‹±å°ºï¼Œæ— æ³•è¿›è¡Œæ ‡å‡†çš„ç‹¬ç«‹å¹³è¡Œä»ªè¡¨è¿è¡Œï¼Œè¿™æ˜¯å…¶å·¨å¤§çš„è½¯è‚‹ã€‚",
                unit_movements: "æ¶æ¬¡ / å°æ—¶",
                unit_movements_day: "æ¶æ¬¡ / 24å°æ—¶",
                unit_vmc_imc: "VMC (æ™´æœ—) vs IMC (é˜´äº‘)",
                
                chart_title: "å…¨çƒæ•ˆç‡åŸºå‡†å¯¹æ¯”",
                chart_subtitle: "å—é™è·‘é“æ„å‹ä¸‹çš„é«˜å³°å°æ—¶æŒç»­è¿è¡Œæ¶æ¬¡å¯¹æ¯” (è¿›æ¸¯+ç¦»æ¸¯)ã€‚",
                chart_note: "* â€œå—é™è¿è¡Œâ€åŒ…æ‹¬ï¼šå•è·‘é“æœºåœº (LGW, BOM, SAN, æ—§SZX) ä»¥åŠå—å¤©æ°”é™åˆ¶çš„å¹³è¡Œè·‘é“ (SFOäº‘ä¸­è¿è¡Œ)ã€‚",
                
                core_title: "è§£å‰–ç“¶é¢ˆ",
                constraint_1_title: "å°¾æµé—´éš”ï¼šçœ‹ä¸è§çš„å¢™",
                constraint_1_desc: "æ¯æ¶é£æœºéƒ½ä¼šä»ç¿¼å°–äº§ç”Ÿå¼ºå¤§çš„åå‘æ—‹è½¬æ¶¡æµâ€”â€”è¿™æœ¬è´¨ä¸Šæ˜¯æ°´å¹³æ–¹å‘çš„é¾™å·é£ï¼Œè¶³ä»¥æ€ç¿»åæ–¹çš„å°é£æœºã€‚è¿™ä¸ä»…æ˜¯è¡Œæ”¿è§„å®šï¼Œæ›´æ˜¯ç‰©ç†é“å¾‹ã€‚<br><br>ä¸ºäº†ç”Ÿå­˜ï¼Œä¸€æ¶ä¸­å‹æœº (å¦‚A320) å¿…é¡»ä¿æŒåœ¨é‡å‹æœº (å¦‚B777) åæ–¹ <strong>5æµ·é‡Œ</strong>ã€‚åœ¨è¿›è¿‘é€Ÿåº¦ä¸‹ï¼Œè¿™ä¼šäº§ç”Ÿçº¦2åˆ†é’Ÿçš„å¼ºåˆ¶æ—¶é—´ç¼ºå£ï¼ŒæœŸé—´è·‘é“å¿…é¡»é—²ç½®ã€‚è·‘é“å®¹é‡æœ¬è´¨ä¸Šå–å†³äºè¿™äº›æ¶¡æµæ¶ˆæ•£çš„é€Ÿåº¦ã€‚",
                recat_title: "è§£å†³æ–¹æ¡ˆï¼šRECAT (å°¾æµé‡åˆ†ç±»)",
                recat_desc: "ä¼ ç»Ÿçš„æœºå‹åˆ†ç±» (é‡/ä¸­/è½») è¿‡äºç²—ç³™ã€‚æ–°çš„ RECAT æ ‡å‡†å°†é£æœºç»†åˆ†ä¸º 6ä¸ªä»¥ä¸Šç­‰çº§ (å¦‚'è¶…é‡å‹', 'æ¬¡é‡å‹')ï¼Œå…è®¸ç®¡åˆ¶å‘˜åœ¨ç‰¹å®šé…å¯¹ä¸­å®‰å…¨ç¼©å‡ 0.5-1.0 æµ·é‡Œé—´éš”ï¼Œç›´æ¥æå‡ 5-10% çš„å®¹é‡ã€‚",
                
                constraint_2_title: "ROTï¼šè·‘é“å ç”¨æ—¶é—´",
                constraint_2_desc: "ROT æ˜¯æè¡¨è®¡ç®—çš„ï¼šä»é£æœºè¶Šè¿‡è·‘é“å…¥å£å¼€å§‹ï¼Œç›´åˆ°å…¶å°¾éƒ¨å®Œå…¨è¶Šè¿‡åœæ­¢çº¿ç¦»å¼€è·‘é“é“é¢ã€‚<br><br>åæœºåœ¨è·‘é“å‡€ç©ºå‰ï¼Œç»å¯¹æ— æ³•è·å¾—è½åœ°è®¸å¯ï¼ˆåœ¨æŸäº›è§„åˆ™ä¸­ç”šè‡³ä¸èƒ½è¶Šè¿‡å…¥å£ï¼‰ã€‚é«˜ ROT æ˜¯å®¹é‡æ€æ‰‹ã€‚å¦‚æœé£è¡Œå‘˜é”™è¿‡äº†â€œå¿«é€Ÿè„±ç¦»é“â€è¢«è¿«æ»‘è¡Œåˆ°å°½å¤´ï¼ŒåŸæœ¬50ç§’çš„æµç¨‹ä¼šå˜æˆ90ç§’çš„å»¶è¯¯ï¼Œè¿«ä½¿åæœºå¤é£ã€‚",
                geo_title: "å‡ ä½•å­¦å¾ˆå…³é”®",
                geo_desc: "å­Ÿä¹°å’Œç›–ç‰¹å¨å…‹ç­‰æœºåœºè®¾è®¡äº† 30åº¦è§’çš„â€œå¿«é€Ÿè„±ç¦»é“â€(RET)ï¼Œå…è®¸é£æœºä»¥ 50èŠ‚ (93 km/h) çš„é€Ÿåº¦é«˜é€Ÿè„±ç¦»ã€‚è€Œæ ‡å‡†çš„ 90åº¦å‚ç›´å‡ºå£è¦æ±‚å‡é€Ÿè‡³ 10èŠ‚ï¼Œè¿™ä¼šå¢åŠ  20ç§’ä»¥ä¸Šçš„å ç”¨æ—¶é—´ã€‚",

                bom_title: "æ¡ˆä¾‹ç ”ç©¶ï¼šå­Ÿä¹°å¥‡è¿¹",
                bom_intro: "å­Ÿä¹° (BOM) å±äºå¦ä¸€ä¸ªé‡çº§ã€‚å°½ç®¡å‘¨å›´å¯†é›†çš„åŸå¸‚å»ºç­‘é˜»æ­¢äº†å¹³è¡Œè·‘é“çš„å»ºè®¾ï¼Œå®ƒçš„ååé‡å´æ¯”è‚©å¸Œæ€ç½—ç­‰åŒè·‘é“æœºåœºã€‚ç§˜å¯†åœ¨äºä¸€ç§é«˜å‹ã€é«˜ç²¾åº¦çš„è¿è¡Œæ–‡åŒ–ã€‚",
                strat_1_title: "â€œç«‹å³è„±ç¦»â€çš„å¿ƒç†å­¦",
                strat_1_desc: "åœ¨å­Ÿä¹°ï¼ŒROT ä¸ä»…ä»…æ˜¯æŒ‡æ ‡ï¼Œæ›´æ˜¯é“ä»¤ã€‚é£è¡Œå‘˜è¢«å‘ŠçŸ¥åœ¨æ¥åœ°åå¿…é¡»ä½¿ç”¨æœ€å¤§å®‰å…¨åˆ¶åŠ¨ã€‚å¡”å°ä¼šç›‘æ§åˆ¹è½¦è¡¨ç°ã€‚å¦‚æœé£è¡Œå‘˜æ»‘è¡Œå¤ªè¿œé”™è¿‡äº†å¿«é€Ÿè„±ç¦»å£ (N8 æˆ– N6)ï¼Œå°±ä¼šæ‰“æ–­æ•´ä¸ªâ€œä¼ é€å¸¦â€èŠ‚å¥ï¼Œå¹¶å¯èƒ½é¢ä¸´é—®è¯¢ã€‚ä»–ä»¬çš„ç›®æ ‡ ROT æ˜¯æƒŠäººçš„ 48-50 ç§’ã€‚",
                strat_2_title: "â€œç¼éš™ä¸­â€çš„ç¦»æ¸¯",
                strat_2_desc: "å¤§å¤šæ•°æœºåœºé‡‡ç”¨éš”ç¦»æ¨¡å¼ï¼ˆä¸€æ¡è½åœ°ï¼Œä¸€æ¡èµ·é£ï¼‰ã€‚BOM åœ¨å•æ¡è·‘é“ä¸Šè¿è¡Œâ€œæ··åˆæ¨¡å¼â€ã€‚ç®¡åˆ¶å‘˜ä¼šå°†ä¸€æ¶èµ·é£é£æœºå¡è¿›ä¸¤æ¶è½åœ°é£æœºçš„ç¼éš™ä¸­ã€‚<br><strong>æé™æ—¶åºï¼š</strong> å‰æœºæ¥åœ° -> èµ·é£é£æœºç«‹å³è¿›è·‘é“ -> å‰æœºè„±ç¦» -> èµ·é£é£æœºç¦»åœ° -> åæœºè¶Šè¿‡å…¥å£ã€‚å®¹é”™ç©ºé—´å¾€å¾€ä¸è¶³15ç§’ã€‚",
                strat_3_title: "æœºé˜Ÿçš„åŒè´¨åŒ–",
                strat_3_desc: "å·®å¼‚æ˜¯å®¹é‡çš„æ•Œäººã€‚ä¸€æ¶æ…¢é€Ÿèºæ—‹æ¡¨é£æœºæˆ–ç§äººå–·æ°”æœºä¼šåƒæ¿€æµä¸­çš„çŸ³å¤´ä¸€æ ·é˜»ç¢äº¤é€šã€‚åœ¨é«˜å³°æ—¶æ®µ (0800-1100, 1800-2200)ï¼ŒBOM ä¸¥æ ¼é™åˆ¶éå®šæœŸèˆªç­ã€‚é€šè¿‡ç¡®ä¿æ‰€æœ‰é£æœºä»¥ç›¸ä¼¼é€Ÿåº¦ (çº¦140-150èŠ‚) è¿›è¿‘ï¼Œç®¡åˆ¶å‘˜å¯ä»¥å°†é—´éš”å‹ç¼©è‡³ç‰©ç†æé™ã€‚",
                
                diag_title: "å®æ—¶è¿è¡Œå¯è§†åŒ–",
                diag_dep: "ç¦»æ¸¯èˆªç­<br>èµ·é£æ»‘è·‘ (T-0s)",
                diag_exit: "å‰åºè¿›æ¸¯<br>æ­£åœ¨è„±ç¦» (T-45s)",
                diag_arr: "ååºè¿›æ¸¯<br>è·ç¦»: 3.5 NM<br>è·å…¥å£: 90s",
                diag_sep: "æœ€å°é—´éš”çº¢çº¿",
                diag_quote: "â€œç¦»æ¸¯é£æœºå¿…é¡»åœ¨è¿›æ¸¯é£æœºé£è¶Š4æµ·é‡Œç‚¹ä¹‹å‰å¼€å§‹æ»‘è·‘ã€‚è¿™æ˜¯ä¸€åœºäº‰åˆ†å¤ºç§’çš„æ¸¸æˆã€‚â€",

                sfo_title: "SFOæŠ€æœ¯ï¼šçªç ´2500è‹±å°ºé“å¾‹",
                sfo_intro: "æ—§é‡‘å±± (SFO) é¢ä¸´ç€ç‹¬ç‰¹çš„å‡ ä½•å™©æ¢¦ï¼šä¸¤æ¡å¹³è¡Œè·‘é“ (28L & 28R) é—´è·ä»… <strong>750è‹±å°º (228ç±³)</strong>ã€‚æ ‡å‡†çš„ FAA å®‰å…¨è§„åˆ™è¦æ±‚ 4300è‹±å°ºé—´éš”æ‰èƒ½è¿›è¡Œç‹¬ç«‹çš„å¹³è¡Œä»ªè¡¨è¿›è¿‘ã€‚æ²¡æœ‰ç‰¹æ®ŠæŠ€æœ¯ï¼ŒSFO åœ¨åå¤©æ°”ä¸‹æ³•å¾‹ä¸Šåªèƒ½ç®—ä½œå•è·‘é“æœºåœºã€‚",
                prm_title: "1. PRM (ç²¾å¯†è·‘é“ç›‘æ§)",
                prm_desc: "æ ‡å‡†æœºåœºé›·è¾¾æ¯ 4.8ç§’æ—‹è½¬ä¸€åœˆâ€”â€”å¯¹äº 750è‹±å°ºçš„é—´è·æ¥è¯´å¤ªæ…¢äº†ï¼Œæ— æ³•åŠæ—¶å‘ç°åå·®ã€‚SFO ä½¿ç”¨ç”µå­æ‰«æçš„ PRM é›·è¾¾ï¼Œæ‹¥æœ‰ <strong>1.0ç§’çš„è¶…é«˜æ›´æ–°ç‡</strong>ã€‚<br>ä¸€åä¸“é—¨çš„â€œç›‘æ§ç®¡åˆ¶å‘˜â€æ­»æ­»ç›¯ç€ä¸¤è·‘é“é—´çš„â€œéä¾µå…¥åŒºâ€(NTZ)ã€‚å¦‚æœä¸€æ¶é£æœºåå‘ NTZï¼Œè¯¥ç®¡åˆ¶å‘˜ä¼šç«‹å³åœ¨è¶…è¶Šæ³¢é“ä¸ŠæŒ‡ä»¤å¦ä¸€æ¶é£æœºâ€œBreakoutâ€(ç´§æ€¥é¿è®©)ã€‚",
                soia_title: "2. SOIA (åŒæ—¶åç§»ä»ªè¡¨è¿›è¿‘)",
                soia_desc: "è¿™æ˜¯é’ˆå¯¹å¤šäº‘å¤©æ°”çš„å˜é€šæ–¹æ¡ˆã€‚28L é£ç›´çº¿çš„ ILS è¿›è¿‘ã€‚28R é£ä¸€ä¸ªåç§» 3åº¦çš„ LDA è¿›è¿‘ã€‚ä¸¤æœºåœ¨äº‘ä¸­é€šè¿‡ PRM é›·è¾¾é…å¯¹é£è¡Œã€‚<br><strong>å…³é”®æ—¶åˆ»ï¼š</strong> å®ƒä»¬å¿…é¡»åœ¨çº¦ 2100è‹±å°ºé«˜åº¦å‡ºäº‘ã€‚28R çš„é£è¡Œå‘˜<em>å¿…é¡»</em>ç›®è§†çœ‹åˆ° 28L çš„é£æœºå’Œè·‘é“æ‰èƒ½ç»§ç»­ã€‚å¦‚æœçœ‹åˆ°äº†ï¼Œä»–ä»¬å°±ä¿®æ­£å¯¹æ­£é™è½ã€‚å¦‚æœäº‘å¤ªä½ (ä½äº1600è‹±å°º)ï¼ŒSOIA å¤±æ•ˆï¼Œè¿åŠ›å´©å¡Œã€‚",
                weather_title: "â€œæµ·é›¾å±‚â€è¯…å’’",
                weather_desc: "æ—§é‡‘å±±è‘—åçš„æµ·é›¾ç»å¸¸æ­£å¥½å¡åœ¨ 1000è‹±å°ºé«˜åº¦ã€‚è¿™æ˜¯è¿è¡Œçš„â€œæ­»äº¡åœ°å¸¦â€ã€‚å› ä¸ºå®ƒå¤ªä½äº†ï¼Œæ— æ³•æ»¡è¶³ SOIA çš„ç›®è§†è¦æ±‚ï¼Œè¿«ä½¿ SFO å€’é€€å›å•æµè¿›è¿‘ã€‚è¿›æ¸¯å®¹é‡ç¬é—´ä» 60 æ¶æ¬¡/æ—¶è·Œè‡³ 30ï¼Œè§¦å‘æ³¢åŠå…¨ç¾çš„åœ°é¢å»¶è¯¯ç¨‹åº (GDP)ã€‚",
                legend_28l: "28L (ç›´çº¿ ILS)",
                legend_28r: "28R (åç§» LDA)",
                legend_ntz: "NTZ (ç¦åŒº)",
                sfo_imc: "IMC (é˜´å¤©)",
                sfo_vmc: "VMC (æ™´å¤©)",
                sfo_visual_contact: "å¿…é¡»ç›®è§†è·‘é“",

                lab_params: "ä»¿çœŸå‚æ•°æ§åˆ¶å°",
                lbl_speed: "è¿›è¿‘é€Ÿåº¦ (Vref)",
                hint_speed: "é€Ÿåº¦è¶Šå¿« = å ç”¨ç©ºåŸŸæ—¶é—´è¶ŠçŸ­ï¼Œä½†æƒ¯æ€§æ›´å¤§ï¼Œæ›´éš¾å¿«é€Ÿè„±ç¦»è·‘é“ã€‚",
                lbl_sep: "é›·è¾¾é—´éš”",
                hint_sep: "å®‰å…¨çº¢çº¿ã€‚æ ‡å‡†æ˜¯3æµ·é‡Œã€‚é‡å‹æœºéœ€è¦5æµ·é‡Œä»¥ä¸Šã€‚ç¼©çŸ­è¿™ä¸ªè·ç¦»æ˜¯ç©ºç®¡ç•Œçš„åœ£æ¯ã€‚",
                lbl_rot: "è·‘é“å ç”¨æ—¶é—´ (ROT)",
                hint_rot: "è½®èƒåœ¨æ··å‡åœŸä¸Šçš„æ—¶é—´ã€‚å–å†³äºå¿«é€Ÿè„±ç¦»é“(RET)çš„è®¾è®¡å’Œé£è¡Œå‘˜çš„æ‰§è¡ŒåŠ›ã€‚",
                res_header: "ç†è®ºæé™å®¹é‡",
                
                lbl_lgw: "ä¼¦æ•¦ç›–ç‰¹å¨å…‹ (LGW)",
                lbl_bom: "å­Ÿä¹° (BOM)",
                lbl_san: "åœ£åœ°äºšå“¥ (SAN)",
                lbl_szx: "æ·±åœ³ (æ—§SZX)",
                lbl_xmn: "å¦é—¨ (XMN)",
                chart_tooltip: "æ¶æ¬¡ / å°æ—¶"
            }
        };

        let currentLang = 'en';

        // --- Language Switcher ---
        function toggleLanguage() {
            const btn = document.getElementById('langSwitch');
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            
            // Toggle UI class
            if(currentLang === 'zh') {
                btn.classList.remove('en');
                btn.classList.add('zh');
            } else {
                btn.classList.remove('zh');
                btn.classList.add('en');
            }

            // Update DOM text
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(translations[currentLang][key]) {
                    el.innerHTML = translations[currentLang][key];
                }
            });

            // Update Charts and Visuals
            updateChartLanguage();
            drawSFO();
            updateSimulation(); 
        }

        // --- Navigation Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById('view-' + tabId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('nav-' + tabId).classList.add('active');

            if(tabId === 'sfo') {
                setTimeout(drawSFO, 100); 
            }
        }

        // --- Chart.js: Global Comparison ---
        let globalChart;
        function initChart() {
            const ctxGlobal = document.getElementById('globalChart').getContext('2d');
            const t = translations[currentLang];
            
            Chart.defaults.font.family = "'Noto Sans', 'Noto Sans SC', sans-serif";
            
            globalChart = new Chart(ctxGlobal, {
                type: 'bar',
                data: {
                    labels: [t.lbl_lgw, t.lbl_bom, t.lbl_san, t.lbl_szx, t.lbl_xmn],
                    datasets: [{
                        label: t.chart_tooltip,
                        data: [55, 52, 42, 45, 36],
                        backgroundColor: [
                            '#3b82f6', // LGW Blue
                            '#10b981', // BOM Green (Highlight)
                            '#64748b', // SAN Slate
                            '#94a3b8',
                            '#cbd5e1'
                        ],
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    return context.raw + ' ' + translations[currentLang].chart_tooltip;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 65,
                            grid: { color: '#f1f5f9' },
                            ticks: { font: { size: 11 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11, weight: '500' } }
                        }
                    }
                }
            });
        }

        function updateChartLanguage() {
            if(!globalChart) return;
            const t = translations[currentLang];
            globalChart.data.labels = [t.lbl_lgw, t.lbl_bom, t.lbl_san, t.lbl_szx, t.lbl_xmn];
            globalChart.data.datasets[0].label = t.chart_tooltip;
            globalChart.update();
        }

        // --- SFO Canvas Drawing ---
        function drawSFO() {
            const canvas = document.getElementById('sfoCanvas');
            if (!canvas.offsetParent) return; 
            
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            const t = translations[currentLang];

            // Clear
            ctx.fillStyle = '#0f172a'; // Slate 900
            ctx.fillRect(0, 0, w, h);

            // Draw Runways (Right side)
            ctx.fillStyle = '#64748b';
            ctx.fillRect(w - 120, h/2 - 35, 100, 10); // 28L
            ctx.fillRect(w - 120, h/2 + 25, 100, 10); // 28R

            // 28L Path (Straight)
            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6'; // Blue
            ctx.lineWidth = 3;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#3b82f6';
            ctx.moveTo(0, h/2 - 30);
            ctx.lineTo(w - 120, h/2 - 30);
            ctx.stroke();
            ctx.shadowBlur = 0; // Reset

            // 28R Path (SOIA Offset)
            ctx.beginPath();
            ctx.strokeStyle = '#a855f7'; // Purple
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 6]); // Dashed for "In Cloud"
            ctx.moveTo(0, h/2 + 100); // Start offset lower
            ctx.lineTo(w - 250, h/2 + 30); // Merge point (Cloud break)
            ctx.stroke();

            ctx.beginPath();
            ctx.setLineDash([]); // Solid for "Visual"
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#a855f7';
            ctx.moveTo(w - 250, h/2 + 30);
            ctx.lineTo(w - 120, h/2 + 30);
            ctx.stroke();
            ctx.shadowBlur = 0;

            // NTZ (No Transgression Zone)
            ctx.fillStyle = 'rgba(239, 68, 68, 0.1)';
            ctx.fillRect(0, h/2 - 10, w, 20);
            ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
            ctx.setLineDash([2, 4]);
            ctx.beginPath();
            ctx.moveTo(0, h/2);
            ctx.lineTo(w, h/2);
            ctx.stroke();

            // Cloud Layer
            const gradient = ctx.createLinearGradient(0, 0, w, 0);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.15)');
            gradient.addColorStop(0.6, 'rgba(255, 255, 255, 0.05)');
            gradient.addColorStop(0.75, 'rgba(255, 255, 255, 0)'); // Breakout point
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, w, h);
            
            // Labels
            ctx.font = 'bold 12px sans-serif';
            ctx.fillStyle = '#94a3b8';
            ctx.fillText(t.sfo_imc.toUpperCase(), 30, 40);
            ctx.fillText(t.sfo_vmc.toUpperCase(), w - 180, 40);
            
            // Breakout Marker
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(w - 250, h/2 + 30, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.font = '10px sans-serif';
            ctx.fillText(t.sfo_visual_contact, w - 280, h/2 + 55);
        }

        // --- Simulator Logic ---
        function updateSimulation() {
            const speed = parseInt(document.getElementById('in-speed').value);
            const sep = parseFloat(document.getElementById('in-sep').value);
            const rot = parseInt(document.getElementById('in-rot').value);

            // Update display
            document.getElementById('disp-speed').innerText = speed + " kts";
            document.getElementById('disp-sep').innerText = sep.toFixed(1) + " nm";
            document.getElementById('disp-rot').innerText = rot + " s";

            // Calculation
            const sepTime = (sep / speed) * 3600;
            const constraint = Math.max(sepTime, rot);
            const effectiveInterval = constraint + 10; // Buffer
            
            let capacity = Math.round(3600 / effectiveInterval);
            if(capacity > 65) capacity = 65;

            // Update UI
            document.getElementById('res-cap').innerText = capacity;
            
            // Logarithmic-ish scaling for bar visualization
            const minCap = 25;
            const maxCap = 65;
            const pct = Math.max(0, Math.min(100, ((capacity - minCap) / (maxCap - minCap)) * 100));
            
            const bar = document.getElementById('cap-bar');
            bar.style.width = pct + "%";

            // Color shift based on capacity
            if (capacity > 50) {
                bar.className = "h-full bg-gradient-to-r from-emerald-400 to-emerald-600 transition-all duration-700 ease-out shadow-lg shadow-emerald-200";
            } else if (capacity > 38) {
                bar.className = "h-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-700 ease-out shadow-lg shadow-blue-200";
            } else {
                bar.className = "h-full bg-gradient-to-r from-amber-400 to-rose-500 transition-all duration-700 ease-out shadow-lg shadow-rose-200";
            }

            // Analysis Text Localization
            const titleEl = document.getElementById('res-title');
            const descEl = document.getElementById('res-desc');
            const isEn = currentLang === 'en';
            
            if (capacity > 50) {
                titleEl.className = "font-bold text-emerald-700 mb-2 text-lg";
                titleEl.innerText = isEn ? "Elite Efficiency (BOM/LGW Level)" : "ç²¾è‹±çº§æ•ˆç‡ (BOM/LGWæ°´å¹³)";
                descEl.innerText = isEn 
                    ? `At ${capacity} movements/hour, you are operating at the bleeding edge. This requires mixed-mode operations and flawless runway discipline. Any hesitation causes a go-around.`
                    : `ä»¥æ¯å°æ—¶ ${capacity} æ¶æ¬¡çš„é€Ÿç‡è¿è¡Œï¼Œæ‚¨æ­£å¤„äºæé™è¾¹ç¼˜ã€‚è¿™éœ€è¦æ··åˆèµ·é™æ¨¡å¼å’Œå®Œç¾çš„è·‘é“çºªå¾‹ã€‚ä»»ä½•è¿Ÿç–‘éƒ½ä¼šå¯¼è‡´å¤é£ã€‚`;
            } else if (capacity > 38) {
                titleEl.className = "font-bold text-blue-700 mb-2 text-lg";
                titleEl.innerText = isEn ? "Standard High Volume" : "æ ‡å‡†ç¹å¿™æ°´å¹³";
                descEl.innerText = isEn 
                    ? "Typical for busy single-runway airports. You are constrained primarily by wake turbulence separation. RECAT implementation could squeeze out 2-3 more slots."
                    : "ç¹å¿™å•è·‘é“æœºåœºçš„å…¸å‹å€¼ã€‚ä¸»è¦å—é™äºå°¾æµé—´éš”ã€‚å®æ–½ RECAT æ ‡å‡†å¯èƒ½æŒ¤å‡º 2-3 ä¸ªé¢å¤–æ—¶åˆ»ã€‚";
            } else {
                titleEl.className = "font-bold text-rose-700 mb-2 text-lg";
                titleEl.innerText = isEn ? "Congested / Sub-optimal" : "æ‹¥å µ / ä½æ•ˆ";
                descEl.innerText = isEn 
                    ? "Capacity is severely limited. Causes likely include excessive separation buffers or slow runway exits (high ROT). Expect holding patterns."
                    : "å®¹é‡å—åˆ°ä¸¥é‡é™åˆ¶ã€‚åŸå› å¯èƒ½æ˜¯é—´éš”ç¼“å†²è¿‡å¤§æˆ–è·‘é“è„±ç¦»ç¼“æ…¢ (é«˜ ROT)ã€‚é¢„è®¡ä¼šå‡ºç°ç©ºä¸­ç›˜æ—‹ç­‰å¾…ã€‚";
            }
        }

        // --- Event Listeners ---
        window.addEventListener('resize', drawSFO);
        
        ['in-speed', 'in-sep', 'in-rot'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateSimulation);
        });

        // Init
        window.onload = function() {
            initChart();
            updateSimulation();
            updateChartLanguage(); 
        };

    </script>
</body>
</html>
