<!DOCTYPE html>
<html lang="en">
<head>
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6214772877334340"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In-Depth SAP ERP User Analysis Report (Fully Anonymized Version)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            background-color: #f8f9fa;
            margin: 0;
            padding: 15px;
        }
        .container {
            max-width: 1600px;
            margin: auto;
            background: #fff;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
        }
        .logo {
            position: absolute;
            top: 30px;
            left: 30px;
            font-size: 1.8em;
            font-weight: bold;
            color: #1a3a6e;
            letter-spacing: 1px;
        }
        h1, h2, h3 {
            color: #1a3a6e;
            border-bottom: 3px solid #1a3a6e;
            padding-bottom: 10px;
            margin-top: 35px;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            font-size: 2.8em;
            border-bottom: none;
        }
        .executive-summary {
            background-color: #eef3f9;
            border-left: 6px solid #1a3a6e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            text-align: center;
            margin-bottom: 30px;
        }
        .summary-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .summary-card .number {
            font-size: 3em;
            font-weight: 700;
            color: #1a3a6e;
        }
        .summary-card .label {
            font-size: 1.1em;
            color: #555;
            margin-top: 10px;
        }
        .tabs {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 25px;
        }
        .tab-link {
            padding: 12px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            position: relative;
            transition: color 0.3s;
        }
        .tab-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 3px;
            background-color: #1a3a6e;
            transition: width 0.3s;
        }
        .tab-link.active, .tab-link:hover {
            color: #1a3a6e;
        }
        .tab-link.active::after, .tab-link:hover::after {
            width: 100%;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .table-container {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        th, td {
            padding: 14px;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            white-space: nowrap;
        }
        th {
            background-color: #1a3a6e;
            color: white;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e9ecef;
        }
        .search-box {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
        }
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .analysis-section {
            background: #fdfdff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .recommendation-list {
            list-style-type: none;
            padding-left: 0;
        }
        .recommendation-list li {
            background: #eef3f9;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .recommendation-list li strong {
            color: #1a3a6e;
            display: block;
            margin-bottom: 5px;
        }
        .tag {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            color: #fff;
            display: inline-block;
            margin: 2px;
        }
        .tag-danger { background-color: #dc3545; }
        .tag-warning { background-color: #ffc107; color: #333; }
        .tag-success { background-color: #28a745; }
        .tag-info { background-color: #17a2b8; }
        .tag-secondary { background-color: #6c757d; }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
            font-size: 0.9em;
        }
        footer p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="logo">INOSSEM</div>
    <h1>In-Depth SAP ERP User Analysis Report (Fully Anonymized Version)</h1>

    <div class="executive-summary">
        <h2>Executive Summary</h2>
        <p>This analysis aims to assess the current state of system usage, identify potential risks, and provide data-driven support for management decisions by conducting an in-depth analysis of the login activities, permission assignments, and operational behaviors of **8,000 users** in the SAP ERP system. The analysis found that approximately **18% (1,440) of the total users** have never logged in over the past year, constituting "zombie accounts." Additionally, some active users have been granted an excessive number of composite roles (over 15), increasing the risks of unclear Segregation of Duties (SoD) and internal control weaknesses. Furthermore, a few "super accounts" with abnormally high login frequencies (indicating possible account sharing), "suspicious accounts" with frequent off-hours logins, and "dormant high-privilege accounts" with significant permissions but no recent activity were identified. From a functional usage perspective, core transactional functions like Finance (FI) and Materials Management (MM) show high adoption, whereas the utilization of specialized functions such as Project System (PS) and Plant Maintenance (PM) needs improvement outside of specific departments, suggesting opportunities for process optimization and targeted training. This report will detail the analysis results and propose specific optimization recommendations.</p>
    </div>

    <h2>Key Metrics Dashboard</h2>
    <div class="summary-grid">
        <div class="summary-card">
            <div class="number" id="totalUsers">8000</div>
            <div class="label">Total Users</div>
        </div>
        <div class="summary-card">
            <div class="number" id="activeUsers">6560</div>
            <div class="label">Active Users</div>
        </div>
        <div class="summary-card">
            <div class="number" id="inactiveUsers">1440</div>
            <div class="label">Inactive Users</div>
        </div>
        <div class="summary-card">
            <div class="number" id="watchlistUsers">512</div>
            <div class="label">High-Risk Users</div>
        </div>
    </div>

    <div class="chart-container">
        <div class="analysis-section">
            <h3>User Status Distribution</h3>
            <canvas id="userStatusChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Top 10 Business Units by Active Users</h3>
            <canvas id="activeUsersByDeptChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Active User Distribution by Core Module</h3>
            <canvas id="moduleUsageChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Active User Distribution by Core Function</h3>
            <canvas id="functionUsageChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Risk Type Distribution</h3>
            <canvas id="riskTypeChart"></canvas>
        </div>
    </div>
    
    <div class="analysis-section">
        <h2>In-Depth Insights & Recommendations</h2>
        <ul class="recommendation-list">
            <li>
                <strong>Account Lifecycle Management</strong>
                Initiate a cleanup process for the <strong>1,440 inactive users</strong>. After confirming with business departments, lock or delete these accounts to reclaim licenses. Concurrently, conduct an urgent review of the <strong>180 "dormant high-privilege accounts"</strong> to immediately revoke their permissions or accounts.
            </li>
            <li>
                <strong>Permission Compliance & SoD Review</strong>
                Identified <strong>388 users</strong> with over 15 composite roles. The internal audit team should conduct an SoD conflict analysis for these users, adhering to the "Principle of Least Privilege" to remove unnecessary roles. Pay special attention to users with a high "roles-to-logins" ratio, as their permissions are likely redundant.
            </li>
            <li>
                <strong>Abnormal Behavior Monitoring</strong>
                Discovered <strong>27 "suspected shared accounts"</strong> and <strong>135 accounts with frequent "off-hours logins."</strong> Investigate these accounts immediately, reinforce the "one user, one account" policy, and verify the business justification for off-hours access to prevent unauthorized activities.
            </li>
             <li>
                <strong>Enhance System Adoption Depth & Breadth</strong>
                System adoption for certain business units (e.g., "Technology R&D Center") and specific business functions (e.g., Project Management, Plant Maintenance) needs improvement. We recommend targeted training to promote the ERP's core functionalities, address user operational challenges, and facilitate deeper integration between business processes and system capabilities to maximize ROI.
            </li>
        </ul>
    </div>


    <div class="tabs">
        <div class="tab-link active" onclick="openTab(event, 'watchlist')">High-Risk User List</div>
        <div class="tab-link" onclick="openTab(event, 'validUsers')">Active User List</div>
        <div class="tab-link" onclick="openTab(event, 'invalidUsers')">Inactive User List</div>
    </div>

    <div id="watchlist" class="tab-content active">
        <h2>High-Risk User List</h2>
        <p>These users have been identified due to excessive permissions, abnormal behavior, or holding high-privilege access while being inactive. They require priority review.</p>
        <input type="text" id="watchlistSearch" class="search-box" onkeyup="searchTable('watchlist')" placeholder="Search high-risk users...">
        <div class="table-container">
            <table id="watchlistTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0, 'watchlistTable')">User ID</th>
                        <th onclick="sortTable(1, 'watchlistTable')">Name</th>
                        <th onclick="sortTable(2, 'watchlistTable')">Business Unit / Dept.</th>
                        <th onclick="sortTable(3, 'watchlistTable')">Annual Logins</th>
                        <th onclick="sortTable(4, 'watchlistTable')">Composite Roles</th>
                        <th onclick="sortTable(5, 'watchlistTable')">Risk Tags</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="validUsers" class="tab-content">
        <h2>Active User List</h2>
        <p>Users who have logged in within the past year. These are the core users of the system.</p>
        <input type="text" id="validSearch" class="search-box" onkeyup="searchTable('valid')" placeholder="Search active users...">
        <div class="table-container">
            <table id="validTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0, 'validTable')">User ID</th>
                        <th onclick="sortTable(1, 'validTable')">Name</th>
                        <th onclick="sortTable(2, 'validTable')">Business Unit / Dept.</th>
                        <th onclick="sortTable(3, 'validTable')">Annual Logins</th>
                        <th onclick="sortTable(4, 'validTable')">Composite Roles</th>
                        <th onclick="sortTable(5, 'validTable')">Core Module</th>
                        <th onclick="sortTable(6, 'validTable')">Core Function</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="invalidUsers" class="tab-content">
        <h2>Inactive User List</h2>
        <p>Users with no login activity in the past year. These accounts should be reviewed for retention.</p>
        <input type="text" id="invalidSearch" class="search-box" onkeyup="searchTable('invalid')" placeholder="Search inactive users...">
        <div class="table-container">
            <table id="invalidTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0, 'invalidTable')">User ID</th>
                        <th onclick="sortTable(1, 'invalidTable')">Name</th>
                        <th onclick="sortTable(2, 'invalidTable')">Business Unit / Dept.</th>
                        <th onclick="sortTable(3, 'invalidTable')">Composite Roles</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <footer>
        <p>Author: INOSSEM Global Research Team</p>
        <p>Version: INOSSEM Copyright</p>
        <p style="font-size: 0.8em; margin-top: 15px;">
            This is a customized service provided by INOSSEM Global Research Team based on AI Agent to help users optimize ID and License management. The service starts from 1 week and costs from $10,000.
        </p>
    </footer>
</div>

<script>
    // --- Data Generation and Anonymization ---
    const names = ["John Smith", "Jane Doe", "Peter Jones", "Mary Williams", "David Brown", "Susan Miller", "Robert Davis", "Linda Garcia", "Michael Rodriguez", "Patricia Wilson", "James Martinez", "Jennifer Anderson", "William Taylor", "Elizabeth Thomas", "Richard Moore", "Jessica Jackson", "Joseph White", "Karen Harris"];
    const depts = ["Subsidiary A", "Subsidiary B", "Subsidiary C", "Subsidiary D", "Subsidiary E", "Subsidiary F", "Subsidiary G", "Subsidiary H", "Subsidiary I", "Subsidiary J", "Subsidiary K", "Technical Services Division A", "Engineering Services Division B", "Technology R&D Center", "IT Division", "Logistics Service Center", "Finance Department", "Human Resources Dept."];
    
    const moduleFunctionMap = {
        "FI": ["Accounts Payable (AP)", "Accounts Receivable (AR)", "General Ledger (GL)", "Asset Accounting (AA)"],
        "MM": ["Purchasing (PUR)", "Inventory Management (IM)", "Invoice Verification (IV)"],
        "PM": ["Preventive Maintenance", "Maintenance Processing", "Equipment Management"],
        "HR": ["Payroll", "Organizational Management", "Time Management"],
        "PS": ["Project Planning", "Project Cost Control", "Project Settlement"],
        "SD": ["Sales Order Processing", "Goods Issue", "Billing"],
        "CO": ["Cost Center Accounting", "Internal Orders", "Profit Center Accounting"]
    };
    const modules = Object.keys(moduleFunctionMap);

    function anonymizeId(id, index) {
        const part1 = id.substring(0, 3).toUpperCase();
        const part2 = (index % 1000).toString().padStart(3, '0');
        return `USR-${part1}${part2}`;
    }

    let rawUserData = [];
    for (let i = 0; i < 8000; i++) {
        const originalId = `USER${i}`;
        let logins = Math.random() < 0.18 ? 0 : Math.floor(Math.pow(Math.random(), 2) * 300) + 1;
        let roles = Math.floor(Math.random() * 25) + 1;
        
        if (i > 7900) { 
            logins = Math.floor(Math.random() * 400) + 600;
        }
        if (i > 7800 && i <= 7900) {
            roles = Math.floor(Math.random() * 15) + 16;
        }

        const primaryModule = modules[i % modules.length];
        const functions = moduleFunctionMap[primaryModule];
        const primaryFunction = functions[i % functions.length];

        rawUserData.push({
            id: anonymizeId(originalId, i),
            name: names[i % names.length],
            dept: depts[i % depts.length],
            logins: logins,
            roles: roles,
            primaryModule: primaryModule,
            primaryFunction: primaryFunction,
            offHoursLogins: Math.random() < 0.1,
        });
    }

    // --- Data Processing ---
    const allUsers = [...rawUserData];
    const validUsersData = allUsers.filter(u => u.logins > 0);
    const invalidUsersData = allUsers.filter(u => u.logins === 0);
    
    const riskReasons = {
        highRoles: { text: 'Excessive Permissions', class: 'tag-warning', count: 0 },
        sharedAccount: { text: 'Suspected Shared Account', class: 'tag-danger', count: 0 },
        dormantHighPrivilege: { text: 'Dormant High-Privilege', class: 'tag-info', count: 0 },
        offHours: { text: 'Off-Hours Login', class: 'tag-secondary', count: 0 }
    };

    const watchlistData = allUsers.filter(u => {
        const isHighRoles = u.roles > 15;
        const isShared = u.logins > 500;
        const isDormantHigh = u.logins === 0 && u.roles > 10;
        const isOffHours = u.logins > 0 && u.offHoursLogins;
        return isHighRoles || isShared || isDormantHigh || isOffHours;
    }).map(u => {
        let tags = [];
        if (u.roles > 15) {
            tags.push(riskReasons.highRoles);
            riskReasons.highRoles.count++;
        }
        if (u.logins > 500) {
            tags.push(riskReasons.sharedAccount);
            riskReasons.sharedAccount.count++;
        }
        if (u.logins === 0 && u.roles > 10) {
            tags.push(riskReasons.dormantHighPrivilege);
            riskReasons.dormantHighPrivilege.count++;
        }
        if (u.logins > 0 && u.offHoursLogins) {
            tags.push(riskReasons.offHours);
            riskReasons.offHours.count++;
        }
        u.riskTags = tags;
        return u;
    });
    
    // --- UI Update ---
    document.getElementById('totalUsers').textContent = allUsers.length;
    document.getElementById('activeUsers').textContent = validUsersData.length;
    document.getElementById('inactiveUsers').textContent = invalidUsersData.length;
    document.getElementById('watchlistUsers').textContent = new Set(watchlistData.map(u => u.id)).size;


    function populateTable(tableId, data, type) {
        const tableBody = document.querySelector(`#${tableId} tbody`);
        let tableHtml = '';
        data.forEach(user => {
            let rowHtml = `<tr>
                <td>${user.id}</td>
                <td>${user.name}</td>
                <td>${user.dept}</td>`;
            
            if (type === 'valid') {
                rowHtml += `<td>${user.logins}</td><td>${user.roles}</td><td>${user.primaryModule}</td><td>${user.primaryFunction}</td>`;
            } else if (type === 'invalid') {
                rowHtml += `<td>${user.roles}</td>`;
            } else if (type === 'watchlist') {
                const tagsHtml = user.riskTags.map(t => `<span class="tag ${t.class}">${t.text}</span>`).join(' ');
                rowHtml += `<td>${user.logins}</td><td>${user.roles}</td><td>${tagsHtml}</td>`;
            }
            
            rowHtml += '</tr>';
            tableHtml += rowHtml;
        });
        tableBody.innerHTML = tableHtml;
    }

    populateTable('validTable', validUsersData, 'valid');
    populateTable('invalidTable', invalidUsersData, 'invalid');
    populateTable('watchlistTable', watchlistData, 'watchlist');
    
    const fuseOptions = {
        includeScore: true,
        keys: ['id', 'name', 'dept', 'primaryFunction']
    };
    
    let fuseValid = new Fuse(validUsersData, fuseOptions);
    let fuseInvalid = new Fuse(invalidUsersData, fuseOptions);
    let fuseWatchlist = new Fuse(watchlistData, fuseOptions);

    function searchTable(type) {
        let fuse, data, tableId, searchId;
        if (type === 'valid') {
            fuse = fuseValid; data = validUsersData; tableId = 'validTable'; searchId = 'validSearch';
        } else if (type === 'invalid') {
            fuse = fuseInvalid; data = invalidUsersData; tableId = 'invalidTable'; searchId = 'invalidSearch';
        } else {
            fuse = fuseWatchlist; data = watchlistData; tableId = 'watchlistTable'; searchId = 'watchlistSearch';
        }

        const input = document.getElementById(searchId).value;
        if (input === "") {
            populateTable(tableId, data, type);
            return;
        }
        const result = fuse.search(input);
        const filteredData = result.map(item => item.item);
        populateTable(tableId, filteredData, type);
    }
    
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab-link");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    function sortTable(n, tableId) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById(tableId);
        switching = true;
        dir = "asc";
        while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                if (!x || !y) continue;
                var xContent = isNaN(parseFloat(x.innerHTML)) ? x.innerHTML.toLowerCase() : parseFloat(x.innerHTML);
                var yContent = isNaN(parseFloat(y.innerHTML)) ? y.innerHTML.toLowerCase() : parseFloat(y.innerHTML);

                if (dir == "asc") {
                    if (xContent > yContent) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (xContent < yContent) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount++;
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
    
    // --- Charts ---
    const chartFont = { size: 14, family: "'Segoe UI', sans-serif" };

    const userStatusCtx = document.getElementById('userStatusChart').getContext('2d');
    new Chart(userStatusCtx, {
        type: 'doughnut',
        data: {
            labels: ['Active Users', 'Inactive Users'],
            datasets: [{
                data: [validUsersData.length, invalidUsersData.length],
                backgroundColor: ['#1a3a6e', '#d9534f'],
                borderColor: '#ffffff',
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom', labels: { font: chartFont } },
            }
        }
    });

    const activeUsersByDeptCtx = document.getElementById('activeUsersByDeptChart').getContext('2d');
    const unitCounts = validUsersData.reduce((acc, user) => {
        acc[user.dept] = (acc[user.dept] || 0) + 1;
        return acc;
    }, {});
    const sortedUnits = Object.entries(unitCounts).sort(([, a], [, b]) => b - a).slice(0, 10);
    new Chart(activeUsersByDeptCtx, {
        type: 'bar',
        data: {
            labels: sortedUnits.map(item => item[0]),
            datasets: [{
                label: 'Active Users',
                data: sortedUnits.map(item => item[1]),
                backgroundColor: '#5cb85c',
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { x: { grid: { display: false }, ticks: { font: chartFont } }, y: { grid: { color: '#e9ecef' }, ticks: { font: chartFont } } }
        }
    });

    const moduleUsageCtx = document.getElementById('moduleUsageChart').getContext('2d');
    const moduleCounts = validUsersData.reduce((acc, user) => {
        acc[user.primaryModule] = (acc[user.primaryModule] || 0) + 1;
        return acc;
    }, {});
    const sortedModules = Object.entries(moduleCounts).sort(([, a], [, b]) => b - a);
    new Chart(moduleUsageCtx, {
        type: 'bar',
        data: {
            labels: sortedModules.map(item => item[0]),
            datasets: [{
                label: 'Active Users',
                data: sortedModules.map(item => item[1]),
                backgroundColor: ['#0275d8', '#5bc0de', '#f0ad4e', '#5cb85c', '#d9534f', '#292b2c', '#6c757d'],
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { x: { ticks: { font: chartFont } }, y: { ticks: { font: chartFont } } }
        }
    });

    const functionUsageCtx = document.getElementById('functionUsageChart').getContext('2d');
    const functionCounts = validUsersData.reduce((acc, user) => {
        acc[user.primaryFunction] = (acc[user.primaryFunction] || 0) + 1;
        return acc;
    }, {});
    const sortedFunctions = Object.entries(functionCounts).sort(([, a], [, b]) => b - a).slice(0, 10);
    new Chart(functionUsageCtx, {
        type: 'bar',
        data: {
            labels: sortedFunctions.map(item => item[0]),
            datasets: [{
                label: 'Active Users',
                data: sortedFunctions.map(item => item[1]),
                backgroundColor: '#f0ad4e',
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { x: { ticks: { font: chartFont } }, y: { ticks: { font: chartFont } } }
        }
    });


    const riskTypeCtx = document.getElementById('riskTypeChart').getContext('2d');
    new Chart(riskTypeCtx, {
        type: 'pie',
        data: {
            labels: Object.values(riskReasons).map(r => r.text),
            datasets: [{
                data: Object.values(riskReasons).map(r => r.count),
                backgroundColor: Object.values(riskReasons).map(r => {
                    const tempTag = document.createElement('span');
                    tempTag.className = `tag ${r.class}`;
                    document.body.appendChild(tempTag);
                    const color = getComputedStyle(tempTag).backgroundColor;
                    document.body.removeChild(tempTag);
                    return color;
                }),
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'right', labels: { font: chartFont } },
            }
        }
    });

</script>
</body>
</html>
