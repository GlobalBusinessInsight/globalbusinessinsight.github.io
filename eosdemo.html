<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOS - Energy Operation Wise | Ontology Energy Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Orbitron Font for Dashboard Numbers -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #030712; /* Very Dark Blue/Gray */
            color: #e2e8f0;
            font-family: 'Inter', 'Microsoft YaHei', sans-serif;
            overflow: hidden;
        }
        .font-sci { font-family: 'Orbitron', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(17, 24, 39, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.15);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Status Indicators */
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
        .status-ok { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-warn { background-color: #f59e0b; box-shadow: 0 0 8px #f59e0b; }
        .status-err { background-color: #ef4444; box-shadow: 0 0 8px #ef4444; }
        .status-off { background-color: #6b7280; }

        /* Animations */
        @keyframes pulse-border {
            0% { border-color: rgba(56, 189, 248, 0.3); }
            50% { border-color: rgba(56, 189, 248, 0.8); }
            100% { border-color: rgba(56, 189, 248, 0.3); }
        }
        .border-pulse { animation: pulse-border 2s infinite; }

        /* Grid Lines Background */
        .bg-grid {
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col bg-grid">

    <!-- TOP HEADER: Global KPIs -->
    <header class="h-16 glass-panel border-b border-sky-900/30 flex justify-between items-center px-6 z-30 shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-sky-600 rounded flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-sky-500/20">
                <i class="fa-solid fa-bolt"></i>
            </div>
            <div>
                <h1 class="text-xl font-sci font-bold tracking-wider text-white">EOS <span class="text-sky-400 text-sm">PLATFORM</span></h1>
                <p class="text-[10px] text-slate-400 uppercase tracking-widest" data-i18n="subtitle">Ontology-Driven Energy Operation</p>
            </div>
        </div>

        <!-- Global Real-time Metrics -->
        <div class="flex gap-8">
            <div class="text-right">
                <div class="text-[10px] text-slate-500 uppercase font-bold" data-i18n="kpi_cap">Total Capacity</div>
                <div class="text-xl font-sci text-white font-bold">28.5 <span class="text-xs text-slate-500">GW</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold" data-i18n="kpi_power">Real-time Power</div>
                <div class="text-xl font-sci text-emerald-400 font-bold">18.24 <span class="text-xs text-slate-500">GW</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold" data-i18n="kpi_gen">Day Generation</div>
                <div class="text-xl font-sci text-sky-400 font-bold">145.2 <span class="text-xs text-slate-500">GWh</span></div>
            </div>
            <div class="text-right border-l border-slate-700 pl-8">
                <div class="text-[10px] text-slate-500 uppercase font-bold" data-i18n="kpi_carbon">Carbon Reduced</div>
                <div class="text-xl font-sci text-teal-400 font-bold">89,402 <span class="text-xs text-slate-500" data-i18n="unit_tons">Tons</span></div>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <!-- Language Switcher -->
            <button onclick="toggleLanguage()" class="text-xs border border-slate-600 rounded px-2 py-1 text-slate-300 hover:text-white hover:border-slate-400 transition-colors w-20 text-center font-mono">
                <i class="fa-solid fa-globe mr-1"></i><span id="lang-label">EN</span>
            </button>

            <div class="text-right mr-2">
                <div class="text-xs text-slate-300 font-bold" data-i18n="operator">Operator: ADMIN</div>
                <div class="text-[10px] text-emerald-500" data-i18n="status_secure">SECURE CONNECTION</div>
            </div>
            <img src="https://api.dicebear.com/9.x/avataaars/svg?seed=Felix" class="w-10 h-10 rounded-full border-2 border-slate-600">
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- LEFT: ONTOLOGY ASSET TREE -->
        <aside class="w-72 glass-panel border-r border-slate-800 flex flex-col z-20">
            <!-- Search Header -->
            <div class="p-4 border-b border-slate-800 bg-slate-900/50 shrink-0">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xs font-bold text-slate-300 uppercase tracking-wider">
                        <i class="fa-solid fa-sitemap mr-2"></i><span data-i18n="asset_ontology">Asset Ontology</span>
                    </h2>
                    <span class="bg-sky-900/30 text-sky-400 text-[10px] px-2 py-0.5 rounded border border-sky-800" data-i18n="site_count">25 Sites</span>
                </div>
                <input type="text" id="search-input" placeholder="Search Asset ID..." class="w-full bg-slate-950 border border-slate-700 rounded px-3 py-1.5 text-xs text-slate-300 focus:border-sky-500 outline-none transition-colors">
            </div>

            <!-- Asset Tree (Flex 1) -->
            <div class="flex-1 overflow-y-auto p-2 space-y-1 text-sm" id="asset-tree">
                <!-- Dynamic Content Injected by JS -->
            </div>

            <!-- Mini Alert Log (Fixed Height) -->
            <div class="h-40 border-t border-slate-800 bg-slate-900/30 flex flex-col shrink-0">
                <div class="p-3 border-b border-slate-800 flex justify-between items-center shrink-0">
                    <span class="text-[10px] font-bold text-red-400 uppercase" data-i18n="active_alerts">Active Alerts (3)</span>
                    <i class="fa-solid fa-bell text-slate-500 text-xs"></i>
                </div>
                <div class="flex-1 overflow-y-auto p-2 space-y-2">
                    <div class="bg-red-900/20 border border-red-900/50 p-2 rounded hover:bg-red-900/30 cursor-pointer transition-colors">
                        <div class="flex justify-between text-[10px] text-red-300 font-bold">
                            <span><i class="fa-solid fa-triangle-exclamation mr-1"></i>INV-04 Fault</span>
                            <span>10:42</span>
                        </div>
                        <div class="text-[10px] text-slate-400 mt-1" data-i18n="alert_msg_1">PV Base #3: Inverter efficiency drop > 15%.</div>
                    </div>
                    <div class="bg-amber-900/20 border border-amber-900/50 p-2 rounded">
                        <div class="flex justify-between text-[10px] text-amber-300 font-bold">
                            <span><i class="fa-solid fa-wind mr-1"></i>High Wind Cutout</span>
                            <span>10:15</span>
                        </div>
                        <div class="text-[10px] text-slate-400 mt-1" data-i18n="alert_msg_2">Offshore #1: 12 Turbines paused.</div>
                    </div>
                </div>
            </div>

            <!-- FOOTER: LOGO & CREDIT -->
            <div class="p-4 border-t border-slate-800 bg-slate-900/80 flex flex-col items-center justify-center shrink-0">
                <img src="https://globalbusinessinsight.github.io/picture/inossem_logo.svg" alt="Inossem Logo" class="w-24 opacity-80 mb-1">
                <div class="w-20 border-t border-slate-700/50 mt-1 pt-1 text-[8px] text-slate-500 text-center font-mono uppercase tracking-tighter">
                    Design by Paul
                </div>
            </div>
        </aside>

        <!-- CENTER: DIGITAL TWIN CANVAS (MAP) -->
        <main class="flex-1 relative bg-[#02040a]">
            <div class="absolute top-4 left-4 z-10 flex gap-2">
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-white hover:border-sky-500 transition-colors border border-transparent" onclick="setMapMode('ALL')" data-i18n="btn_all">All Assets</button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-sky-400 hover:border-sky-500 transition-colors border border-transparent" onclick="setMapMode('WIND')"><i class="fa-solid fa-wind mr-1"></i> <span data-i18n="btn_wind">Wind</span></button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-yellow-400 hover:border-yellow-500 transition-colors border border-transparent" onclick="setMapMode('SOLAR')"><i class="fa-solid fa-sun mr-1"></i> <span data-i18n="btn_solar">Solar</span></button>
                <button class="glass-panel px-3 py-1.5 rounded text-xs text-slate-300 hover:text-purple-400 hover:border-purple-500 transition-colors border border-transparent" onclick="setMapMode('STORAGE')"><i class="fa-solid fa-battery-full mr-1"></i> <span data-i18n="btn_storage">Storage</span></button>
            </div>

            <canvas id="mapCanvas" class="block w-full h-full cursor-crosshair"></canvas>

            <!-- Bottom Overlay: Grid Interaction -->
            <div class="absolute bottom-6 left-6 right-[420px] h-32 glass-panel rounded-lg p-4 flex gap-6 z-10">
                 <!-- Grid Dispatch -->
                 <div class="flex-1 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xs font-bold text-slate-300 uppercase"><i class="fa-solid fa-tower-broadcast mr-1"></i> <span data-i18n="grid_dispatch">Grid Dispatch (AGC)</span></h3>
                        <span class="text-[10px] bg-emerald-900/50 text-emerald-400 px-1.5 py-0.5 rounded" data-i18n="status_compliant">COMPLIANT</span>
                    </div>
                    <div class="flex items-end gap-4">
                        <div>
                            <div class="text-[10px] text-slate-500" data-i18n="target_mw">Target (MW)</div>
                            <div class="text-2xl font-sci text-white">18,200</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-500" data-i18n="actual_mw">Actual (MW)</div>
                            <div class="text-2xl font-sci text-emerald-400">18,240</div>
                        </div>
                        <div class="h-8 w-px bg-slate-700"></div>
                        <div>
                            <div class="text-[10px] text-slate-500" data-i18n="freq_hz">Freq (Hz)</div>
                            <div class="text-lg font-mono text-slate-300">50.02</div>
                        </div>
                    </div>
                    <!-- Progress bar for dispatch accuracy -->
                    <div class="w-full bg-slate-800 h-1.5 rounded-full mt-2 overflow-hidden">
                        <div class="bg-emerald-500 h-full w-[99%]"></div>
                    </div>
                 </div>

                 <!-- Spot Market -->
                 <div class="w-1/3 border-l border-slate-700 pl-6 flex flex-col justify-between">
                    <h3 class="text-xs font-bold text-slate-300 uppercase"><i class="fa-solid fa-chart-line mr-1"></i> <span data-i18n="spot_market">Spot Market</span></h3>
                    <div class="flex justify-between items-end">
                        <div>
                            <div class="text-[10px] text-slate-500" data-i18n="rt_price">Real-time Price</div>
                            <div class="text-xl font-mono text-yellow-400">¥ 0.42 <span class="text-xs text-slate-500">/kWh</span></div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-slate-500" data-i18n="next_pred">Next 15m Pred.</div>
                            <div class="text-sm font-mono text-slate-300">¥ 0.38 <i class="fa-solid fa-arrow-trend-down text-red-400 ml-1"></i></div>
                        </div>
                    </div>
                    <button class="w-full bg-indigo-600/20 hover:bg-indigo-600/40 border border-indigo-500/50 text-indigo-300 text-[10px] py-1 rounded mt-1 transition-colors" data-i18n="ai_strategy">
                        AI Trading Strategy: HOLD
                    </button>
                 </div>
            </div>
        </main>

        <!-- RIGHT: DEEP DIVE PANEL (Ontology Details) -->
        <aside class="w-[400px] glass-panel border-l border-slate-800 flex flex-col z-20 transition-transform duration-300" id="detailPanel">
            <!-- Header: Dynamic based on selection -->
            <div class="h-16 border-b border-slate-800 p-4 flex items-center gap-3 bg-slate-900/80 shrink-0">
                <div class="w-10 h-10 rounded-lg bg-sky-500/10 border border-sky-500/30 flex items-center justify-center text-sky-400 text-lg" id="detail-icon">
                    <i class="fa-solid fa-wind"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-sm font-bold text-white" id="detail-title" data-i18n="select_asset">Select an Asset</h2>
                    <div class="flex items-center gap-2">
                        <span class="status-dot status-ok" id="detail-status-dot"></span>
                        <span class="text-[10px] text-slate-400 font-mono" id="detail-id">--</span>
                    </div>
                </div>
                <button class="text-slate-500 hover:text-white"><i class="fa-solid fa-expand"></i></button>
            </div>

            <!-- Content Tabs -->
            <div class="flex-1 overflow-y-auto custom-scrollbar">
                
                <!-- Section 1: Real-time Telemetry -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3" data-i18n="panel_telemetry">Real-time Telemetry</h3>
                    <div class="grid grid-cols-2 gap-3" id="telemetry-grid">
                        <!-- Injected JS -->
                        <div class="bg-slate-800/50 p-2 rounded border border-slate-700">
                            <div class="text-[9px] text-slate-500" data-i18n="active_p">Active Power</div>
                            <div class="text-lg font-mono text-white">-- MW</div>
                        </div>
                        <div class="bg-slate-800/50 p-2 rounded border border-slate-700">
                            <div class="text-[9px] text-slate-500" data-i18n="reactive_p">Reactive Power</div>
                            <div class="text-lg font-mono text-slate-300">-- MVar</div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Environment -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3" data-i18n="panel_env">Environmental Data</h3>
                    <div class="bg-gradient-to-r from-slate-800/50 to-slate-900/50 p-3 rounded border border-slate-700 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-cloud-sun text-xl text-sky-300"></i>
                            <div>
                                <div class="text-xs text-white font-bold" id="env-cond">Partly Cloudy</div>
                                <div class="text-[10px] text-slate-400" id="env-wind">Wind: 8.4 m/s NE</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-mono text-white">24°C</div>
                            <div class="text-[10px] text-slate-400"><span data-i18n="hum">Hum</span>: 65%</div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Ontology Relations (Links) -->
                <div class="p-4 border-b border-slate-800">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3" data-i18n="panel_onto">Ontology Relations</h3>
                    <div class="space-y-2" id="ontology-links">
                        <!-- Dynamic -->
                    </div>
                </div>

                <!-- Section 4: Asset Management & Health -->
                <div class="p-4 border-b border-slate-800">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-[10px] font-bold text-slate-500 uppercase" data-i18n="panel_health">Asset Health (AI Prediction)</h3>
                        <span class="bg-emerald-900/30 text-emerald-400 text-[9px] px-1.5 py-0.5 rounded border border-emerald-800" data-i18n="status_healthy">HEALTHY</span>
                    </div>
                    <!-- Health Gauge Chart Container -->
                    <div class="h-32 w-full">
                        <canvas id="healthChart"></canvas>
                    </div>
                    <div class="mt-3 space-y-2">
                         <div class="flex justify-between text-[10px]">
                            <span class="text-slate-400"><span data-i18n="comp">Component</span>: <span id="health-comp">Gearbox</span></span>
                            <span class="text-white"><span data-i18n="rul">Est. RUL</span>: <span id="health-rul">1,200 Days</span></span>
                         </div>
                         <div class="w-full bg-slate-800 h-1 rounded-full">
                             <div class="bg-emerald-500 h-full w-3/4"></div>
                         </div>
                    </div>
                </div>

                <!-- Section 5: Financials -->
                <div class="p-4">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3" data-i18n="panel_billing">Metering & Billing</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800/30 p-2 rounded border border-slate-700/50">
                            <div class="text-[9px] text-slate-500" data-i18n="meter_read">Meter Reading</div>
                            <div class="text-sm font-mono text-white">4,291,002 kWh</div>
                        </div>
                        <div class="bg-slate-800/30 p-2 rounded border border-slate-700/50">
                            <div class="text-[9px] text-slate-500" data-i18n="settled">Settled (Mtd)</div>
                            <div class="text-sm font-mono text-emerald-400">¥ 1.82 M</div>
                        </div>
                    </div>
                    <!-- Direct Supply Tag -->
                    <div class="mt-2 bg-indigo-900/20 border border-indigo-500/30 p-2 rounded hidden" id="direct-supply-badge">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-plug-circle-bolt text-indigo-400"></i>
                            <span class="text-[10px] text-indigo-200 font-bold" data-i18n="direct_proto">Direct Supply Protocol Active</span>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Footer Actions -->
            <div class="p-4 bg-slate-900 border-t border-slate-800 flex gap-2 shrink-0">
                <button class="flex-1 bg-sky-600 hover:bg-sky-500 text-white text-xs font-bold py-2 rounded transition-colors">
                    <i class="fa-solid fa-wrench mr-1"></i> <span data-i18n="btn_wo">Work Order</span>
                </button>
                <button class="flex-1 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-bold py-2 rounded transition-colors">
                    <i class="fa-solid fa-file-waveform mr-1"></i> <span data-i18n="btn_report">Full Report</span>
                </button>
            </div>
        </aside>

    </div>

    <script>
        /** * EOS DEMO LOGIC TRILINGUAL VERSION */

        // --- 0. I18N CONFIGURATION ---
        let currentLang = 'en';
        
        const i18n = {
            en: {
                subtitle: 'Ontology-Driven Energy Operation',
                kpi_cap: 'Total Capacity',
                kpi_power: 'Real-time Power',
                kpi_gen: 'Day Generation',
                kpi_carbon: 'Carbon Reduced',
                unit_tons: 'Tons',
                operator: 'Operator: ADMIN',
                status_secure: 'SECURE CONNECTION',
                asset_ontology: 'Asset Ontology',
                site_count: '25 Sites',
                search_ph: 'Search Asset ID...',
                active_alerts: 'Active Alerts (3)',
                btn_all: 'All Assets',
                btn_wind: 'Wind',
                btn_solar: 'Solar',
                btn_storage: 'Storage',
                grid_dispatch: 'Grid Dispatch (AGC)',
                status_compliant: 'COMPLIANT',
                target_mw: 'Target (MW)',
                actual_mw: 'Actual (MW)',
                freq_hz: 'Freq (Hz)',
                spot_market: 'Spot Market',
                rt_price: 'Real-time Price',
                next_pred: 'Next 15m Pred.',
                ai_strategy: 'AI Strategy: HOLD',
                select_asset: 'Select an Asset',
                panel_telemetry: 'Real-time Telemetry',
                active_p: 'Active Power',
                reactive_p: 'Reactive Power',
                panel_env: 'Environmental Data',
                hum: 'Hum',
                panel_onto: 'Ontology Relations',
                panel_health: 'Asset Health (AI Prediction)',
                status_healthy: 'HEALTHY',
                comp: 'Component',
                rul: 'Est. RUL',
                panel_billing: 'Metering & Billing',
                meter_read: 'Meter Reading',
                settled: 'Settled (Mtd)',
                direct_proto: 'Direct Supply Protocol Active',
                btn_wo: 'Work Order',
                btn_report: 'Full Report',
                alert_msg_1: 'PV Base #3: Inverter efficiency drop > 15%.',
                alert_msg_2: 'Offshore #1: 12 Turbines paused.',
                header_off: 'Offshore Wind (2)',
                header_on: 'Onshore Wind (18)',
                header_pv: 'PV Bases (5)',
                more_fields: '+ 13 more fields...',
                type_grid: 'Grid',
                type_h2: 'H2 Off-grid',
                type_direct: 'Direct Supply',
                rel_contains: 'CONTAINS',
                rel_located: 'LOCATED_AT',
                rel_feeds: 'FEEDS',
                rel_maint: 'MAINTENANCE',
                rel_connected: 'CONNECTED_TO',
                rel_supplies: 'SUPPLIES',
                rel_buffers: 'BUFFERS',
                w_cloudy: 'Partly Cloudy',
                w_sunny: 'Sunny',
                w_night: 'Clear Night',
                c_main: 'MAIN GRID',
                c_h2: 'H2 PLANT',
                c_load: 'LOAD',
                c_bess: 'BESS',
                c_wind: 'WIND',
                c_pv: 'PV',
                days: 'Days'
            },
            zh: {
                subtitle: '本体论驱动新能源集控平台',
                kpi_cap: '总装机容量',
                kpi_power: '实时功率',
                kpi_gen: '日发电量',
                kpi_carbon: '碳减排量',
                unit_tons: '吨',
                operator: '操作员: 管理员',
                status_secure: '连接安全',
                asset_ontology: '资产本体图谱',
                site_count: '25 场站',
                search_ph: '搜索资产 ID...',
                active_alerts: '活跃警报 (3)',
                btn_all: '全部资产',
                btn_wind: '风电',
                btn_solar: '光伏',
                btn_storage: '储能',
                grid_dispatch: '电网调度 (AGC)',
                status_compliant: '响应合规',
                target_mw: '目标 (MW)',
                actual_mw: '实际 (MW)',
                freq_hz: '频率 (Hz)',
                spot_market: '现货交易',
                rt_price: '实时电价',
                next_pred: '未来15分预测',
                ai_strategy: 'AI 策略: 持仓',
                select_asset: '选择资产查看详情',
                panel_telemetry: '实时遥测',
                active_p: '有功功率',
                reactive_p: '无功功率',
                panel_env: '环境数据',
                hum: '湿度',
                panel_onto: '本体关联关系',
                panel_health: '资产健康 (AI预测)',
                status_healthy: '健康',
                comp: '关键组件',
                rul: '预估寿命',
                panel_billing: '计量与计费',
                meter_read: '电表读数',
                settled: '月度结算',
                direct_proto: '直供电协议激活',
                btn_wo: '生成工单',
                btn_report: '完整报告',
                alert_msg_1: '光伏基地 #3: 逆变器效率下降 > 15%.',
                alert_msg_2: '海上风场 #1: 12 台风机停机.',
                header_off: '海上风电 (2)',
                header_on: '陆上风电 (18)',
                header_pv: '光伏基地 (5)',
                more_fields: '+ 更多 13 个风场...',
                type_grid: '并网',
                type_h2: '离网制氢',
                type_direct: '直供电',
                rel_contains: '包含',
                rel_located: '位于',
                rel_feeds: '供能给',
                rel_maint: '维修中',
                rel_connected: '连接至',
                rel_supplies: '供应给',
                rel_buffers: '缓冲于',
                w_cloudy: '多云',
                w_sunny: '晴朗',
                w_night: '晴夜',
                c_main: '主电网',
                c_h2: '制氢站',
                c_load: '负荷',
                c_bess: '储能',
                c_wind: '风电',
                c_pv: '光伏',
                days: '天'
            },
            fr: {
                subtitle: 'Opération énergétique pilotée par ontologie',
                kpi_cap: 'Capacité Totale',
                kpi_power: 'Puissance Réelle',
                kpi_gen: 'Prod. Journalière',
                kpi_carbon: 'Carbone Réduit',
                unit_tons: 'Tonnes',
                operator: 'Opérateur: ADMIN',
                status_secure: 'CONNEXION SÉCURISÉE',
                asset_ontology: 'Ontologie des Actifs',
                site_count: '25 Sites',
                search_ph: 'Rechercher ID Actif...',
                active_alerts: 'Alertes Actives (3)',
                btn_all: 'Tous les Actifs',
                btn_wind: 'Éolien',
                btn_solar: 'Solaire',
                btn_storage: 'Stockage',
                grid_dispatch: 'Répartition Réseau (AGC)',
                status_compliant: 'CONFORME',
                target_mw: 'Cible (MW)',
                actual_mw: 'Réel (MW)',
                freq_hz: 'Fréq (Hz)',
                spot_market: 'Marché Spot',
                rt_price: 'Prix Temps Réel',
                next_pred: 'Préd. 15m',
                ai_strategy: 'Stratégie IA: MAINTENIR',
                select_asset: 'Sélectionner un Actif',
                panel_telemetry: 'Télémesure Temps Réel',
                active_p: 'Puissance Active',
                reactive_p: 'Puissance Réactive',
                panel_env: 'Données Env.',
                hum: 'Hum',
                panel_onto: 'Relations Ontologiques',
                panel_health: 'Santé Actif (Préd. IA)',
                status_healthy: 'SAIN',
                comp: 'Composant',
                rul: 'Durée Vie Est.',
                panel_billing: 'Comptage & Facturation',
                meter_read: 'Relevé Compteur',
                settled: 'Réglé (Mtd)',
                direct_proto: 'Protocole Direct Actif',
                btn_wo: 'Ordre de Travail',
                btn_report: 'Rapport Complet',
                alert_msg_1: 'Base PV #3: Baisse efficacité onduleur > 15%.',
                alert_msg_2: 'Offshore #1: 12 Turbines en pause.',
                header_off: 'Éolien Offshore (2)',
                header_on: 'Éolien Terrestre (18)',
                header_pv: 'Bases PV (5)',
                more_fields: '+ 13 autres champs...',
                type_grid: 'Réseau',
                type_h2: 'H2 Hors-réseau',
                type_direct: 'Alim. Directe',
                rel_contains: 'CONTIENT',
                rel_located: 'SITUÉ_À',
                rel_feeds: 'ALIMENTE',
                rel_maint: 'MAINTENANCE',
                rel_connected: 'CONNECTÉ_À',
                rel_supplies: 'FOURNIT',
                rel_buffers: 'TAMPON',
                w_cloudy: 'Partiellement Nuageux',
                w_sunny: 'Ensoleillé',
                w_night: 'Nuit Claire',
                c_main: 'RÉSEAU PRINCIPAL',
                c_h2: 'USINE H2',
                c_load: 'CHARGE',
                c_bess: 'BESS',
                c_wind: 'ÉOLIEN',
                c_pv: 'PV',
                days: 'Jours'
            }
        };

        // --- 1. DATA GENERATION (Trilingual Names) ---
        const ontology = {
            offshore: [
                { id: 'OWF-01', name: {en: 'Offshore Alpha', zh: '海上风电 Alpha', fr: 'Offshore Alpha'}, cap: 500, turbines: 50, turbineType: '10MW', type: 'grid', lat: 0.15, lon: 0.7 },
                { id: 'OWF-02', name: {en: 'Offshore Beta', zh: '海上风电 Beta', fr: 'Offshore Bêta'}, cap: 500, turbines: 50, turbineType: '10MW', type: 'hydrogen', lat: 0.25, lon: 0.8 }
            ],
            onshore: Array.from({length: 18}, (_, i) => ({
                id: `ONF-${String(i+1).padStart(2, '0')}`,
                name: {en: `Onshore Field ${String.fromCharCode(65+i)}`, zh: `陆上风场 ${String.fromCharCode(65+i)}`, fr: `Parc Terrestre ${String.fromCharCode(65+i)}`},
                cap: 1100,
                turbines: 200,
                mix: '9MW/6MW/1.5MW',
                lat: 0.4 + Math.random()*0.5,
                lon: 0.1 + Math.random()*0.5,
                type: 'grid'
            })),
            solar: [
                { id: 'PV-01', name: {en: 'PV Base Sol', zh: '光伏基地 Sol', fr: 'Base PV Sol'}, cap: 1000, type: 'direct', lat: 0.8, lon: 0.2 },
                { id: 'PV-02', name: {en: 'PV Base Luna', zh: '光伏基地 Luna', fr: 'Base PV Luna'}, cap: 1000, type: 'grid', lat: 0.7, lon: 0.3 },
                { id: 'PV-03', name: {en: 'PV Base Terra', zh: '光伏基地 Terra', fr: 'Base PV Terra'}, cap: 1000, type: 'grid', lat: 0.75, lon: 0.4 },
                { id: 'PV-04', name: {en: 'PV Base Mars', zh: '光伏基地 Mars', fr: 'Base PV Mars'}, cap: 1000, type: 'grid', lat: 0.85, lon: 0.3 },
                { id: 'PV-05', name: {en: 'PV Base Jupiter', zh: '光伏基地 Jupiter', fr: 'Base PV Jupiter'}, cap: 1000, type: 'grid', lat: 0.8, lon: 0.5 }
            ]
        };

        let selectedAsset = ontology.offshore[0];
        let selectedCategory = 'offshore';

        // --- 2. UI FUNCTIONS ---

        function toggleLanguage() {
            // Cycle: EN -> ZH -> FR -> EN
            if (currentLang === 'en') currentLang = 'zh';
            else if (currentLang === 'zh') currentLang = 'fr';
            else currentLang = 'en';

            const labelMap = { en: 'EN', zh: '中', fr: 'FR' };
            document.getElementById('lang-label').innerText = labelMap[currentLang];
            
            updateStaticTexts();
            renderAssetTree();
            selectAsset(selectedAsset, selectedCategory); 
            initChart(); 
        }

        function updateStaticTexts() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[currentLang][key]) {
                    el.innerText = i18n[currentLang][key];
                }
            });
            document.getElementById('search-input').placeholder = i18n[currentLang]['search_ph'];
        }

        const treeContainer = document.getElementById('asset-tree');
        
        function createTreeItem(icon, title, sub, id, colorClass, clickFn) {
            const div = document.createElement('div');
            div.className = 'flex items-center p-2 hover:bg-slate-800 rounded cursor-pointer group transition-colors';
            div.onclick = clickFn;
            div.innerHTML = `
                <div class="w-8 h-8 rounded bg-slate-800 group-hover:bg-slate-700 flex items-center justify-center text-slate-400 ${colorClass} transition-colors mr-3 shrink-0">
                    <i class="${icon}"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="text-xs font-bold text-slate-200 truncate">${title}</div>
                    <div class="text-[10px] text-slate-500 truncate">${sub}</div>
                </div>
                <div class="status-dot status-ok shrink-0"></div>
            `;
            return div;
        }

        function renderAssetTree() {
            treeContainer.innerHTML = '';
            const txt = i18n[currentLang];

            // 1. Offshore
            const offHeader = document.createElement('div');
            offHeader.className = 'text-[10px] font-bold text-sky-500 uppercase px-2 mt-2 mb-1';
            offHeader.innerText = txt.header_off;
            treeContainer.appendChild(offHeader);
            ontology.offshore.forEach(f => {
                const typeStr = f.type === 'hydrogen' ? txt.type_h2 : txt.type_grid;
                const subStr = `${f.turbines} T | ${typeStr}`;
                treeContainer.appendChild(createTreeItem('fa-solid fa-water', f.name[currentLang], subStr, f.id, 'text-sky-400', () => selectAsset(f, 'offshore')));
            });

            // 2. Onshore
            const onHeader = document.createElement('div');
            onHeader.className = 'text-[10px] font-bold text-emerald-500 uppercase px-2 mt-4 mb-1';
            onHeader.innerText = txt.header_on;
            treeContainer.appendChild(onHeader);
            ontology.onshore.slice(0, 5).forEach(f => { 
                treeContainer.appendChild(createTreeItem('fa-solid fa-wind', f.name[currentLang], 'Mix (1.5/6/9MW)', f.id, 'text-emerald-400', () => selectAsset(f, 'onshore')));
            });
            const moreOn = document.createElement('div');
            moreOn.className = 'text-[10px] text-slate-600 px-2 italic';
            moreOn.innerText = txt.more_fields;
            treeContainer.appendChild(moreOn);

            // 3. Solar
            const solHeader = document.createElement('div');
            solHeader.className = 'text-[10px] font-bold text-yellow-500 uppercase px-2 mt-4 mb-1';
            solHeader.innerText = txt.header_pv;
            treeContainer.appendChild(solHeader);
            ontology.solar.forEach(f => {
                const typeStr = f.type === 'direct' ? txt.type_direct : txt.type_grid;
                const subStr = `${f.cap} MW | ${typeStr}`;
                treeContainer.appendChild(createTreeItem('fa-solid fa-sun', f.name[currentLang], subStr, f.id, 'text-yellow-400', () => selectAsset(f, 'solar')));
            });
        }


        // --- 3. CANVAS MAP VISUALIZATION ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let particles = [];
        
        function drawMap() {
            const txt = i18n[currentLang];
            ctx.fillStyle = '#02040a';
            ctx.fillRect(0, 0, width, height);

            // Coastline
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(width * 0.6, 0);
            ctx.bezierCurveTo(width * 0.5, height * 0.3, width * 0.8, height * 0.6, width * 0.6, height);
            ctx.stroke();

            // Hub
            const hubX = width * 0.5;
            const hubY = height * 0.5;
            
            // Offshore
            ontology.offshore.forEach((o) => {
                const x = width * (0.7 + o.lon * 0.2);
                const y = height * (0.1 + o.lat * 0.8);
                drawNode(x, y, 'blue', o.type === 'hydrogen' ? 'H2' : 'GRID', o.name[currentLang]);
                
                if (o.type === 'grid') drawLink(x, y, hubX, hubY, 'blue');
                else {
                    const h2X = x + 40, h2Y = y + 40;
                    drawNode(h2X, h2Y, 'purple', 'H2 PLANT', txt.c_h2);
                    drawLink(x, y, h2X, h2Y, 'cyan'); 
                }
                if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: 'cyan', life: 1});
            });

            // Solar
            ontology.solar.forEach((o) => {
                const x = width * (0.1 + o.lon * 0.3);
                const y = height * (0.1 + o.lat * 0.3);
                drawNode(x, y, 'yellow', 'PV', o.name[currentLang]);

                if (o.type === 'grid') {
                    drawLink(x, y, hubX, hubY, 'yellow');
                    if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: '#facc15', life: 1});
                } else {
                    const chemX = x - 50, chemY = y + 50;
                    drawNode(chemX, chemY, 'white', 'LOAD', txt.c_load);
                    drawLink(x, y, chemX, chemY, 'orange'); 
                    drawNode(x, y + 30, 'purple', 'BESS', txt.c_bess);
                }
            });

            // Onshore
            ontology.onshore.slice(0, 8).forEach((o) => {
                const x = width * (0.05 + o.lon * 0.4);
                const y = height * (0.5 + o.lat * 0.4);
                // Short name hack for map
                const shortName = currentLang === 'en' ? o.name.en.split(' ')[2] : (currentLang === 'zh' ? o.name.zh.split(' ')[1] : o.name.fr.split(' ')[2]);
                drawNode(x, y, 'green', txt.c_wind, shortName); 
                drawLink(x, y, hubX, hubY, 'green');
                if (Math.random() < 0.05) particles.push({x, y, tx: hubX, ty: hubY, color: '#34d399', life: 1});
            });

            // Hub
            ctx.fillStyle = '#1e293b';
            ctx.beginPath(); ctx.arc(hubX, hubY, 20, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#38bdf8'; ctx.lineWidth = 2; ctx.stroke();
            ctx.fillStyle = '#fff'; ctx.font = '10px Inter'; ctx.textAlign='center'; ctx.fillText(txt.c_main, hubX, hubY+4);

            // Particles
            particles.forEach((p, i) => {
                p.x += (p.tx - p.x) * 0.02;
                p.y += (p.ty - p.y) * 0.02;
                p.life -= 0.01;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
                if (p.life <= 0) particles.splice(i, 1);
            });

            requestAnimationFrame(drawMap);
        }

        function drawNode(x, y, color, type, label) {
            let c = '#fff';
            if (color === 'blue') c = '#0ea5e9';
            if (color === 'green') c = '#10b981';
            if (color === 'yellow') c = '#facc15';
            if (color === 'purple') c = '#a855f7';

            const g = ctx.createRadialGradient(x, y, 2, x, y, 20);
            g.addColorStop(0, c);
            g.addColorStop(1, 'transparent');
            ctx.fillStyle = g;
            ctx.globalAlpha = 0.3;
            ctx.beginPath(); ctx.arc(x, y, 20, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;

            ctx.fillStyle = '#0f172a'; ctx.strokeStyle = c; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI*2); ctx.fill(); ctx.stroke();

            ctx.fillStyle = '#94a3b8'; ctx.font = '9px Inter, Microsoft YaHei'; ctx.textAlign = 'center';
            ctx.fillText(label || '', x, y + 15);
            
            ctx.fillStyle = c; ctx.font = 'bold 8px Inter, Microsoft YaHei';
            ctx.fillText(type, x, y - 10);
        }

        function drawLink(x1, y1, x2, y2, color) {
            ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.setLineDash([5, 5]);
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
            ctx.setLineDash([]);
        }

        drawMap();

        // --- 4. INTERACTION & DETAILS ---
        
        let healthChartInstance = null;

        function initChart() {
            const ctxChart = document.getElementById('healthChart').getContext('2d');
            
            let labels = ['Healthy', 'Warning', 'Critical'];
            if (currentLang === 'zh') labels = ['健康', '警告', '严重'];
            if (currentLang === 'fr') labels = ['Sain', 'Avertissement', 'Critique'];

            if (healthChartInstance) {
                healthChartInstance.destroy();
            }

            healthChartInstance = new Chart(ctxChart, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: [95, 4, 1],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { display: true, position: 'right', labels: { color: '#94a3b8', font: { size: 9, family: 'Inter, Microsoft YaHei' } } }
                    }
                }
            });
        }

        function selectAsset(data, category) {
            selectedAsset = data;
            selectedCategory = category;
            const txt = i18n[currentLang];

            document.getElementById('detail-title').innerText = data.name[currentLang];
            document.getElementById('detail-id').innerText = `ID: ${data.id}`;
            
            const iconDiv = document.getElementById('detail-icon');
            const badge = document.getElementById('direct-supply-badge');
            badge.classList.add('hidden');
            let iconHtml = '';

            // Environmental Mock Logic
            let cond = 'Partly Cloudy';
            if (currentLang === 'zh') cond = '多云';
            if (currentLang === 'fr') cond = 'Partiellement Nuageux';
            document.getElementById('env-cond').innerText = cond;

            let wnd = 'Wind: 8.4 m/s NE';
            if (currentLang === 'zh') wnd = '风速: 8.4 m/s 东北';
            if (currentLang === 'fr') wnd = 'Vent: 8.4 m/s NE';
            document.getElementById('env-wind').innerText = wnd;

            // Asset Health Mock
            let comp = 'Gearbox';
            if (currentLang === 'zh') comp = '齿轮箱';
            if (currentLang === 'fr') comp = 'Boîte de vitesses';
            document.getElementById('health-comp').innerText = comp;

            let rl = '1,200 Days';
            if (currentLang === 'zh') rl = '1,200 天';
            if (currentLang === 'fr') rl = '1 200 Jours';
            document.getElementById('health-rul').innerText = rl;


            if (category === 'offshore') {
                iconHtml = '<i class="fa-solid fa-water"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-sky-500/10 border border-sky-500/30 flex items-center justify-center text-sky-400 text-lg';
                updateTelemetry('540 MW', '12 MVar');
                
                let tStr = `${data.turbines} x Siemens ${data.turbineType}`;
                if (currentLang === 'zh') tStr = `${data.turbines} 台 x 西门子 ${data.turbineType}`;
                
                let lStr = 'East China Sea Zone 4';
                if (currentLang === 'zh') lStr = '东海四区';
                if (currentLang === 'fr') lStr = 'Zone Mer de Chine Est 4';

                let fStr = 'Main Grid (500kV)';
                if (data.type === 'hydrogen') {
                    if (currentLang === 'en') fStr = 'H2 Electrolyzer Array';
                    if (currentLang === 'zh') fStr = '电解水制氢阵列';
                    if (currentLang === 'fr') fStr = 'Réseau Électrolyseur H2';
                } else {
                    if (currentLang === 'zh') fStr = '主电网 (500kV)';
                    if (currentLang === 'fr') fStr = 'Réseau Principal (500kV)';
                }
                
                updateOntology([
                    { type: txt.rel_contains, target: tStr },
                    { type: txt.rel_located, target: lStr },
                    { type: txt.rel_feeds, target: fStr }
                ]);
            } else if (category === 'onshore') {
                iconHtml = '<i class="fa-solid fa-wind"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center text-emerald-400 text-lg';
                updateTelemetry('850 MW', '45 MVar');
                
                let tStr = '66 x 9MW, 67 x 6MW...';
                if (currentLang === 'zh') tStr = '66台9MW, 67台6MW...';
                
                let mStr = '3 Turbines Offline';
                if (currentLang === 'zh') mStr = '3 台风机离线';
                if (currentLang === 'fr') mStr = '3 Turbines Hors Ligne';

                updateOntology([
                    { type: txt.rel_contains, target: tStr },
                    { type: txt.rel_maint, target: mStr }
                ]);
            } else {
                iconHtml = '<i class="fa-solid fa-sun"></i>';
                iconDiv.className = 'w-10 h-10 rounded-lg bg-yellow-500/10 border border-yellow-500/30 flex items-center justify-center text-yellow-400 text-lg';
                updateTelemetry('0 MW (Night)', '0 MVar'); 
                document.getElementById('env-cond').innerText = txt.w_night;
                
                let pStr = '2M PV Panels';
                if (currentLang === 'zh') pStr = '200万光伏板';
                if (currentLang === 'fr') pStr = '2M Panneaux PV';

                let iStr = 'Inverter Station A-Z';
                if (currentLang === 'zh') iStr = '逆变升压站 A-Z';
                if (currentLang === 'fr') iStr = 'Station Onduleur A-Z';

                updateOntology([
                    { type: txt.rel_contains, target: pStr },
                    { type: txt.rel_connected, target: iStr }
                ]);
                if (data.type === 'direct') {
                    badge.classList.remove('hidden');
                    
                    let s1 = 'Chem Plant (Load 200MW)';
                    if (currentLang === 'zh') s1 = '化工厂 (负荷 200MW)';
                    if (currentLang === 'fr') s1 = 'Usine Chim. (Charge 200MW)';

                    let s2 = 'Truck Charging (Load 50MW)';
                    if (currentLang === 'zh') s2 = '重卡充电站 (负荷 50MW)';
                    if (currentLang === 'fr') s2 = 'Recharge Camion (Charge 50MW)';

                    let s3 = 'BESS (300MWh)';
                    if (currentLang === 'zh') s3 = '配套储能 (300MWh)';
                    
                    updateOntology([
                        { type: txt.rel_supplies, target: s1 },
                        { type: txt.rel_supplies, target: s2 },
                        { type: txt.rel_buffers, target: s3 }
                    ]);
                }
            }
            iconDiv.innerHTML = iconHtml;
        }

        function updateTelemetry(active, reactive) {
            const container = document.getElementById('telemetry-grid');
            container.children[0].children[1].innerText = active;
            container.children[1].children[1].innerText = reactive;
        }

        function updateOntology(relations) {
            const container = document.getElementById('ontology-links');
            container.innerHTML = '';
            relations.forEach(r => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2 text-xs text-slate-300';
                div.innerHTML = `
                    <i class="fa-solid fa-link text-slate-600"></i>
                    <span class="bg-slate-800 px-1.5 py-0.5 rounded text-[10px] font-mono text-slate-400">${r.type}</span>
                    <span class="text-sky-100 truncate">${r.target}</span>
                `;
                container.appendChild(div);
            });
        }

        // --- INIT ---
        renderAssetTree();
        selectAsset(ontology.offshore[0], 'offshore');
        initChart();

    </script>
</body>
</html>
